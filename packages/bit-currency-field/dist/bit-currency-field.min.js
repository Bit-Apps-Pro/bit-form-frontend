!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).bit_currency_field=e()}(this,(function(){"use strict";return class{#t="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'/>";#e=null;#i=null;#s=null;#n=null;#r=null;#l=null;#o=null;#c=null;#a=null;#u=null;#h=null;#d=null;#p=[];#m;#y={};#f="";#g={maxHeight:370,searchCurrencyPlaceholder:"Search Currency",noCurrencyFoundText:"No Currency Found",selectedCurrencyClearable:!0,searchClearable:!0,selectedFlagImage:!0,defaultCurrencyKey:"",optionFlagImage:!0,inputFormatOptions:{formatter:"browser",showCurrencySymbol:!0,decimalSeparator:"."},valueFormatOptions:{formatter:"browser",showCurrencySymbol:!0,decimalSeparator:"."},attributes:{},classNames:{},assetsURL:""};#b=null;#C="";#E=[];constructor(t,e){Object.assign(this.#g,e),this.#y=e.window?e.window:window,this.#m=e.document?e.document:document,this.#e="string"==typeof t?this.#m.querySelector(t):t,this.#p=[...this.#g.options],this.fieldKey=this.#g.fieldKey,this.#f=e.assetsURL,this.init()}init(){this.#a=this.#v(`.${this.fieldKey}-currency-inner-wrp`),this.#u=this.#v(`.${this.fieldKey}-currency-amount-input`),this.#i=this.#v(`.${this.fieldKey}-currency-hidden-input`),this.#s=this.#v(`.${this.fieldKey}-input-clear-btn`),this.#l=this.#v(`.${this.fieldKey}-selected-currency-img`),this.#c=this.#v(`.${this.fieldKey}-opt-search-input`),this.#n=this.#v(`.${this.fieldKey}-dpd-wrp`),this.#r=this.#v(`.${this.fieldKey}-option-wrp`),this.#h=this.#v(`.${this.fieldKey}-search-clear-btn`),this.#d=this.#v(`.${this.fieldKey}-option-list`),this.#I(this.#e,"keydown",(t=>{this.#w(t)})),this.#I(this.#n,"click",(t=>{this.#x(t)})),this.#I(this.#n,"keyup",(t=>{this.#x(t)})),this.#I(this.#u,"focus",(t=>{this.#N()})),this.#I(this.#u,"blur",(t=>{this.#S()})),this.#I(this.#u,"input",(t=>{this.#O(t)})),observeElm(this.#i,"value",((t,e)=>{this.#F(t,e)})),this.#g.selectedCurrencyClearable&&this.#I(this.#s,"click",(t=>{this.#$(t)})),this.#A(),this.#k(),this.#g.defaultCurrencyKey&&this.setSelectedCurrencyItem(this.#g.defaultCurrencyKey),this.#g.searchClearable&&(this.#c.style.paddingRight="30px",this.#h.style.display="block",this.#I(this.#h,"click",(()=>{this.searchOptions("")}))),this.#c.value="",this.#I(this.#c,"keyup",(t=>{this.#T(t)}))}#N(){this.#L(this.#u,"type","number"),this.#u.value=this.#u.dataset.numValue}#W(t){const e=10**((arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)||0);return Math.round(t*e)/e}#S(){this.#L(this.#u,"type","text");const t=Number(this.#u.dataset.numValue);if(!t||Number.isNaN(t))return void(this.#u.value="");const{inputFormatOptions:e,valueFormatOptions:i}=this.#g,s=this.#K(t,e);this.#u.value=s,this.value=this.#K(t,i)}#K(t,e){const i=this.#B(),{defaultCurrencyKey:s}=this.#g,{formatter:n,roundToClosestInteger:r,showCurrencySymbol:l,currencyPosition:o,symbolPosition:c}=e,a=(null==i?void 0:i.i)||s;r&&(t=this.#W(t));let u="";return"browser"===n?u=this.#D(t,a,e):"custom"!==n&&n?"none"===n&&(u=t):u=this.#V(t,e),"left-number"===c?u=`${(null==i?void 0:i.symbol)||""}${u}`:"right-number"===c&&(u=`${u}${(null==i?void 0:i.symbol)||""}`),l&&("left"===o?u=`${l?`${a} `:""}${u}`:"right"===o&&(u=`${u}${l?` ${a}`:""}`)),"left-currency"===c?u=`${(null==i?void 0:i.symbol)||""}${u}`:"right-currency"===c&&(u=`${u}${(null==i?void 0:i.symbol)||""}`),u}#D(t,e,i){const{showCurrencySymbol:s,roundToClosestInteger:n}=i;return new Intl.NumberFormat(navigator.language,{style:"currency",currency:e}).formatToParts(t).map((t=>!s&&"currency"===t.type||n&&("decimal"===t.type||"fraction"===t.type)?"":t.value)).join("")}#V(t,e){const{decimalSeparator:i,roundToClosestFractionDigits:s,minimumFractionDigits:n,maximumFractionDigits:r,numberFormat:l}=e,[o]=l.split(i),[c,a=""]=t.toString().split("."),u=this.#H(c,o);let h=a;const d=h.length;if(d>0){const t=r>0,e=n>0;if(s&&h){let i;i=t&&d>r?r:e&&d<n?n:d,h=this.#W(Number(`0.${h}`),i).toString().replace("0.","")}t&&h&&(h=h.slice(0,r))}h.length<n&&(h=h.padEnd(n,"0"));let p="";return p=h?`${u}${i}${h}`:u,p}#H(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i="",s=t.length-1;for(let n=e.length-1;n>=0;n--){const r=e[n],l=t[s];if(!l)break;"#"===r?(i=l+i,s--):i=r+i}return s>=0&&(i=t.substring(0,s+1)+i),i}#M(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const{decimalSeparator:e}=this.#g.valueFormatOptions,i=new RegExp(`[^0-9${e}]`,"g");return t.replace(i,"")}#v(t){return this.#e.querySelector(t)}#I(t,e,i){t.addEventListener(e,i),this.#E.push({selector:t,eventType:e,cb:i})}#A(){this.#u.value&&this.#R(this.#u,"input")}#w(t){const e=this.#m.activeElement;let i=null;const s=this.#P();if(t.target!==this.#u){if(s){const s=Number(e.dataset.index||-1);if("ArrowDown"===t.key||!t.shiftKey&&"Tab"===t.key){if(t.preventDefault(),e===this.#c)i=this.#v(".option:not(.disabled-opt)");else if(e.classList.contains("option")){const t=this.#U(s,"next"),e=this.#_(t);if(e)i=e;else if(t+1<this.#p.length){var n;null===(n=this.virtualOptionList)||void 0===n||n.scrollToIndex(t,"center"),setTimeout((()=>{const e=this.#_(t);e&&e.focus()}),0)}}}else if("ArrowUp"===t.key||t.shiftKey&&"Tab"===t.key){if(t.preventDefault(),e===this.#c)i=this.#n,this.#P()&&this.setMenu({open:!1});else if(e.classList.contains("option")){const t=this.#U(s,"previous"),e=this.#_(t);if(e)i=e;else if(t>0){var r;null===(r=this.virtualOptionList)||void 0===r||r.scrollToIndex(t,"center"),setTimeout((()=>{const e=this.#_(t);e&&e.focus()}),0)}else e||(i=this.#c)}}else"Escape"===t.key&&this.setMenu({open:!1})}else if(t.key>="a"&&t.key<="z"){clearTimeout(this.#b),this.#C+=t.key,this.#b=setTimeout((()=>{this.#C=""}),300);const e=this.#g.options.find((t=>!t.disabled&&t.lbl.toLowerCase().startsWith(this.#C)));e&&this.setSelectedCurrencyItem(e.i)}else if("ArrowDown"===t.key||"ArrowUp"===t.key){const e=this.#z(),i="ArrowDown"===t.key?"next":"previous",s=this.#U(e,i);s>-1&&s<this.#g.options.length&&(this.value=this.#g.options[s].val)}i&&i.focus()}}#R(t,e){const i=new Event(e);t.dispatchEvent(i)}#$(){this.#u.value="",this.#L(this.#u,"data-num-value",""),this.setSelectedCurrencyItem(this.#g.defaultCurrencyKey),this.#R(this.#u,"input")}#_(t){return this.#v(`.${this.fieldKey}-option-list .option[data-index="${t}"]`)}#U(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,e=arguments.length>1?arguments[1]:void 0;if("next"===e){const e=this.#g.options.length;for(let i=t+1;i<e;i++)if(!this.#g.options[i].disabled)return i}else if("previous"===e)for(let e=t-1;e>=0;e--)if(!this.#g.options[e].disabled)return e}#j(t){t.target.contains(this.#e)&&this.setMenu({open:!1})}#q(t){var e;return(null===(e=t.match(/[a-zA-Z]+/))||void 0===e?void 0:e[0])||""}#F(t,e){const i=this.#q(e),s=this.#g.options.find((t=>t.i===i));if((i&&s||!i)&&t!==e){this.setSelectedCurrencyItem(i||this.#g.defaultCurrencyKey);const{decimalSeparator:t}=this.#g.valueFormatOptions,[s,n]=e.split(t),r=this.#M(s),l=this.#M(n),o=l?`${r}.${l}`:r;this.#L(this.#u,"data-num-value",o),this.#S()}"undefined"!=typeof bit_conditionals&&bit_conditionals({target:this.#i})}#O(t){const e=Number(t.target.value),{minValue:i,maxValue:s}=this.#g;if(e<i||e>s)return!1;this.#L(this.#u,"data-num-value",e),this.#g.selectedCurrencyClearable&&(this.#s.style.display=e?"grid":"none")}#z(){const t=this.#p.findIndex((t=>t.i===this.#o));return-1===t?0:t}#B(){return this.#g.options.find((t=>t.i===this.#o))}#Z(t){return this.#m.createElement(t)}#G(t,e){t.classList.add(e)}#J(t,e){t.textContent=e}#L(t,e,i){var s;null==t||null===(s=t.setAttribute)||void 0===s||s.call(t,e,i)}#Q(t,e){const i=e.length;if(i)for(let s=0;s<i;s+=1)this.#L(t,e[s].key,e[s].value)}#k(){const t=this.#z();this.virtualOptionList=new bit_virtualized_list(this.#d,{height:this.#g.maxHeight,rowCount:this.#p.length,rowHeight:31,initialIndex:-1===t?0:t,renderRow:t=>{const e=this.#p[t],i=this.#Z("li");if(this.#L(i,"data-key",e.i),this.#L(i,"data-index",t),"option"in this.#g.attributes){const t=this.#g.attributes.option;this.#Q(i,t)}if(!e.i)return this.#J(i,e.lbl),this.#G(i,"opt-not-found"),i;if(this.#G(i,"option"),"option"in this.#g.classNames){const t=this.#g.classNames.option;t&&this.#G(i,t)}const s=this.#Z("span");if("opt-lbl-wrp"in this.#g.attributes){const t=this.#g.attributes["opt-lbl-wrp"];this.#Q(s,t)}if(this.#G(s,"opt-lbl-wrp"),"opt-lbl-wrp"in this.#g.classNames){const t=this.#g.classNames["opt-lbl-wrp"];t&&this.#G(s,t)}if(this.#g.optionFlagImage){const t=this.#Z("img");if("opt-icn"in this.#g.attributes){const e=this.#g.attributes["opt-icn"];this.#Q(t,e)}if(this.#G(t,"opt-icn"),"opt-icn"in this.#g.classNames){const e=this.#g.classNames["opt-icn"];e&&this.#G(t,e)}t.src=`${this.#f}${e.img}`,t.alt=`${e.lbl} flag image`,t.loading="lazy",this.#L(t,"aria-hidden",!0),s.append(t)}const n=this.#Z("span");if("opt-lbl"in this.#g.attributes){const t=this.#g.attributes["opt-lbl"];this.#Q(n,t)}if(this.#G(n,"opt-lbl"),"opt-lbl"in this.#g.classNames){const t=this.#g.classNames["opt-lbl"];t&&this.#G(n,t)}this.#J(n,e.lbl),s.append(n);const r=this.#Z("span");if("opt-suffix"in this.#g.attributes){const t=this.#g.attributes["opt-suffix"];this.#Q(r,t)}if(this.#G(r,"opt-suffix"),"opt-suffix"in this.#g.classNames){const t=this.#g.classNames["opt-suffix"];t&&this.#G(r,t)}return this.#J(r,e.i),this.#L(i,"tabindex",this.#P()?"0":"-1"),this.#L(i,"role","option"),this.#L(i,"aria-posinset",t+1),this.#L(i,"aria-setsize",this.#p.length),this.#I(i,"click",(t=>{this.setSelectedCurrencyItem(t.currentTarget.dataset.key)})),this.#I(i,"keyup",(t=>{"Enter"===t.key&&this.setSelectedCurrencyItem(t.currentTarget.dataset.key)})),e.disabled&&this.#G(i,"disabled-opt"),i.append(s,r),this.#o===e.i?(this.#G(i,"selected-opt"),this.#L(i,"aria-selected",!0)):this.#L(i,"aria-selected",!1),i}})}#X(){this.#o="",this.#g.selectedFlagImage&&(this.#l.src=this.#t),this.value="",this.#Y()}setSelectedCurrencyItem(t){if(this.#o=t,!this.#o)return void this.#X();const e=this.#B();e&&(this.#g.selectedFlagImage&&(this.#l.src=`${this.#f}${e.img}`),this.setMenu({open:!1}),this.#S())}#Y(){var t,e;null===(t=this.virtualOptionList)||void 0===t||t.setRowCount(this.#p.length),null===(e=this.virtualOptionList)||void 0===e||e.scrollToIndex(this.#z())}#tt(t){this.#c.value=t}#T(t){if("Enter"===t.key&&this.#p.length){var e;const t=null===(e=this.#v(`.${this.fieldKey}option`))||void 0===e?void 0:e.dataset.key;this.setSelectedCurrencyItem(t),this.searchOptions("")}else this.searchOptions(t.target.value)}searchOptions(t){this.#tt(t);let e=[];t?(e=this.#g.options.filter((e=>{const i=t.toLowerCase(),s=(e.lbl||"").toLowerCase(),n=(e.val||"").toLowerCase(),r=(e.i||"").toLowerCase();return!!s.includes(i)||!!n.includes(i)||!!r.includes(i)||void 0})),e.length||(e=[{i:0,lbl:this.#g.noCurrencyFoundText}]),this.#p=e,this.#g.searchClearable&&(this.#h.style.display="grid")):(this.#p=this.#g.options,this.#g.searchClearable&&(this.#h.style.display="none")),this.#Y()}#P(){return this.#e.classList.contains("menu-open")}#et(){const t=this.#a.getBoundingClientRect(),e=t.top,i=this.#y.innerHeight-t.bottom;i<e&&i<this.#g.maxHeight?(this.#e.style.flexDirection="column-reverse",this.#e.style.bottom="0%"):(this.#e.style.flexDirection="column",this.#e.style.removeProperty("bottom"))}setMenu(t){let{open:e}=t;this.#r.style.maxHeight=`${e?this.#g.maxHeight:0}px`,e?(this.#et(),this.#G(this.#e,"menu-open"),this.#I(this.#m,"click",(t=>this.#j(t))),this.#L(this.#c,"tabindex",0),this.#L(this.#h,"tabindex",0),this.#L(this.#n,"aria-expanded",!0),this.#Y()):(this.#e.classList.remove("menu-open"),this.#m.removeEventListener("click",this.#j),this.searchOptions(""),this.#L(this.#c,"tabindex",-1),this.#L(this.#h,"tabindex",-1),this.#L(this.#n,"aria-expanded",!1))}#x(t){"Space"===t.code&&(this.#c.focus(),this.setMenu({open:!0})),"click"===t.type&&(this.#P()?this.setMenu({open:!1}):(this.#c.focus(),this.setMenu({open:!0})))}set value(t){this.#i.value=t}get value(){return this.#i.value}#it(){this.#E.forEach((t=>{let{selector:e,eventType:i,cb:s}=t;e.removeEventListener(i,s)}))}destroy(){this.#d.innerHTML="",this.value="",this.#it()}reset(){this.#X(),this.destroy(),this.init()}}}));
