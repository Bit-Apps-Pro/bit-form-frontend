!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).bit_currency_field=t()}(this,(function(){"use strict";return class{#e="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'/>";#t=null;#i=null;#s=null;#n=null;#r=null;#l=null;#o=null;#c=null;#a=null;#u=null;#h=null;#d=null;#p=[];#m;#y={};#f="";#g={maxHeight:370,searchCurrencyPlaceholder:"Search Currency",noCurrencyFoundText:"No Currency Found",selectedCurrencyClearable:!0,searchClearable:!0,selectedFlagImage:!0,defaultCurrencyKey:"",optionFlagImage:!0,inputFormatOptions:{formatter:"browser",showCurrencySymbol:!0},valueFormatOptions:{formatter:"browser",showCurrencySymbol:!0},attributes:{},classNames:{},assetsURL:""};#b=null;#C="";#E=[];constructor(e,t){Object.assign(this.#g,t),this.#y=t.window?t.window:window,this.#m=t.document?t.document:document,this.#t="string"==typeof e?this.#m.querySelector(e):e,this.#p=[...this.#g.options],this.fieldKey=this.#g.fieldKey,this.#f=t.assetsURL,this.init()}init(){this.#a=this.#v(`.${this.fieldKey}-currency-inner-wrp`),this.#u=this.#v(`.${this.fieldKey}-currency-amount-input`),this.#i=this.#v(`.${this.fieldKey}-currency-hidden-input`),this.#s=this.#v(`.${this.fieldKey}-input-clear-btn`),this.#l=this.#v(`.${this.fieldKey}-selected-currency-img`),this.#c=this.#v(`.${this.fieldKey}-opt-search-input`),this.#n=this.#v(`.${this.fieldKey}-dpd-wrp`),this.#r=this.#v(`.${this.fieldKey}-option-wrp`),this.#h=this.#v(`.${this.fieldKey}-search-clear-btn`),this.#d=this.#v(`.${this.fieldKey}-option-list`),this.#I(this.#t,"keydown",(e=>{this.#w(e)})),this.#I(this.#n,"click",(e=>{this.#x(e)})),this.#I(this.#n,"keyup",(e=>{this.#x(e)})),this.#I(this.#u,"focus",(e=>{this.#N()})),this.#I(this.#u,"blur",(e=>{this.#$()})),this.#I(this.#u,"input",(e=>{this.#S(e)})),observeElm(this.#i,"value",((e,t)=>{this.#O(e,t)})),this.#g.selectedCurrencyClearable&&this.#I(this.#s,"click",(e=>{this.#F(e)})),this.#A(),this.#K(),this.#g.defaultCurrencyKey&&this.setSelectedCurrencyItem(this.#g.defaultCurrencyKey),this.#g.searchClearable&&(this.#c.style.paddingRight="30px",this.#h.style.display="block",this.#I(this.#h,"click",(()=>{this.searchOptions("")}))),this.#c.value="",this.#I(this.#c,"keyup",(e=>{this.#k(e)}))}#N(){this.#T(this.#u,"type","number"),this.#u.value=this.#u.dataset.numValue}#L(e){const t=10**((arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)||0);return Math.round(e*t)/t}#$(){this.#T(this.#u,"type","text");const e=Number(this.#u.dataset.numValue);if(!e||Number.isNaN(e))return void(this.#u.value="");const{inputFormatOptions:t,valueFormatOptions:i}=this.#g,s=this.#W(e,t);this.#u.value=s,this.value=this.#W(e,i)}#W(e,t){const i=this.#B(),{defaultCurrencyKey:s}=this.#g,{formatter:n,roundToClosestInteger:r,showCurrencySymbol:l,currencyPosition:o,symbolPosition:c}=t,a=(null==i?void 0:i.i)||s;r&&(e=this.#L(e));let u="";return"browser"===n?u=this.#D(e,a,t):"custom"!==n&&n?"none"===n&&(u=e):u=this.#V(e,t),"left-number"===c?u=`${(null==i?void 0:i.symbol)||""}${u}`:"right-number"===c&&(u=`${u}${(null==i?void 0:i.symbol)||""}`),l&&("left"===o?u=`${l?`${a} `:""}${u}`:"right"===o&&(u=`${u}${l?` ${a}`:""}`)),"left-currency"===c?u=`${(null==i?void 0:i.symbol)||""}${u}`:"right-currency"===c&&(u=`${u}${(null==i?void 0:i.symbol)||""}`),u}#D(e,t,i){const{showCurrencySymbol:s,roundToClosestInteger:n}=i;return new Intl.NumberFormat(navigator.language,{style:"currency",currency:t}).formatToParts(e).map((e=>!s&&"currency"===e.type||n&&("decimal"===e.type||"fraction"===e.type)?"":e.value)).join("")}#V(e,t){const{decimalSeparator:i,roundToClosestFractionDigits:s,minimumFractionDigits:n,maximumFractionDigits:r,numberFormat:l}=t,[o]=l.split(i),[c,a=""]=e.toString().split("."),u=this.#H(c,o);let h=a;const d=h.length;if(d>0){const e=r>0,t=n>0;if(s&&h){let i;i=e&&d>r?r:t&&d<n?n:d,h=this.#L(Number(`0.${h}`),i).toString().replace("0.","")}e&&h&&(h=h.slice(0,r))}h.length<n&&(h=h.padEnd(n,"0"));let p="";return p=h?`${u}${i}${h}`:u,p}#H(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i="",s=e.length-1;for(let n=t.length-1;n>=0;n--){const r=t[n],l=e[s];if(!l)break;"#"===r?(i=l+i,s--):i=r+i}return s>=0&&(i=e.substring(0,s+1)+i),i}#M(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const{decimalSeparator:t}=this.#g.valueFormatOptions,i=new RegExp(`[^0-9${t}]`,"g");return e.replace(i,"")}#v(e){return this.#t.querySelector(e)}#I(e,t,i){e.addEventListener(t,i),this.#E.push({selector:e,eventType:t,cb:i})}#A(){this.#u.value&&this.#R(this.#u,"input")}#w(e){const t=this.#m.activeElement;let i=null;const s=this.#P();if(e.target!==this.#u){if(s){const s=Number(t.dataset.index||-1);if("ArrowDown"===e.key||!e.shiftKey&&"Tab"===e.key){if(e.preventDefault(),t===this.#c)i=this.#v(`.${this.fieldKey}-option:not(.${this.fieldKey}-disabled-opt)`);else if(t.classList.contains("option")){const e=this.#U(s,"next"),t=this.#z(e);if(t)i=t;else if(e+1<this.#p.length){var n;null===(n=this.virtualOptionList)||void 0===n||n.scrollToIndex(e,"center"),setTimeout((()=>{const t=this.#z(e);t&&t.focus()}),0)}}}else if("ArrowUp"===e.key||e.shiftKey&&"Tab"===e.key){if(e.preventDefault(),t===this.#c)i=this.#n,this.#P()&&this.setMenu({open:!1});else if(t.classList.contains("option")){const e=this.#U(s,"previous"),t=this.#z(e);if(t)i=t;else if(e>0){var r;null===(r=this.virtualOptionList)||void 0===r||r.scrollToIndex(e,"center"),setTimeout((()=>{const t=this.#z(e);t&&t.focus()}),0)}else t||(i=this.#c)}}else"Escape"===e.key&&this.setMenu({open:!1})}else if(e.key>="a"&&e.key<="z"){clearTimeout(this.#b),this.#C+=e.key,this.#b=setTimeout((()=>{this.#C=""}),300);const t=this.#g.options.find((e=>!e.disabled&&e.lbl.toLowerCase().startsWith(this.#C)));t&&this.setSelectedCurrencyItem(t.i)}else if("ArrowDown"===e.key||"ArrowUp"===e.key){const t=this.#j(),i="ArrowDown"===e.key?"next":"previous",s=this.#U(t,i);s>-1&&s<this.#g.options.length&&(this.value=this.#g.options[s].val)}i&&i.focus()}}#R(e,t){const i=new Event(t);e.dispatchEvent(i)}#F(){this.#u.value="",this.#T(this.#u,"data-num-value",""),this.setSelectedCurrencyItem(this.#g.defaultCurrencyKey),this.#R(this.#u,"input")}#z(e){return this.#v(`.${this.fieldKey}-option-list .${this.fieldKey}-option[data-index="${e}"]`)}#U(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1?arguments[1]:void 0;if("next"===t){const t=this.#g.options.length;for(let i=e+1;i<t;i++)if(!this.#g.options[i].disabled)return i}else if("previous"===t)for(let t=e-1;t>=0;t--)if(!this.#g.options[t].disabled)return t}#_(e){e.target.contains(this.#t)&&this.setMenu({open:!1})}#q(e){var t;return(null===(t=e.match(/[a-zA-Z]+/))||void 0===t?void 0:t[0])||""}#O(e,t){const i=this.#q(t),s=this.#g.options.find((e=>e.i===i));if((i&&s||!i)&&e!==t){this.setSelectedCurrencyItem(i||this.#g.defaultCurrencyKey);const{decimalSeparator:e}=this.#g.valueFormatOptions,[s,n]=t.split(e),r=this.#M(s),l=this.#M(n),o=l?`${r}.${l}`:r;this.#T(this.#u,"data-num-value",o),this.#$()}}#S(e){const t=Number(e.target.value),{minValue:i,maxValue:s}=this.#g;if(t<i||t>s)return!1;this.#T(this.#u,"data-num-value",t),this.#g.selectedCurrencyClearable&&(this.#s.style.display=t?"grid":"none")}#j(){const e=this.#p.findIndex((e=>e.i===this.#o));return-1===e?0:e}#B(){return this.#g.options.find((e=>e.i===this.#o))}#Z(e){return this.#m.createElement(e)}#G(e,t){e.classList.add(t)}#J(e,t){e.textContent=t}#T(e,t,i){var s;null==e||null===(s=e.setAttribute)||void 0===s||s.call(e,t,i)}#Q(e,t){const i=Object.keys(t),s=i.length;if(s)for(let n=0;n<s;n+=1)this.#T(e,i[n],t[i[n]])}#K(){const e=this.#j();this.virtualOptionList=new bit_virtualized_list(this.#d,{height:this.#g.maxHeight,rowCount:this.#p.length,rowHeight:31,initialIndex:-1===e?0:e,renderRow:e=>{const t=this.#p[e],i=this.#Z("li");if(this.#T(i,"data-key",t.i),this.#T(i,"data-index",e),"option"in this.#g.attributes){const e=this.#g.attributes.option;this.#Q(i,e)}if(!t.i)return this.#J(i,t.lbl),this.#G(i,`${this.fieldKey}-opt-not-found`),i;if(this.#G(i,`${this.fieldKey}-option`),"option"in this.#g.classNames){const e=this.#g.classNames.option;e&&this.#G(i,e)}const s=this.#Z("span");if("opt-lbl-wrp"in this.#g.attributes){const e=this.#g.attributes["opt-lbl-wrp"];this.#Q(s,e)}if(this.#G(s,`${this.fieldKey}-opt-lbl-wrp`),"opt-lbl-wrp"in this.#g.classNames){const e=this.#g.classNames["opt-lbl-wrp"];e&&this.#G(s,e)}if(this.#g.optionFlagImage){const e=this.#Z("img");if("opt-icn"in this.#g.attributes){const t=this.#g.attributes["opt-icn"];this.#Q(e,t)}if(this.#G(e,`${this.fieldKey}-opt-icn`),"opt-icn"in this.#g.classNames){const t=this.#g.classNames["opt-icn"];t&&this.#G(e,t)}e.src=`${this.#f}${t.img}`,e.alt=`${t.lbl} flag image`,e.loading="lazy",this.#T(e,"aria-hidden",!0),s.append(e)}const n=this.#Z("span");if("opt-lbl"in this.#g.attributes){const e=this.#g.attributes["opt-lbl"];this.#Q(n,e)}if(this.#G(n,`${this.fieldKey}-opt-lbl`),"opt-lbl"in this.#g.classNames){const e=this.#g.classNames["opt-lbl"];e&&this.#G(n,e)}this.#J(n,t.lbl),s.append(n);const r=this.#Z("span");if("opt-suffix"in this.#g.attributes){const e=this.#g.attributes["opt-suffix"];this.#Q(r,e)}if(this.#G(r,`${this.fieldKey}-opt-suffix`),"opt-suffix"in this.#g.classNames){const e=this.#g.classNames["opt-suffix"];e&&this.#G(r,e)}return this.#J(r,t.i),this.#T(i,"tabindex",this.#P()?"0":"-1"),this.#T(i,"role","option"),this.#T(i,"aria-posinset",e+1),this.#T(i,"aria-setsize",this.#p.length),this.#I(i,"click",(e=>{this.setSelectedCurrencyItem(e.currentTarget.dataset.key)})),this.#I(i,"keyup",(e=>{"Enter"===e.key&&this.setSelectedCurrencyItem(e.currentTarget.dataset.key)})),t.disabled&&this.#G(i,`${this.fieldKey}-disabled-opt`),i.append(s,r),this.#o===t.i?(this.#G(i,`${this.fieldKey}-selected-opt`),this.#T(i,"aria-selected",!0)):this.#T(i,"aria-selected",!1),i}})}#X(){this.#o="",this.#g.selectedFlagImage&&(this.#l.src=this.#e),this.value="",this.#Y()}setSelectedCurrencyItem(e){if(this.#o=e,!this.#o)return void this.#X();const t=this.#B();t&&(this.#g.selectedFlagImage&&(this.#l.src=`${this.#f}${t.img}`),this.setMenu({open:!1}),this.#$())}#Y(){var e,t;null===(e=this.virtualOptionList)||void 0===e||e.setRowCount(this.#p.length),null===(t=this.virtualOptionList)||void 0===t||t.scrollToIndex(this.#j())}#ee(e){this.#c.value=e}#k(e){if("Enter"===e.key&&this.#p.length){var t;const e=null===(t=this.#v(`.${this.fieldKey}option`))||void 0===t?void 0:t.dataset.key;this.setSelectedCurrencyItem(e),this.searchOptions("")}else this.searchOptions(e.target.value)}searchOptions(e){this.#ee(e);let t=[];e?(t=this.#g.options.filter((t=>{const i=e.toLowerCase(),s=(t.lbl||"").toLowerCase(),n=(t.val||"").toLowerCase(),r=(t.i||"").toLowerCase();return!!s.includes(i)||!!n.includes(i)||!!r.includes(i)||void 0})),t.length||(t=[{i:0,lbl:this.#g.noCurrencyFoundText}]),this.#p=t,this.#g.searchClearable&&(this.#h.style.display="grid")):(this.#p=this.#g.options,this.#g.searchClearable&&(this.#h.style.display="none")),this.#Y()}#P(){return this.#t.classList.contains(`${this.fieldKey}-menu-open`)}#te(){const e=this.#a.getBoundingClientRect(),t=e.top,i=this.#y.innerHeight-e.bottom;i<t&&i<this.#g.maxHeight?(this.#t.style.flexDirection="column-reverse",this.#t.style.bottom="0%"):(this.#t.style.flexDirection="column",this.#t.style.removeProperty("bottom"))}setMenu(e){let{open:t}=e;this.#r.style.maxHeight=`${t?this.#g.maxHeight:0}px`,t?(this.#te(),this.#G(this.#t,`${this.fieldKey}-menu-open`),this.#I(this.#m,"click",(e=>this.#_(e))),this.#T(this.#c,"tabindex",0),this.#T(this.#h,"tabindex",0),this.#T(this.#n,"aria-expanded",!0),this.#Y()):(this.#t.classList.remove(`${this.fieldKey}-menu-open`),this.#m.removeEventListener("click",this.#_),this.searchOptions(""),this.#T(this.#c,"tabindex",-1),this.#T(this.#h,"tabindex",-1),this.#T(this.#n,"aria-expanded",!1))}#x(e){"Space"===e.code&&(this.#c.focus(),this.setMenu({open:!0})),"click"===e.type&&(this.#P()?this.setMenu({open:!1}):(this.#c.focus(),this.setMenu({open:!0})))}set value(e){this.#i.value=e}get value(){return this.#i.value}#ie(){this.#E.forEach((e=>{let{selector:t,eventType:i,cb:s}=e;t.removeEventListener(i,s)}))}destroy(){this.#d.innerHTML="",this.value="",this.#ie()}reset(){this.init()}}}));
