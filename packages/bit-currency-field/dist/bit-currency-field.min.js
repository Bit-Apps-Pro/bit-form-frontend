!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).bit_currency_field=t()}(this,(function(){"use strict";return class{#e="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'/>";#t=null;#i=null;#s=null;#n=null;#r=null;#l=null;#o=null;#c=null;#a=null;#u=null;#h=null;#d=null;#p=[];#m={maxHeight:370,searchCurrencyPlaceholder:"Search Currency",noCurrencyFoundText:"No Currency Found",selectedCurrencyClearable:!0,searchClearable:!0,selectedFlagImage:!0,defaultCurrencyKey:"",optionFlagImage:!0,inputFormatOptions:{formatter:"browser",showCurrencySymbol:!0},valueFormatOptions:{formatter:"browser",showCurrencySymbol:!0},attributes:{},classNames:{},assetsURL:""};#y=null;#f="";#g=[];constructor(e,t,i){Object.assign(this.#m,t),this.#t="string"==typeof e?document.querySelector(e):e,this.#p=[...this.#m.options],this.fieldKey=this.#m.fieldKey,this.init()}init(){this.#a=this.#b(`.${this.fieldKey}-currency-inner-wrp`),this.#u=this.#b(`.${this.fieldKey}-currency-amount-input`),this.#i=this.#b(`.${this.fieldKey}-currency-hidden-input`),this.#s=this.#b(`.${this.fieldKey}-input-clear-btn`),this.#l=this.#b(`.${this.fieldKey}-selected-currency-img`),this.#c=this.#b(`.${this.fieldKey}-opt-search-input`),this.#n=this.#b(`.${this.fieldKey}-dpd-wrp`),this.#r=this.#b(`.${this.fieldKey}-option-wrp`),this.#h=this.#b(`.${this.fieldKey}-search-clear-btn`),this.#d=this.#b(`.${this.fieldKey}-option-list`),this.#C(this.#t,"keydown",(e=>{this.#E(e)})),this.#C(this.#n,"click",(e=>{this.#v(e)})),this.#C(this.#n,"keyup",(e=>{this.#v(e)})),this.#C(this.#u,"focus",(e=>{this.#I()})),this.#C(this.#u,"blur",(e=>{this.#w()})),this.#C(this.#u,"input",(e=>{this.#x(e)})),function(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const n=Object.getPrototypeOf(e);if(Object.prototype.hasOwnProperty.call(n,t)){const r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,{configurable:!0,get(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return r.get.apply(this,t)},set(){const e=this[t];for(var n=arguments.length,l=new Array(n),o=0;o<n;o++)l[o]=arguments[o];r.set.apply(this,l);const c=this[t];return"function"==typeof i&&setTimeout(i.bind(this,e,c),s),c}})}}(this.#i,"value",((e,t)=>{this.#N(e,t)})),this.#m.selectedCurrencyClearable&&this.#C(this.#s,"click",(e=>{this.#$(e)})),this.#O(),this.#S(),this.#m.defaultCurrencyKey&&this.setSelectedCurrencyItem(this.#m.defaultCurrencyKey),this.#m.searchClearable&&(this.#c.style.paddingRight="30px",this.#h.style.display="block",this.#C(this.#h,"click",(()=>{this.searchOptions("")}))),this.#c.value="",this.#C(this.#c,"keyup",(e=>{this.#A(e)}))}#I(){this.#F(this.#u,"type","number"),this.#u.value=this.#u.dataset.numValue}#K(e){const t=10**((arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)||0);return Math.round(e*t)/t}#w(){this.#F(this.#u,"type","text");const e=Number(this.#u.dataset.numValue);if(!e||Number.isNaN(e))return void(this.#u.value="");const{inputFormatOptions:t,valueFormatOptions:i}=this.#m,s=this.#k(e,t);this.#u.value=s,this.value=this.#k(e,i)}#k(e,t){const i=this.#T(),{defaultCurrencyKey:s}=this.#m,{formatter:n,roundToClosestInteger:r,showCurrencySymbol:l,currencyPosition:o,symbolPosition:c}=t,a=(null==i?void 0:i.i)||s;r&&(e=this.#K(e));let u="";return"browser"===n?u=this.#L(e,a,t):"custom"!==n&&n?"none"===n&&(u=e):u=this.#W(e,t),"left-number"===c?u=`${(null==i?void 0:i.symbol)||""}${u}`:"right-number"===c&&(u=`${u}${(null==i?void 0:i.symbol)||""}`),l&&("left"===o?u=`${l?`${a} `:""}${u}`:"right"===o&&(u=`${u}${l?` ${a}`:""}`)),"left-currency"===c?u=`${(null==i?void 0:i.symbol)||""}${u}`:"right-currency"===c&&(u=`${u}${(null==i?void 0:i.symbol)||""}`),u}#L(e,t,i){const{showCurrencySymbol:s,roundToClosestInteger:n}=i;return new Intl.NumberFormat(navigator.language,{style:"currency",currency:t}).formatToParts(e).map((e=>!s&&"currency"===e.type||n&&("decimal"===e.type||"fraction"===e.type)?"":e.value)).join("")}#W(e,t){const{decimalSeparator:i,roundToClosestFractionDigits:s,minimumFractionDigits:n,maximumFractionDigits:r,numberFormat:l}=t,[o]=l.split(i),[c,a=""]=e.toString().split("."),u=this.#B(c,o);let h=a;const d=h.length;if(d>0){const e=r>0,t=n>0;if(s&&h){let i;i=e&&d>r?r:t&&d<n?n:d,h=this.#K(Number(`0.${h}`),i).toString().replace("0.","")}e&&h&&(h=h.slice(0,r))}h.length<n&&(h=h.padEnd(n,"0"));let p="";return p=h?`${u}${i}${h}`:u,p}#B(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i="",s=e.length-1;for(let n=t.length-1;n>=0;n--){const r=t[n],l=e[s];if(!l)break;"#"===r?(i=l+i,s--):i=r+i}return s>=0&&(i=e.substring(0,s+1)+i),i}#D(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const{decimalSeparator:t}=this.#m.valueFormatOptions,i=new RegExp(`[^0-9${t}]`,"g");return e.replace(i,"")}#b(e){return this.#t.querySelector(e)}#C(e,t,i){e.addEventListener(t,i),this.#g.push({selector:e,eventType:t,cb:i})}#O(){this.#u.value&&this.#V(this.#u,"input")}#E(e){const t=document.activeElement;let i=null;const s=this.#H();if(e.target!==this.#u){if(s){const s=Number(t.dataset.index||-1);if("ArrowDown"===e.key||!e.shiftKey&&"Tab"===e.key){if(e.preventDefault(),t===this.#c)i=this.#b(`.${this.fieldKey}-option:not(.${this.fieldKey}-disabled-opt)`);else if(t.classList.contains("option")){const e=this.#M(s,"next"),t=this.#P(e);if(t)i=t;else if(e+1<this.#p.length){var n;null===(n=this.virtualOptionList)||void 0===n||n.scrollToIndex(e,"center"),setTimeout((()=>{const t=this.#P(e);t&&t.focus()}),0)}}}else if("ArrowUp"===e.key||e.shiftKey&&"Tab"===e.key){if(e.preventDefault(),t===this.#c)i=this.#n,this.#H()&&this.setMenu({open:!1});else if(t.classList.contains("option")){const e=this.#M(s,"previous"),t=this.#P(e);if(t)i=t;else if(e>0){var r;null===(r=this.virtualOptionList)||void 0===r||r.scrollToIndex(e,"center"),setTimeout((()=>{const t=this.#P(e);t&&t.focus()}),0)}else t||(i=this.#c)}}else"Escape"===e.key&&this.setMenu({open:!1})}else if(e.key>="a"&&e.key<="z"){clearTimeout(this.#y),this.#f+=e.key,this.#y=setTimeout((()=>{this.#f=""}),300);const t=this.#m.options.find((e=>!e.disabled&&e.lbl.toLowerCase().startsWith(this.#f)));t&&this.setSelectedCurrencyItem(t.i)}else if("ArrowDown"===e.key||"ArrowUp"===e.key){const t=this.#R(),i="ArrowDown"===e.key?"next":"previous",s=this.#M(t,i);s>-1&&s<this.#m.options.length&&(this.value=this.#m.options[s].val)}i&&i.focus()}}#V(e,t){const i=new Event(t);e.dispatchEvent(i)}#$(){this.#u.value="",this.#F(this.#u,"data-num-value",""),this.setSelectedCurrencyItem(this.#m.defaultCurrencyKey),this.#V(this.#u,"input")}#P(e){return this.#b(`.${this.fieldKey}-option-list .${this.fieldKey}-option[data-index="${e}"]`)}#M(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1?arguments[1]:void 0;if("next"===t){const t=this.#m.options.length;for(let i=e+1;i<t;i++)if(!this.#m.options[i].disabled)return i}else if("previous"===t)for(let t=e-1;t>=0;t--)if(!this.#m.options[t].disabled)return t}#j(e){e.target.contains(this.#t)&&this.setMenu({open:!1})}#z(e){var t;return(null===(t=e.match(/[a-zA-Z]+/))||void 0===t?void 0:t[0])||""}#N(e,t){const i=this.#z(t),s=this.#m.options.find((e=>e.i===i));if((i&&s||!i)&&e!==t){this.setSelectedCurrencyItem(i||this.#m.defaultCurrencyKey);const{decimalSeparator:e}=this.#m.valueFormatOptions,[s,n]=t.split(e),r=this.#D(s),l=this.#D(n),o=l?`${r}.${l}`:r;this.#F(this.#u,"data-num-value",o),this.#w()}}#x(e){const t=Number(e.target.value),{minValue:i,maxValue:s}=this.#m;if(t<i||t>s)return!1;this.#F(this.#u,"data-num-value",t),this.#m.selectedCurrencyClearable&&(this.#s.style.display=t?"grid":"none")}#R(){const e=this.#p.findIndex((e=>e.i===this.#o));return-1===e?0:e}#T(){return this.#m.options.find((e=>e.i===this.#o))}#U(e){return document.createElement(e)}#_(e,t){e.classList.add(t)}#q(e,t){e.textContent=t}#F(e,t,i){var s;null==e||null===(s=e.setAttribute)||void 0===s||s.call(e,t,i)}#Z(e,t){const i=Object.keys(t),s=i.length;if(s)for(let n=0;n<s;n+=1)this.#F(e,i[n],t[i[n]])}#S(){const e=this.#R();this.virtualOptionList=new bit_virtualized_list(this.#d,{height:this.#m.maxHeight,rowCount:this.#p.length,rowHeight:31,initialIndex:-1===e?0:e,renderRow:e=>{const t=this.#p[e],i=this.#U("li");if(this.#F(i,"data-key",t.i),this.#F(i,"data-index",e),"option"in this.#m.attributes){const e=this.#m.attributes.option;this.#Z(i,e)}if(!t.i)return this.#q(i,t.lbl),this.#_(i,`${this.fieldKey}-opt-not-found`),i;if(this.#_(i,`${this.fieldKey}-option`),"option"in this.#m.classNames){const e=this.#m.classNames.option;e&&this.#_(i,e)}const s=this.#U("span");if("opt-lbl-wrp"in this.#m.attributes){const e=this.#m.attributes["opt-lbl-wrp"];this.#Z(s,e)}if(this.#_(s,`${this.fieldKey}-opt-lbl-wrp`),"opt-lbl-wrp"in this.#m.classNames){const e=this.#m.classNames["opt-lbl-wrp"];e&&this.#_(s,e)}if(this.#m.optionFlagImage){const e=this.#U("img");if("opt-icn"in this.#m.attributes){const t=this.#m.attributes["opt-icn"];this.#Z(e,t)}if(this.#_(e,`${this.fieldKey}-opt-icn`),"opt-icn"in this.#m.classNames){const t=this.#m.classNames["opt-icn"];t&&this.#_(e,t)}e.src=`${bits.assetsURL}${t.img}`,e.alt=`${t.lbl} flag image`,e.loading="lazy",this.#F(e,"aria-hidden",!0),s.append(e)}const n=this.#U("span");if("opt-lbl"in this.#m.attributes){const e=this.#m.attributes["opt-lbl"];this.#Z(n,e)}if(this.#_(n,`${this.fieldKey}-opt-lbl`),"opt-lbl"in this.#m.classNames){const e=this.#m.classNames["opt-lbl"];e&&this.#_(n,e)}this.#q(n,t.lbl),s.append(n);const r=this.#U("span");if("opt-suffix"in this.#m.attributes){const e=this.#m.attributes["opt-suffix"];this.#Z(r,e)}if(this.#_(r,`${this.fieldKey}-opt-suffix`),"opt-suffix"in this.#m.classNames){const e=this.#m.classNames["opt-suffix"];e&&this.#_(r,e)}return this.#q(r,t.i),this.#F(i,"tabindex",this.#H()?"0":"-1"),this.#F(i,"role","option"),this.#F(i,"aria-posinset",e+1),this.#F(i,"aria-setsize",this.#p.length),this.#C(i,"click",(e=>{this.setSelectedCurrencyItem(e.currentTarget.dataset.key)})),this.#C(i,"keyup",(e=>{"Enter"===e.key&&this.setSelectedCurrencyItem(e.currentTarget.dataset.key)})),t.disabled&&this.#_(i,`${this.fieldKey}-disabled-opt`),i.append(s,r),this.#o===t.i?(this.#_(i,`${this.fieldKey}-selected-opt`),this.#F(i,"aria-selected",!0)):this.#F(i,"aria-selected",!1),i}})}#G(){this.#o="",this.#m.selectedFlagImage&&(this.#l.src=this.#e),this.value="",this.#J()}setSelectedCurrencyItem(e){if(this.#o=e,!this.#o)return void this.#G();const t=this.#T();t&&(this.#m.selectedFlagImage&&(this.#l.src=`${bits.assetsURL}${t.img}`),this.setMenu({open:!1}),this.#w())}#J(){var e,t;null===(e=this.virtualOptionList)||void 0===e||e.setRowCount(this.#p.length),null===(t=this.virtualOptionList)||void 0===t||t.scrollToIndex(this.#R())}#Q(e){this.#c.value=e}#A(e){if("Enter"===e.key&&this.#p.length){var t;const e=null===(t=this.#b(`.${this.fieldKey}option`))||void 0===t?void 0:t.dataset.key;this.setSelectedCurrencyItem(e),this.searchOptions("")}else this.searchOptions(e.target.value)}searchOptions(e){this.#Q(e);let t=[];e?(t=this.#m.options.filter((t=>{const i=e.toLowerCase(),s=(t.lbl||"").toLowerCase(),n=(t.val||"").toLowerCase(),r=(t.i||"").toLowerCase();return!!s.includes(i)||!!n.includes(i)||!!r.includes(i)||void 0})),t.length||(t=[{i:0,lbl:this.#m.noCurrencyFoundText}]),this.#p=t,this.#m.searchClearable&&(this.#h.style.display="grid")):(this.#p=this.#m.options,this.#m.searchClearable&&(this.#h.style.display="none")),this.#J()}#H(){return this.#t.classList.contains(`${this.fieldKey}-menu-open`)}#X(){const e=this.#a.getBoundingClientRect(),t=e.top,i=window.innerHeight-e.bottom;i<t&&i<this.#m.maxHeight?(this.#t.style.flexDirection="column-reverse",this.#t.style.bottom="0%"):(this.#t.style.flexDirection="column",this.#t.style.removeProperty("bottom"))}setMenu(e){let{open:t}=e;this.#r.style.maxHeight=`${t?this.#m.maxHeight:0}px`,t?(this.#X(),this.#_(this.#t,`${this.fieldKey}-menu-open`),this.#C(document,"click",(e=>this.#j(e))),this.#F(this.#c,"tabindex",0),this.#F(this.#h,"tabindex",0),this.#F(this.#n,"aria-expanded",!0),this.#J()):(this.#t.classList.remove(`${this.fieldKey}-menu-open`),document.removeEventListener("click",this.#j),this.searchOptions(""),this.#F(this.#c,"tabindex",-1),this.#F(this.#h,"tabindex",-1),this.#F(this.#n,"aria-expanded",!1))}#v(e){"Space"===e.code&&(this.#c.focus(),this.setMenu({open:!0})),"click"===e.type&&(this.#H()?this.setMenu({open:!1}):(this.#c.focus(),this.setMenu({open:!0})))}set value(e){this.#i.value=e}get value(){return this.#i.value}#Y(){this.#g.forEach((e=>{let{selector:t,eventType:i,cb:s}=e;t.removeEventListener(i,s)}))}destroy(){this.#d.innerHTML="",this.value="",this.#Y()}}}));
