!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.bit_country_field=e():t.bit_country_field=e()}(self,(()=>(()=>{"use strict";var t={d:(e,s)=>{for(var i in s)t.o(s,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:s[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{default:()=>s});class s{#t;#e;#s;#i;#n;#l;#o="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'/>";#r;#a;#h;#d;#c="";#p=[];#u=!0;#m=!0;#y=!0;#C=!0;#b=!1;#g=!1;#E="";#f="Select a Country";#I="Search Country";#w="No Currency Found";#v=370;#O;#x={};#S=[];#L={};#A={};#W="";#T="";#F=null;#k="";#N=[];#$;constructor(t,e){this.#B(e),this.#t="string"==typeof t?this.#O.querySelector(t):t,this.fieldKey=this.#T,this.init()}#B(t){this.#T=t.fieldKey,this.#E=t.defaultValue,this.#f=t.placeholder,this.#I=t.searchPlaceholder||"Search Country",this.#w=t.noCountryFoundText||"No Country Found",this.#v=t.maxHeight||370,this.#u=t.selectedFlagImage,this.#m=t.selectedCountryClearable,this.#y=t.searchClearabl,this.#C=t.optionFlagImage,this.#b=t.detectCountryByIp,this.#g=t.detectCountryByGeo,this.#W=t.assetsURL,this.#$=t.onChange,this.#S=t.options,this.#p=[...this.#S],t.document?this.#O=t.document:this.#O=document,t.window?this.#x=t.window:this.#x=window}init(){this.#e=this.#K(`.${this.fieldKey}-country-hidden-input`),this.#s=this.#K(`.${this.fieldKey}-dpd-wrp`),this.#i=this.#K(`.${this.fieldKey}-selected-country-img`),this.#r=this.#K(`.${this.fieldKey}-opt-search-input`),this.#a=this.#K(`.${this.fieldKey}-search-clear-btn`),this.#h=this.#K(`.${this.fieldKey}-option-wrp`),this.#d=this.#K(`.${this.fieldKey}-option-list`),this.#b&&this.#H(),this.#g&&this.#R(),this.#E&&this.setSelectedCountryItem(this.#E),this.#M(),this.#P(),this.#D(),this.#u||this.#i?.remove(),this.#y&&(this.#r.style.paddingRight="25px",this.#a.style.display="none")}#P(){this.#V(this.#s,"click",(t=>{this.#j(t)})),this.#V(this.#s,"keyup",(t=>{this.#j(t)})),this.#V(this.#t,"keydown",(t=>{this.#_(t)})),this.#y&&this.#V(this.#a,"click",(()=>{this.searchOptions("")})),this.#V(this.#r,"keyup",(t=>{this.#U(t)})),function(t,e,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const n=Object.getPrototypeOf(t);if(Object.prototype.hasOwnProperty.call(n,e)){const l=Object.getOwnPropertyDescriptor(n,e);Object.defineProperty(t,e,{configurable:!0,get(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return l.get.apply(this,e)},set(){const t=this[e];for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];l.set.apply(this,o);const a=this[e];return"function"==typeof s&&setTimeout(s.bind(this,t,a),i),a}})}}(this.#e,"value",((t,e)=>{this.#G(t,e)}))}#M(){const t=this.#e.name,e=decodeURIComponent(`${this.#O.URL}`.replace(/\+/g,"%20")).replace(new RegExp(`.*${t}=([^&]*).*|(.*)`),"$1");e&&this.#G("",e)}#K(t){return this.#t.querySelector(t)||console.error("selector not found",t)}#z(t){return this.#t.querySelectorAll(t)||console.error("selector not found",t)}#V(t,e,s){t.addEventListener(e,s),this.#N.push({selector:t,eventType:e,cb:s})}#H(){fetch("https://www.cloudflare.com/cdn-cgi/trace").then((t=>t.text())).then((t=>{const e=t.trim().split("\n").reduce(((t,e)=>{const[s,i]=e.split("=");return t[s]=i,t}),{});this.setSelectedCountryItem(e?.loc)}))}#R(){navigator.geolocation.getCurrentPosition((t=>{const{latitude:e,longitude:s}=t.coords;fetch(`http://api.geonames.org/countryCodeJSON?username=bitcodezoho1&lat=${e}&lng=${s}`).then((t=>t.json())).then((t=>{this.setSelectedCountryItem(t.countryCode)}))}))}#_(t){const e=this.#O.activeElement;let s=null;if(this.#q()){const i=Number(e.dataset.index||-1);if("ArrowDown"===t.key||!t.shiftKey&&"Tab"===t.key){if(t.preventDefault(),e===this.#r)s=this.#K(`.${this.fieldKey}-option:not(.disabled-opt)`);else if(e.classList.contains(`${this.fieldKey}-option`)){const t=this.#J(i,"next"),e=this.#Q(t);console.log("nextElm",e),e?s=e:t+1<this.#p.length&&(this.virtualOptionList?.scrollToIndex(t,"center"),setTimeout((()=>{const e=this.#Q(t);e&&e.focus()}),0))}}else if("ArrowUp"===t.key||t.shiftKey&&"Tab"===t.key){if(t.preventDefault(),e===this.#r)s=this.#s,this.#q()&&this.setMenu({open:!1});else if(e.classList.contains(`${this.fieldKey}-option`)){const t=this.#J(i,"previous"),e=this.#Q(t);e?s=e:t>0?(this.virtualOptionList?.scrollToIndex(t,"center"),setTimeout((()=>{const e=this.#Q(t);e&&e.focus()}),0)):e||(s=this.#r)}}else"Escape"===t.key&&this.setMenu({open:!1})}else if(t.key>="a"&&t.key<="z"){clearTimeout(this.#F),this.#k+=t.key,this.#F=setTimeout((()=>{this.#k=""}),300);const e=this.#S.find((t=>!t.disabled&&t.lbl.toLowerCase().startsWith(this.#k)));e&&this.setSelectedCountryItem(e.i)}else if("ArrowDown"===t.key||"ArrowUp"===t.key){const e=this.#X(),s="ArrowDown"===t.key?"next":"previous",i=this.#J(e,s);i>-1&&i<this.#S.length&&(this.value=this.#S[i].val)}s&&s.focus()}#Q(t){return this.#K(`.${this.fieldKey}-option-list .${this.fieldKey}-option[data-index="${t}"]`)}#J(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,e=arguments.length>1?arguments[1]:void 0;if("next"===e){const e=this.#S.length;for(let s=t+1;s<e;s+=1){if(!this.#S[s].disabled)return s}}else if("previous"===e)for(let e=t-1;e>=0;e-=1){if(!this.#S[e].disabled)return e}}#G(t,e){const s=this.#S.find((t=>t.val===e));s&&t!==e&&this.setSelectedCountryItem(s.i)}#Y(t){t.stopPropagation(),this.#c="",this.#u&&(this.#i.src=this.#o),this.#Z(this.#n,this.#f),this.#m&&(this.#l.style.display="none"),this.#tt(this.#s,"aria-label","Selected country cleared"),this.#s.focus(),this.value="",setTimeout((()=>{this.#tt(this.#s,"aria-label",this.#f)}),100),this.#et()}setSelectedCountryItem(t){if(this.#c=t,!this.#c)return;const e=this.#st();e&&(this.#n=this.#K(`.${this.fieldKey}-selected-country-lbl`),this.#m&&(this.#l=this.#m?this.#K(`.${this.fieldKey}-inp-clr-btn`):{}),this.#u&&this.#i&&(this.#i.src=`${this.#W}${e.img}`),this.#Z(this.#n,e.lbl),this.setMenu({open:!1}),this.value=e.val,this.#m&&(this.#l.style.display="grid",this.#V(this.#l,"click",(t=>{this.#Y(t)}))),this.#$&&this.#$(e.val),this.#tt(this.#s,"aria-label",`${e.lbl} selected`),setTimeout((()=>{this.#tt(this.#s,"aria-label",e.lbl)}),100))}#X(){return this.#p.findIndex((t=>t.i===this.#c))}#st(){return this.#S.find((t=>t.i===this.#c))}#it(t){return this.#O.createElement(t)}#nt(t,e){t.classList.add(e)}#Z(t,e){t.textContent=e}#tt(t,e,s){t?.setAttribute?.(e,s)}#et(){this.virtualOptionList?.setRowCount(this.#p.length);const t=this.#X();this.virtualOptionList?.scrollToIndex(-1===t?0:t)}#lt(t,e){const s=Object.keys(e),i=s.length;if(i)for(let n=0;n<i;n+=1)this.#tt(t,s[n],e[s[n]])}#ot=()=>27;#D(){const t=this.#ot(),e=this.#X();this.virtualOptionList=new bit_virtualized_list(this.#d,{height:this.#v,rowCount:this.#p.length,rowHeight:t,initialIndex:-1===e?0:e,renderRow:t=>{const e=this.#p[t],s=this.#it("li");if(this.#tt(s,"data-key",e.i),this.#tt(s,"data-index",t),"option"in this.#L){const t=this.#L.option;this.#lt(s,t)}if(!e.i)return this.#Z(s,e.lbl),this.#nt(s,"opt-not-found"),s;if(this.#nt(s,`${this.fieldKey}-option`),"option"in this.#A){const t=this.#A.option;t&&this.#nt(s,t)}const i=this.#it("span");if(this.#nt(i,`${this.fieldKey}-opt-lbl-wrp`),"opt-lbl-wrp"in this.#A){const t=this.#A["opt-lbl-wrp"];t&&this.#nt(i,t)}if("opt-lbl-wrp"in this.#L){const t=this.#L["opt-lbl-wrp"];this.#lt(i,t)}if(this.#C){const t=this.#it("img");if("opt-icn"in this.#L){const t=this.#L["opt-icn"];t&&this.#lt(i,t)}if(this.#nt(t,`${this.fieldKey}-opt-icn`),"opt-icn"in this.#A){const e=this.#A["opt-icn"];e&&this.#nt(t,e)}t.src=`${this.#W}${e.img}`,t.alt=`${e.lbl} flag image`,t.loading="lazy",this.#tt(t,"aria-hidden",!0),i.append(t)}const n=this.#it("span");if("opt-lbl"in this.#L){const t=this.#L["opt-lbl"];this.#lt(i,t)}if(this.#nt(n,`${this.fieldKey}-opt-lbl`),"opt-lbl"in this.#A){const t=this.#A["opt-lbl"];t&&this.#nt(n,t)}this.#Z(n,e.lbl),i.append(n);const l=this.#it("span");return this.#nt(l,"opt-prefix"),this.#Z(l,e.code),s.tabIndex=this.#q()?"0":"-1",this.#tt(s,"role","option"),this.#tt(s,"aria-posinset",t+1),this.#tt(s,"aria-setsize",this.#p.length),this.#V(s,"click",(t=>{this.setSelectedCountryItem(t.currentTarget.dataset.key)})),this.#V(s,"keyup",(t=>{"Enter"===t.key&&this.setSelectedCountryItem(t.currentTarget.dataset.key)})),e.disabled&&this.#nt(s,`${this.fieldKey}-disabled-opt`),s.append(i,l),this.#c===e.i?(this.#nt(s,"__fld-key__-selected-opt"),this.#tt(s,"aria-selected",!0)):this.#tt(s,"aria-selected",!1),s}})}#U(t){if("Enter"===t.key&&this.#p.length){const t=this.#p?.[0].i;t&&(this.setSelectedCountryItem(t),this.searchOptions(""))}else this.searchOptions(t.target.value)}searchOptions(t){this.#rt(t);let e=[];t?(e=this.#S.filter((e=>e.lbl.toLowerCase().includes(t.toLowerCase()))),e.length||(e=[{i:0,lbl:this.#w}]),this.#p=e,this.#y&&(this.#a.style.display="grid")):(this.#p=this.#S,this.#y&&(this.#a.style.display="none")),this.#et()}#rt(t){this.#r.value=t}#at(t){this.#t.contains(t.target)||this.setMenu({open:!1})}#q(){return this.#t.classList.contains("menu-open")}#ht(){const t=this.#x,e=this.#s.getBoundingClientRect(),s=e.top,i=t.innerHeight-e.bottom;i<s&&i<this.#v?(this.#t.style.flexDirection="column-reverse",this.#t.style.bottom="0%"):(this.#t.style.flexDirection="column",this.#t.style.removeProperty("bottom"))}setMenu(t){let{open:e}=t;this.#h.style.maxHeight=`${e?this.#v:0}px`,e?(this.#ht(),this.#t.classList.add("menu-open"),this.#V(this.#O,"click",(t=>this.#at(t))),this.#r.tabIndex="0",this.#a.tabIndex="0",this.#s.setAttribute("aria-expanded","true"),this.#tt(this.#d,"aria-hidden",!1),this.#tt(this.#r,"aria-hidden",!1),this.#et()):(this.#t.classList.remove("menu-open"),this.#O.removeEventListener("click",this.#at),this.searchOptions(""),this.#r.blur(),this.#r.tabIndex="-1",this.#a.tabIndex="-1",this.#s.setAttribute("aria-expanded","false"),this.#tt(this.#d,"aria-hidden",!0),this.#tt(this.#r,"aria-hidden",!0))}#j(t){"Space"===t.code&&(this.#r.focus(),this.setMenu({open:!0})),"click"===t.type&&(this.#q()?this.setMenu({open:!1}):(this.#r.focus(),this.setMenu({open:!0})))}set disabled(t){"true"===String(t).toLowerCase()?(this.#t.classList.add("disabled"),this.#e.disabled=!0,this.#s.tabIndex="-1",this.#m&&(this.#l.tabIndex="-1"),this.#tt(this.#s,"aria-label","Country Field disabled"),this.setMenu({open:!1}),removeEventListener()):"false"===String(t).toLowerCase()&&(this.#t.classList.remove("disabled"),this.#e.removeAttribute("disabled"),this.#s.tabIndex="0",this.#m&&(this.#l.tabIndex="0"),this.#tt(this.#s,"aria-label",this.#f),this.#P())}get disabled(){return this.#e.disabled}set readonly(t){"true"===String(t).toLowerCase()?(this.#t.classList.add("disabled"),this.#e.readOnly=!0,this.#s.tabIndex="-1",this.#m&&(this.#l.tabIndex="-1"),this.setMenu({open:!1})):"false"===String(t).toLowerCase()&&(this.#t.classList.remove("disabled"),this.#e.removeAttribute("readonly"),this.#m&&(this.#s.tabIndex="0"),this.#l.tabIndex="0")}get readonly(){return this.#e.readOnly}set value(t){this.#e.value=t}get value(){return this.#st()?.val}#dt(){this.#N.forEach((t=>{let{selector:e,eventType:s,cb:i}=t;e.removeEventListener(s,i)}))}destroy(){this.#d.innerHTML="",this.value="",this.#dt()}}return e})()));