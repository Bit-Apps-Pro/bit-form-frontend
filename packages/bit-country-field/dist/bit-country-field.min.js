!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).bit_country_field=e()}(this,(function(){"use strict";return class{#t;#e;#s;#i;#n;#l;#r="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'/>";#o;#a;#h;#d;#c;#u;#p="";#m=[];#y=!0;#C=!0;#b=!0;#E=!0;#g=!1;#f=!1;#v="";#I="Select a Country";#w="Search Country";#x="No Currency Found";#O=370;#L;#A={};#S=[];#W={};#T={};#F="";#N="";#k=null;#B="";#H=[];#$;constructor(t,e){this.#K(e),this.#t="string"==typeof t?this.#L.querySelector(t):t,this.fieldKey=this.#N,this.init()}#K(t){this.#N=t.fieldKey,this.#v=t.defaultValue,this.#I=t.placeholder,this.#w=t.searchPlaceholder||"Search Country",this.#x=t.noCountryFoundText||"No Country Found",this.#O=t.maxHeight||370,this.#y=t.selectedFlagImage,this.#C=t.selectedCountryClearable,this.#b=t.searchClearable,this.#E=t.optionFlagImage,this.#g=t.detectCountryByIp,this.#f=t.detectCountryByGeo,this.#F=t.assetsURL,this.#$=t.onChange,this.#S=t.options,this.#m=[...this.#S],this.#W=t.attributes||{},this.#T=t.classNames||{},t.document?this.#L=t.document:this.#L=document,t.window?this.#A=t.window:this.#A=window}init(){var t,e,s;this.#e=this.#R(`.${this.fieldKey}-country-hidden-input`),this.#s=this.#R(`.${this.fieldKey}-dpd-wrp`),this.#i=this.#R(`.${this.fieldKey}-selected-country-img`),this.#o=this.#R(`.${this.fieldKey}-option-search-wrp`),this.#a=this.#R(`.${this.fieldKey}-opt-search-input`),this.#h=this.#R(`.${this.fieldKey}-search-clear-btn`),this.#d=this.#R(`.${this.fieldKey}-option-wrp`),this.#c=this.#R(`.${this.fieldKey}-option-list`),this.#u=this.#R(".option"),this.rowHeight=this.rowHeight?this.rowHeight:(null===(t=this.#u)||void 0===t?void 0:t.offsetHeight)||30,null===(e=this.#u)||void 0===e||e.remove(),this.#g&&this.#D(),this.#f&&this.#M(),this.#v&&this.setSelectedCountryItem(this.#v),this.#V(),this.#U(),observeElm(this.#e,"value",((t,e)=>{this.#P(t,e)})),this.#G(),this.#y||null===(s=this.#i)||void 0===s||s.remove(),this.#b&&(this.#a.style.paddingRight="25px",this.#h.style.display="none")}#U(){this.#_(this.#s,"click",(t=>{this.#z(t)})),this.#_(this.#s,"keyup",(t=>{this.#z(t)})),this.#_(this.#t,"keydown",(t=>{this.#q(t)})),this.#b&&this.#_(this.#h,"click",(()=>{this.searchOptions("")})),this.#_(this.#a,"keyup",(t=>{this.#j(t)}))}#V(){const t=this.#e.name,e=decodeURIComponent(`${this.#L.URL}`.replace(/\+/g,"%20")).replace(new RegExp(`.*${t}=([^&]*).*|(.*)`),"$1");e&&this.#P("",e)}#R(t){return this.#t.querySelector(t)||void 0}#J(t){return this.#t.querySelectorAll(t)||void 0}#_(t,e,s){t.addEventListener(e,s),this.#H.push({selector:t,eventType:e,cb:s})}#D(){fetch("https://www.cloudflare.com/cdn-cgi/trace").then((t=>t.text())).then((t=>{const e=t.trim().split("\n").reduce(((t,e)=>{const[s,i]=e.split("=");return t[s]=i,t}),{});this.setSelectedCountryItem(null==e?void 0:e.loc)}))}#M(){navigator.geolocation.getCurrentPosition((t=>{const{latitude:e,longitude:s}=t.coords;fetch(`http://api.geonames.org/countryCodeJSON?username=bitcodezoho1&lat=${e}&lng=${s}`).then((t=>t.json())).then((t=>{this.setSelectedCountryItem(t.countryCode)}))}))}#q(t){const e=this.#L.activeElement;let s=null;if(this.#Q()){const l=Number(e.dataset.index||-1);if("ArrowDown"===t.key||!t.shiftKey&&"Tab"===t.key){if(t.preventDefault(),e===this.#a)s=this.#R(".option:not(.disabled-opt)");else if(e.classList.contains("option")){const t=this.#X(l,"next"),e=this.#Y(t);if(e)s=e;else if(t+1<this.#m.length){var i;null===(i=this.virtualOptionList)||void 0===i||i.scrollToIndex(t),setTimeout((()=>{const e=this.#Y(t);e&&e.focus()}),50)}}}else if("ArrowUp"===t.key||t.shiftKey&&"Tab"===t.key){if(t.preventDefault(),e===this.#a)s=this.#s,this.#Q()&&this.setMenu({open:!1});else if(e.classList.contains("option")){const t=this.#X(l,"previous"),e=this.#Y(t);if(e)s=e;else if(t>0){var n;null===(n=this.virtualOptionList)||void 0===n||n.scrollToIndex(t),setTimeout((()=>{const e=this.#Y(t);e&&e.focus()}),50)}else e||(s=this.#a)}}else"Escape"===t.key&&this.setMenu({open:!1})}else if(t.key>="a"&&t.key<="z"){clearTimeout(this.#k),this.#B+=t.key,this.#k=setTimeout((()=>{this.#B=""}),300);const e=this.#S.find((t=>!t.disabled&&t.lbl.toLowerCase().startsWith(this.#B)));e&&this.setSelectedCountryItem(e.i)}else if("ArrowDown"===t.key||"ArrowUp"===t.key){const e=this.#Z(),s="ArrowDown"===t.key?"next":"previous",i=this.#X(e,s);i>-1&&i<this.#S.length&&(this.value=this.#S[i].val||this.#S[i].lbl)}s&&s.focus()}#Y(t){return this.#R(`.${this.fieldKey}-option-list .option[data-index="${t}"]`)}#X(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,e=arguments.length>1?arguments[1]:void 0;if("next"===e){const e=this.#S.length;for(let s=t+1;s<e;s+=1)if(!this.#S[s].disabled)return s}else if("previous"===e)for(let e=t-1;e>=0;e-=1)if(!this.#S[e].disabled)return e}#P(t,e){const s=this.#S.find((t=>t.val===e||t.lbl===e));s&&t!==e&&this.setSelectedCountryItem(s.i),"undefined"!=typeof bit_conditionals&&bit_conditionals({target:this.#e})}#tt(t){null==t||t.stopPropagation(),this.#p="",this.#y&&(this.#i.src=this.#r),this.#et(this.#n,this.#I),this.#C&&(this.#l.style.display="none"),this.#st(this.#s,"aria-label","Selected country cleared"),this.#s.focus(),this.value="",setTimeout((()=>{this.#st(this.#s,"aria-label",this.#I)}),100),this.#it()}setSelectedCountryItem(t){if(this.#p=t,!this.#p)return;const e=this.#nt();e&&(this.#n=this.#R(`.${this.fieldKey}-selected-country-lbl`),this.#C&&(this.#l=this.#C?this.#R(`.${this.fieldKey}-inp-clr-btn`):{}),this.#y&&this.#i&&(this.#i.src=`${this.#F}${e.img}`),this.#et(this.#n,e.lbl),this.setMenu({open:!1}),this.value=e.val||e.lbl,this.#C&&(this.#l.style.display="grid",this.#_(this.#l,"click",(t=>{this.#tt(t)}))),this.#$&&this.#$(e.val||e.lbl),this.#st(this.#s,"aria-label",`${e.lbl} selected`),setTimeout((()=>{this.#st(this.#s,"aria-label",e.lbl)}),100))}#Z(){return this.#m.findIndex((t=>t.i===this.#p))}#nt(){return this.#S.find((t=>t.i===this.#p))}#lt(t){return this.#L.createElement(t)}#rt(t,e){t.classList.add(e)}#et(t,e){t.textContent=e}#st(t,e,s){var i;null==t||null===(i=t.setAttribute)||void 0===i||i.call(t,e,s)}#it(){var t,e;null===(t=this.virtualOptionList)||void 0===t||t.setRowCount(this.#m.length);const s=this.#Z();null===(e=this.virtualOptionList)||void 0===e||e.scrollToIndex(-1===s?0:s)}#ot(t,e){const s=e.length;if(s)for(let i=0;i<s;i+=1)this.#st(t,e[i].key,e[i].value)}#G(){const t=this.#Z();this.virtualOptionList=new bit_virtualized_list(this.#c,{height:this.#O-this.#o.offsetHeight-this.rowHeight,rowCount:this.#m.length,rowHeight:this.rowHeight,initialIndex:-1===t?0:t,renderRow:t=>{const e=this.#m[t],s=this.#lt("li");if(this.#st(s,"data-key",e.i),this.#st(s,"data-index",t),"option"in this.#W){const t=this.#W.option;this.#ot(s,t)}if(!e.i)return this.#et(s,e.lbl),this.#rt(s,"opt-not-found"),s;if(this.#rt(s,"option"),"option"in this.#T){const t=this.#T.option;t&&this.#rt(s,t)}const i=this.#lt("span");if(this.#rt(i,"opt-lbl-wrp"),"opt-lbl-wrp"in this.#T){const t=this.#T["opt-lbl-wrp"];t&&this.#rt(i,t)}if("opt-lbl-wrp"in this.#W){const t=this.#W["opt-lbl-wrp"];this.#ot(i,t)}if(this.#E){const t=this.#lt("img");if("opt-icn"in this.#W){const e=this.#W["opt-icn"];e&&this.#ot(t,e)}if(this.#rt(t,"opt-icn"),"opt-icn"in this.#T){const e=this.#T["opt-icn"];e&&this.#rt(t,e)}t.src=`${this.#F}${e.img}`,t.alt=`${e.lbl} flag image`,t.loading="lazy",this.#st(t,"aria-hidden",!0),i.append(t)}const n=this.#lt("span");if("opt-lbl"in this.#W){const t=this.#W["opt-lbl"];this.#ot(n,t)}if(this.#rt(n,"opt-lbl"),"opt-lbl"in this.#T){const t=this.#T["opt-lbl"];t&&this.#rt(n,t)}this.#et(n,e.lbl),i.append(n);const l=this.#lt("span");return this.#rt(l,"opt-prefix"),this.#et(l,e.code),s.tabIndex=this.#Q()?"0":"-1",this.#st(s,"role","option"),this.#st(s,"aria-posinset",t+1),this.#st(s,"aria-setsize",this.#m.length),this.#_(s,"click",(t=>{this.setSelectedCountryItem(t.currentTarget.dataset.key)})),this.#_(s,"keyup",(t=>{"Enter"===t.key&&this.setSelectedCountryItem(t.currentTarget.dataset.key)})),e.disabled&&this.#rt(s,"disabled-opt"),s.append(i,l),this.#p===e.i?(this.#rt(s,"selected-opt"),this.#st(s,"aria-selected",!0)):this.#st(s,"aria-selected",!1),s}})}#j(t){if("Enter"===t.key&&this.#m.length){var e;const t=null===(e=this.#m)||void 0===e?void 0:e[0].i;t&&(this.setSelectedCountryItem(t),this.searchOptions(""))}else this.searchOptions(t.target.value)}searchOptions(t){this.#at(t);let e=[];t?(e=this.#S.filter((e=>e.lbl.toLowerCase().includes(t.toLowerCase()))),e.length||(e=[{i:0,lbl:this.#x}]),this.#m=e,this.#b&&(this.#h.style.display="grid")):(this.#m=this.#S,this.#b&&(this.#h.style.display="none")),this.#it()}#at(t){this.#a.value=t}#ht(t){this.#t.contains(t.target)||this.setMenu({open:!1})}#Q(){return this.#t.classList.contains("menu-open")}#dt(){const t=this.#A,e=this.#s.getBoundingClientRect(),s=e.top,i=t.innerHeight-e.bottom;i<s&&i<this.#O?(this.#t.style.flexDirection="column-reverse",this.#t.style.bottom="0%"):(this.#t.style.flexDirection="column",this.#t.style.removeProperty("bottom"))}setMenu(t){let{open:e}=t;this.#d.style.maxHeight=`${e?this.#O:0}px`,e?(this.#dt(),this.#t.classList.add("menu-open"),this.#_(this.#L,"click",(t=>this.#ht(t))),this.#a.tabIndex="0",this.#h.tabIndex="0",this.#s.setAttribute("aria-expanded","true"),this.#st(this.#c,"aria-hidden",!1),this.#st(this.#a,"aria-hidden",!1),this.#it()):(this.#t.classList.remove("menu-open"),this.#L.removeEventListener("click",this.#ht),this.searchOptions(""),this.#a.blur(),this.#a.tabIndex="-1",this.#h.tabIndex="-1",this.#s.setAttribute("aria-expanded","false"),this.#st(this.#c,"aria-hidden",!0),this.#st(this.#a,"aria-hidden",!0))}#z(t){"Space"===t.code&&(this.#a.focus(),this.setMenu({open:!0})),"click"===t.type&&(this.#Q()?this.setMenu({open:!1}):(this.#a.focus(),this.setMenu({open:!0})))}set disabled(t){"true"===String(t).toLowerCase()?(this.#t.classList.add("disabled"),this.#e.disabled=!0,this.#C&&this.#st(this.#l,"tabindex","-1"),this.#st(this.#s,"aria-label","Country Field disabled"),this.#st(this.#s,"tabindex","-1"),this.setMenu({open:!1}),this.#H.forEach((t=>{let{selector:e,eventType:s,cb:i}=t;e.removeEventListener(s,i)}))):"false"===String(t).toLowerCase()&&(this.#t.classList.remove("disabled"),this.#e.removeAttribute("disabled"),this.#st(this.#s,"tabindex","0"),this.#C&&this.#st(this.#l,"tabindex","0"),this.#st(this.#s,"aria-label",this.#I),this.#U())}get disabled(){return this.#e.disabled}set readonly(t){"true"===String(t).toLowerCase()?(this.#t.classList.add("disabled"),this.#e.readOnly=!0,this.#st(this.#s,"tabindex","-1"),this.#C&&this.#st(this.#l,"tabindex","-1"),this.setMenu({open:!1})):"false"===String(t).toLowerCase()&&(this.#t.classList.remove("disabled"),this.#e.removeAttribute("readonly"),this.#C&&this.#st(this.#s,"tabindex","0"),this.#st(this.#l,"tabindex","0"))}get readonly(){return this.#e.readOnly}set value(t){this.#e.value=t}get value(){const t=this.#nt();return t.val||t.lbl}#ct(){this.#H.forEach((t=>{let{selector:e,eventType:s,cb:i}=t;e.removeEventListener(s,i)}))}destroy(){this.#c.innerHTML="",this.value="",this.#ct()}reset(){this.#tt(),this.destroy(),this.init()}}}));
