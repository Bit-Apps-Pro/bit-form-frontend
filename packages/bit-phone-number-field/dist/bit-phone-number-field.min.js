!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).bit_phone_number_field=e()}(this,(function(){"use strict";return class{#t="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'/>";#e="https://www.cloudflare.com/cdn-cgi/trace";#i="http://api.geonames.org/countryCodeJSON?username=bitcodezoho1";#s=null;#n=null;#o=null;#l=null;#r=null;#h=null;#a=null;#c=null;#d=null;#u=null;#p=null;#m=null;#f=[];#y=[];#g=!1;#C=[];#b={maxHeight:370,detectCountryByIp:!1,detectCountryByGeo:!1,searchCountryPlaceholder:"Search Country",noCountryFoundText:"No Country Found",searchClearable:!0,attributes:{},classNames:{}};#E=null;#I="";#v=null;#w=null;constructor(t,e){Object.assign(this.#b,e),this.#v=e.document||document,this.#w=e.window||window,this.#s="string"==typeof t?this.#v.querySelector(t):t,this.#f=[...this.#b.options],this.#y=this.#N(),this.fieldKey=this.#b.fieldKey,this.init()}init(){this.#d=this.#x(`.${this.fieldKey}-phone-inner-wrp`),this.#u=this.#x(`.${this.fieldKey}-phone-number-input`),this.#n=this.#x(`.${this.fieldKey}-phone-hidden-input`),this.#o=this.#x(`.${this.fieldKey}-input-clear-btn`),this.#h=this.#x(`.${this.fieldKey}-selected-country-img`)||{},this.#c=this.#x(`.${this.fieldKey}-opt-search-input`),this.#l=this.#x(`.${this.fieldKey}-dpd-wrp`),this.#r=this.#x(`.${this.fieldKey}-option-wrp`),this.#p=this.#x(`.${this.fieldKey}-search-clear-btn`),this.#m=this.#x(`.${this.fieldKey}-option-list`),this.#S(this.#s,"keydown",(t=>{this.#O(t)})),this.#S(this.#l,"click",(t=>{this.#A(t)})),this.#S(this.#l,"keyup",(t=>{this.#A(t)})),this.#S(this.#u,"input",(t=>{this.#L(t)})),function(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const n=Object.getPrototypeOf(t);if(Object.prototype.hasOwnProperty.call(n,e)){const o=Object.getOwnPropertyDescriptor(n,e);Object.defineProperty(t,e,{configurable:!0,get(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return o.get.apply(this,e)},set(){const t=this[e];for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];o.set.apply(this,l);const h=this[e];return"function"==typeof i&&setTimeout(i.bind(this,t,h),s),h}})}}(this.#n,"value",((t,e)=>{this.#k(t,e)})),this.#b.selectedCountryClearable&&this.#S(this.#o,"click",(t=>{this.#$(t)})),this.#S(this.#u,"focusout",(t=>{this.#F(t)})),this.#K(),this.#b.detectCountryByIp&&this.#P(),this.#b.detectCountryByGeo&&this.#T(),this.#W(),this.#b.searchClearable&&(this.#c.style.paddingRight="25px",this.#p.style.display="block",this.#S(this.#p,"click",(()=>{this.searchOptions("")}))),this.#c.value="",this.#S(this.#c,"keyup",(t=>{this.#B(t)})),this.#t=this.#b.placeholderImage?this.#b.placeholderImage:this.#t}#x(t){return this.#s.querySelector(t)}#S(t,e,i){t.addEventListener(e,i),this.#C.push({selector:t,eventType:e,cb:i})}#K(){this.#u.value&&this.#V(this.#u,"input")}#P(){fetch(this.#e).then((t=>t.text())).then((t=>{const e=t.trim().split("\n").reduce(((t,e)=>(t[(e=e.split("="))[0]]=e[1],t)),{});this.setSelectedCountryItem(e.loc)}))}#T(){navigator.geolocation.getCurrentPosition((t=>{const{latitude:e,longitude:i}=t.coords;fetch(`${this.#i}&lat=${e}&lng=${i}`).then((t=>t.json())).then((t=>{this.setSelectedCountryItem(t.countryCode)}))}))}#O(t){const e=this.#v.activeElement;let i=null;const s=this.#D();if(t.target!==this.#u){if(s){const s=Number(e.dataset.index||-1);if("ArrowDown"===t.key||!t.shiftKey&&"Tab"===t.key){if(t.preventDefault(),e===this.#c)i=this.#x(`.${this.fieldKey}-option:not(.${this.fieldKey}-disabled-opt)`);else if(e.classList.contains(`${this.fieldKey}-option`)){const t=this.#H(s,"next"),e=this.#R(t);e?i=e:t+1<this.#f.length&&(this.virtualOptionList?.scrollToIndex(t,"center"),setTimeout((()=>{const e=this.#R(t);e&&e.focus()}),0))}}else if("ArrowUp"===t.key||t.shiftKey&&"Tab"===t.key){if(t.preventDefault(),e===this.#c)i=this.#l,this.#D()&&this.setMenu({open:!1});else if(e.classList.contains(`${this.fieldKey}-option`)){const t=this.#H(s,"previous"),e=this.#R(t);e?i=e:t>0?(this.virtualOptionList?.scrollToIndex(t,"center"),setTimeout((()=>{const e=this.#R(t);e&&e.focus()}),0)):e||(i=this.#c)}}else"Escape"===t.key&&this.setMenu({open:!1})}else if(t.key>="a"&&t.key<="z"){clearTimeout(this.#E),this.#I+=t.key,this.#E=setTimeout((()=>{this.#I=""}),300);const e=this.#b.options.find((t=>!t.disabled&&t.lbl.toLowerCase().startsWith(this.#I)));e&&this.setSelectedCountryItem(e.i)}else if("ArrowDown"===t.key||"ArrowUp"===t.key){const e=this.#M(),i="ArrowDown"===t.key?"next":"previous",s=this.#H(e,i);s>-1&&s<this.#b.options.length&&(this.value=this.#b.options[s].val)}i&&i.focus()}}#V(t,e){const i=new Event(e);t.dispatchEvent(i)}#$(){this.#u.value="",this.setSelectedCountryItem(this.#b.defaultCountryKey),this.#V(this.#u,"input")}#R(t){return this.#x(`.${this.fieldKey}-option-list .${this.fieldKey}-option[data-index="${t}"]`)}#H(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,e=arguments.length>1?arguments[1]:void 0;if("next"===e){const e=this.#b.options.length;for(let i=t+1;i<e;i+=1)if(!this.#b.options[i].disabled)return i}else if("previous"===e)for(let e=t-1;e>=0;e-=1)if(!this.#b.options[e].disabled)return e}#j(t){t.target.contains(this.#s)&&this.setMenu({open:!1})}#N(){return this.#b.options.reduce(((t,e)=>{if(!t[e.code]){let{code:i}=e;"+"===i[0]&&(i=i.substring(1)),t[i]=e.i}return t}),{})}#U(t){if(this.#g)return"";let e=t;"+"===e[0]&&(e=e.substring(1,4));let i="";for(let t=3;t>0;t-=1)if(i=e.substring(0,t),i in this.#y)return i;return""}#G(t){const e=this.#U(t);if(e)return this.setSelectedCountryItem(this.#y[e]),e}#z(t){return t.replace(/[^+0-9]/g,"")}#k(t,e){this.#G(e)&&t!==e&&this.#_(this.#z(e))}#L(t){const{value:e}=t.target;e?this.#b.selectedCountryClearable&&(this.#o.style.display="grid"):(this.#b.selectedCountryClearable&&(this.#o.style.display="none"),this.#g=!1),!this.#g&&(e.length<4||"deleteContentBackward"===t.inputType||"deleteContentForward"===t.inputType)||this.#_(e)}#_(t){const e=this.#q();let i="";if(i=this.#g?e.code:this.#G(t),i&&e){let s=e.frmt;const n=this.#b.valueFormat||"";s||(s=this.#b.inputFormat||"");const o=this.#J(i,t,s);if(n){const e=this.#z(t);this.value=this.#J(i,e,n)}else this.value=o;this.#u.value=o}}#Q=t=>/[0-9]/.test(t);#J(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s="",n=0;const o="+"===e[0]?e.substring(1):e;for(let e=0;e<i.length&&!(n>=o.length);e+=1){const l=i[e];if("c"===l){const e="+"===t[0]?t.substring(1):t;s+=e,n+=e.length}else if("#"===l){if(!this.#Q(o[n]))break;s+=o[n],n+=1}else o[n]===l?(s+=l,n+=1):s+=l}return n<o.length&&(s+=o.substring(n)),s}#F(t){const e=this.#z(t.target.value),i=this.#q();i&&(e.substring(i.code.length),i.ptrn)&&new RegExp(i.ptrn)}#M(){const t=this.#f.findIndex((t=>t.i===this.#a));return-1===t?0:t}#q(){return this.#b.options.find((t=>t.i===this.#a))}#X(t){return this.#v.createElement(t)}#Y(t,e){t.classList.add(e)}#Z(t,e){t.textContent=e}#tt(t,e,i){t?.setAttribute?.(e,i)}#et(t,e){const i=Object.keys(e),s=i.length;if(s)for(let n=0;n<s;n+=1)this.#tt(t,i[n],e[i[n]])}#W(){const t=this.#M();this.virtualOptionList=new VirtualizedList(this.#m,{height:this.#b.maxHeight,rowCount:this.#f.length,rowHeight:31,initialIndex:-1===t?0:t,renderRow:t=>{const e=this.#f[t],i=this.#X("li");if(this.#tt(i,"data-key",e.i),this.#tt(i,"data-index",t),"option"in this.#b.attributes){const t=this.#b.attributes.option;this.#et(i,t)}if(!e.i)return this.#Z(i,e.lbl),this.#Y(i,`${this.fieldKey}-opt-not-found`),i;if(this.#Y(i,`${this.fieldKey}-option`),"option"in this.#b.classNames){const t=this.#b.classNames.option;t&&this.#Y(i,t)}const s=this.#X("span");if(this.#Y(s,`${this.fieldKey}-opt-lbl-wrp`),"opt-lbl-wrp"in this.#b.classNames){const t=this.#b.classNames["opt-lbl-wrp"];t&&this.#Y(s,t)}if("opt-lbl-wrp"in this.#b.attributes){const t=this.#b.attributes["opt-lbl-wrp"];this.#et(s,t)}const n=this.#X("img");if(this.#Y(n,`${this.fieldKey}-opt-icn`),"opt-icn"in this.#b.classNames){const t=this.#b.classNames["opt-icn"];t&&this.#Y(n,t)}if("opt-icn"in this.#b.attributes){const t=this.#b.attributes["opt-icn"];this.#et(n,t)}n.src=`${bits.assetsURL}/${e.img}`,n.alt=`${e.lbl} flag image`,n.loading="lazy",this.#tt(n,"aria-hidden",!0);const o=this.#X("span");if(this.#Y(o,`${this.fieldKey}-opt-lbl`),"opt-lbl"in this.#b.classNames){const t=this.#b.classNames["opt-lbl"];t&&this.#Y(o,t)}if("opt-lbl"in this.#b.attributes){const t=this.#b.attributes["opt-lbl"];this.#et(o,t)}this.#Z(o,e.lbl),s.append(n,o);const l=this.#X("span");if(this.#Y(l,`${this.fieldKey}-opt-prefix`),this.#Z(l,e.code),"opt-prefix"in this.#b.attributes){const t=this.#b.attributes["opt-prefix"];this.#et(l,t)}return this.#tt(i,"tabindex",this.#D()?"0":"-1"),this.#tt(i,"role","option"),this.#tt(i,"aria-posinset",t+1),this.#tt(i,"aria-setsize",this.#f.length),this.#S(i,"click",(t=>{this.#g=!0,this.setSelectedCountryItem(t.currentTarget.dataset.key)})),this.#S(i,"keyup",(t=>{"Enter"===t.key&&(this.#g=!0,this.setSelectedCountryItem(t.currentTarget.dataset.key))})),e.disabled&&this.#Y(i,`${this.fieldKey}-disabled-opt`),i.append(s,l),this.#a===e.i?(this.#Y(i,`${this.fieldKey}-selected-opt`),this.#tt(i,"aria-selected",!0)):this.#tt(i,"aria-selected",!1),i}})}#it(t){const e=this.#z(this.#u.value);if(this.#U(e)){let i=this.#q().frmt;i||(i=this.#b.inputFormat||""),this.#u.value=this.#J(t,e,i)}else this.#u.value=t}#st(){this.#a="",this.#b.selectedFlagImage&&(this.#h.src=this.#t),this.value="",this.#nt()}setSelectedCountryItem(t){if(this.#a=t,!this.#a)return void this.#st();const e=this.#q();e&&(this.#h.src=`${bits.assetsURL}/${e.img}`,this.#it(e.code),this.setMenu({open:!1}),this.#u.focus())}#nt(){this.virtualOptionList?.setRowCount(this.#f.length),this.virtualOptionList?.scrollToIndex(this.#M())}#ot(t){this.#c.value=t}#B(t){if("Enter"===t.key&&this.#f.length){const t=this.#x(`.${this.fieldKey}-option`)?.dataset.key;this.setSelectedCountryItem(t),this.searchOptions("")}else this.searchOptions(t.target.value)}searchOptions(t){this.#ot(t);let e=[];t?(e=this.#b.options.filter((e=>{const i=t.toLowerCase(),s=(e.lbl||"").toLowerCase(),n=(e.val||"").toLowerCase(),o=e.code||"";return!!s.includes(i)||!!n.includes(i)||!!o.includes(i)||void 0})),e.length||(e=[{i:0,lbl:this.#b.noCountryFoundText}]),this.#f=e,this.#b.searchClearable&&(this.#p.style.display="grid")):(this.#f=this.#b.options,this.#b.searchClearable&&(this.#p.style.display="none")),this.#nt()}#D(){return this.#s.classList.contains(`${this.fieldKey}-menu-open`)}#lt(){const t=this.#d.getBoundingClientRect(),e=t.top,i=this.#w.innerHeight-t.bottom;i<e&&i<this.#b.maxHeight?(this.#s.style.flexDirection="column-reverse",this.#s.style.bottom="0%"):(this.#s.style.flexDirection="column",this.#s.style.removeProperty("bottom"))}setMenu(t){let{open:e}=t;this.#r.style.maxHeight=`${e?this.#b.maxHeight:0}px`,e?(this.#lt(),this.#Y(this.#s,`${this.fieldKey}-menu-open`),this.#S(this.#v,"click",(t=>this.#j(t))),this.#tt(this.#c,"tabindex",0),this.#tt(this.#p,"tabindex",0),this.#tt(this.#l,"aria-expanded",!0),this.#nt()):(this.#s.classList.remove(`${this.fieldKey}-menu-open`),this.#v.removeEventListener("click",this.#j),this.searchOptions(""),this.#tt(this.#c,"tabindex",-1),this.#tt(this.#p,"tabindex",-1),this.#tt(this.#l,"aria-expanded",!1))}#A(t){"Space"===t.code&&(this.#c.focus(),this.setMenu({open:!0})),"click"===t.type&&(this.#D()?this.setMenu({open:!1}):(this.#c.focus(),this.setMenu({open:!0})))}set value(t){this.#n.value=t}get value(){return this.#n.value}#rt(){this.#C.forEach((t=>{let{selector:e,eventType:i,cb:s}=t;e.removeEventListener(i,s)}))}destroy(){this.#m.innerHTML="",this.value="",this.#rt()}}}));
