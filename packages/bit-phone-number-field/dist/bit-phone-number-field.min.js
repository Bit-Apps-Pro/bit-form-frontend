!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).bit_phone_number_field=e()}(this,(function(){"use strict";return class{#t="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'/>";#e="https://www.cloudflare.com/cdn-cgi/trace";#s="http://api.geonames.org/countryCodeJSON?username=bitcodezoho1";#i=null;#n=null;#o=null;#l=null;#h=null;#r=null;#a=null;#u=null;#c=null;#d=null;#p=null;#m=null;#f=[];#y=[];#g=!1;#C=[];#b={maxHeight:370,detectCountryByIp:!1,detectCountryByGeo:!1,searchCountryPlaceholder:"Search Country",noCountryFoundText:"No Country Found",searchClearable:!0,defaultCountryKey:"",attributes:{},classNames:{}};#E="";#I=null;#v="";#w=null;#N=null;constructor(t,e){Object.assign(this.#b,e),this.#w=e.document||document,this.#N=e.window||window,this.#E=e.assetsURL||"",this.#i="string"==typeof t?this.#w.querySelector(t):t,this.#f=[...this.#b.options],this.#y=this.#x(),this.fieldKey=this.#b.fieldKey,this.init()}init(){this.#c=this.#S(`.${this.fieldKey}-phone-inner-wrp`),this.#d=this.#S(`.${this.fieldKey}-phone-number-input`),this.#n=this.#S(`.${this.fieldKey}-phone-hidden-input`),this.#o=this.#S(`.${this.fieldKey}-input-clear-btn`),this.#r=this.#S(`.${this.fieldKey}-selected-country-img`)||{},this.#u=this.#S(`.${this.fieldKey}-opt-search-input`),this.#l=this.#S(`.${this.fieldKey}-dpd-wrp`),this.#h=this.#S(`.${this.fieldKey}-option-wrp`),this.#p=this.#S(`.${this.fieldKey}-search-clear-btn`),this.#m=this.#S(`.${this.fieldKey}-option-list`),this.#L(this.#i,"keydown",(t=>{this.#A(t)})),this.#L(this.#l,"click",(t=>{this.#k(t)})),this.#L(this.#l,"keyup",(t=>{this.#k(t)})),this.#L(this.#d,"blur",(t=>{this.#O()})),this.#L(this.#d,"input",(t=>{this.#F(t)})),observeElm(this.#n,"value",((t,e)=>{this.#P(t,e)})),this.#b.selectedCountryClearable&&this.#L(this.#o,"click",(t=>{this.#T(t)})),this.#L(this.#d,"focusout",(t=>{this.#W(t)})),this.#B(),this.#b.detectCountryByIp&&this.#K(),this.#b.detectCountryByGeo&&this.#$(),this.#V(),this.#b.defaultCountryKey&&this.setSelectedCountryItem(this.#b.defaultCountryKey),this.#b.searchClearable&&(this.#u.style.paddingRight="25px",this.#p.style.display="block",this.#L(this.#p,"click",(()=>{this.searchOptions("")}))),this.#u.value="",this.#L(this.#u,"keyup",(t=>{this.#D(t)})),this.#t=this.#b.placeholderImage?this.#b.placeholderImage:this.#t}#S(t){return this.#i.querySelector(t)}#L(t,e,s){t.addEventListener(e,s),this.#C.push({selector:t,eventType:e,cb:s})}#B(){this.#d.value&&this.#R(this.#d,"input")}#K(){fetch(this.#e).then((t=>t.text())).then((t=>{const e=t.trim().split("\n").reduce(((t,e)=>(t[(e=e.split("="))[0]]=e[1],t)),{});this.setSelectedCountryItem(e.loc)}))}#$(){navigator.geolocation.getCurrentPosition((t=>{const{latitude:e,longitude:s}=t.coords;fetch(`${this.#s}&lat=${e}&lng=${s}`).then((t=>t.json())).then((t=>{this.setSelectedCountryItem(t.countryCode)}))}))}#A(t){const e=this.#w.activeElement;let s=null;const i=this.#H();if(t.target!==this.#d){if(i){const i=Number(e.dataset.index||-1);if("ArrowDown"===t.key||!t.shiftKey&&"Tab"===t.key){if(t.preventDefault(),e===this.#u)s=this.#S(".option:not(.disabled-opt)");else if(e.classList.contains("option")){const t=this.#M(i,"next"),e=this.#U(t);if(e)s=e;else if(t+1<this.#f.length){var n;null===(n=this.virtualOptionList)||void 0===n||n.scrollToIndex(t,"center"),setTimeout((()=>{const e=this.#U(t);e&&e.focus()}),0)}}}else if("ArrowUp"===t.key||t.shiftKey&&"Tab"===t.key){if(t.preventDefault(),e===this.#u)s=this.#l,this.#H()&&this.setMenu({open:!1});else if(e.classList.contains(`${this.fieldKey}-option`)){const t=this.#M(i,"previous"),e=this.#U(t);if(e)s=e;else if(t>0){var o;null===(o=this.virtualOptionList)||void 0===o||o.scrollToIndex(t,"center"),setTimeout((()=>{const e=this.#U(t);e&&e.focus()}),0)}else e||(s=this.#u)}}else"Escape"===t.key&&this.setMenu({open:!1})}else if(t.key>="a"&&t.key<="z"){clearTimeout(this.#I),this.#v+=t.key,this.#I=setTimeout((()=>{this.#v=""}),300);const e=this.#b.options.find((t=>!t.disabled&&t.lbl.toLowerCase().startsWith(this.#v)));e&&this.setSelectedCountryItem(e.i)}else if("ArrowDown"===t.key||"ArrowUp"===t.key){const e=this.#_(),s="ArrowDown"===t.key?"next":"previous",i=this.#M(e,s);i>-1&&i<this.#b.options.length&&(this.value=this.#b.options[i].val)}s&&s.focus()}}#R(t,e){const s=new Event(e);t.dispatchEvent(s)}#T(){this.#d.value="",this.setSelectedCountryItem(this.#b.defaultCountryKey),this.#R(this.#d,"input")}#U(t){return this.#S(`.${this.fieldKey}-option-list .${this.fieldKey}-option[data-index="${t}"]`)}#M(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,e=arguments.length>1?arguments[1]:void 0;if("next"===e){const e=this.#b.options.length;for(let s=t+1;s<e;s+=1)if(!this.#b.options[s].disabled)return s}else if("previous"===e)for(let e=t-1;e>=0;e-=1)if(!this.#b.options[e].disabled)return e}#G(t){t.target.contains(this.#i)&&this.setMenu({open:!1})}#x(){return this.#b.options.reduce(((t,e)=>{if(!t[e.code]){let{code:s}=e;"+"===s[0]&&(s=s.substring(1)),t[s]=e.i}return t}),{})}#z(t){if(this.#g)return"";let e=t;"+"===e[0]&&(e=e.substring(1,4));let s="";for(let t=3;t>0;t-=1)if(s=e.substring(0,t),s in this.#y)return s;return""}#j(t){const e=this.#z(t);if(e)return this.setSelectedCountryItem(this.#y[e]),e}#q(t){return t.replace(/[^+0-9]/g,"")}#P(t,e){this.#j(e)&&t!==e&&this.#J(this.#q(e)),"undefined"!=typeof bit_conditionals&&bit_conditionals({target:this.#n})}#O(){this.value.length>3&&(this.#d.value=this.value)}#F(t){const{value:e}=t.target;e?this.#b.selectedCountryClearable&&(this.#o.style.display="grid"):(this.#b.selectedCountryClearable&&(this.#o.style.display="none"),this.#g=!1),!this.#g&&(e.length<4||"deleteContentBackward"===t.inputType||"deleteContentForward"===t.inputType)||this.#J(e)}#J(t){const e=this.#Q();let s="";if(s=this.#g?e.code:this.#j(t),s&&e){let i=e.frmt;const n=this.#b.valueFormat||"";i||(i=this.#b.inputFormat||"");const o=this.#X(s,t,i);if(n){const e=this.#q(t);this.value=this.#X(s,e,n)}else this.value=o;this.#d.value=o}}#Y=t=>/[0-9]/.test(t);#X(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i="",n=0;const o="+"===e[0]?e.substring(1):e;for(let e=0;e<s.length&&!(n>=o.length);e+=1){const l=s[e];if("c"===l){const e="+"===t[0]?t.substring(1):t;i+=e,n+=e.length}else if("#"===l){if(!this.#Y(o[n]))break;i+=o[n],n+=1}else o[n]===l?(i+=l,n+=1):i+=l}return n<o.length&&(i+=o.substring(n)),i}#W(t){const e=this.#q(t.target.value),s=this.#Q();s&&(e.substring(s.code.length),s.ptrn)&&new RegExp(s.ptrn)}#_(){const t=this.#f.findIndex((t=>t.i===this.#a));return-1===t?0:t}#Q(){return this.#b.options.find((t=>t.i===this.#a))}#Z(t){return this.#w.createElement(t)}#tt(t,e){t.classList.add(e)}#et(t,e){t.textContent=e}#st(t,e,s){var i;null==t||null===(i=t.setAttribute)||void 0===i||i.call(t,e,s)}#it(t,e){const s=e.length;if(s)for(let i=0;i<s;i+=1)this.#st(t,e[i].key,e[i].value)}#V(){const t=this.#_();this.virtualOptionList=new bit_virtualized_list(this.#m,{height:this.#b.maxHeight,rowCount:this.#f.length,rowHeight:35.6,initialIndex:-1===t?0:t,renderRow:t=>{const e=this.#f[t],s=this.#Z("li");if(this.#st(s,"data-key",e.i),this.#st(s,"data-index",t),"option"in this.#b.attributes){const t=this.#b.attributes.option;this.#it(s,t)}if(!e.i)return this.#et(s,e.lbl),this.#tt(s,"opt-not-found"),s;if(this.#tt(s,"option"),"option"in this.#b.classNames){const t=this.#b.classNames.option;t&&this.#tt(s,t)}const i=this.#Z("span");if(this.#tt(i,"opt-lbl-wrp"),"opt-lbl-wrp"in this.#b.classNames){const t=this.#b.classNames["opt-lbl-wrp"];t&&this.#tt(i,t)}if("opt-lbl-wrp"in this.#b.attributes){const t=this.#b.attributes["opt-lbl-wrp"];this.#it(i,t)}const n=this.#Z("img");if(this.#tt(n,"opt-icn"),"opt-icn"in this.#b.classNames){const t=this.#b.classNames["opt-icn"];t&&this.#tt(n,t)}if("opt-icn"in this.#b.attributes){const t=this.#b.attributes["opt-icn"];this.#it(n,t)}n.src=`${this.#E}/${e.img}`,n.alt=`${e.lbl} flag image`,n.loading="lazy",this.#st(n,"aria-hidden",!0);const o=this.#Z("span");if(this.#tt(o,"opt-lbl"),"opt-lbl"in this.#b.classNames){const t=this.#b.classNames["opt-lbl"];t&&this.#tt(o,t)}if("opt-lbl"in this.#b.attributes){const t=this.#b.attributes["opt-lbl"];this.#it(o,t)}this.#et(o,e.lbl),i.append(n,o);const l=this.#Z("span");if(this.#tt(l,"opt-prefix"),"opt-prefix"in this.#b.classNames){const t=this.#b.classNames["opt-prefix"];t&&this.#tt(l,t)}if(this.#et(l,e.code),"opt-prefix"in this.#b.attributes){const t=this.#b.attributes["opt-prefix"];this.#it(l,t)}return this.#st(s,"tabindex",this.#H()?"0":"-1"),this.#st(s,"role","option"),this.#st(s,"aria-posinset",t+1),this.#st(s,"aria-setsize",this.#f.length),this.#L(s,"click",(t=>{this.#g=!0,this.setSelectedCountryItem(t.currentTarget.dataset.key)})),this.#L(s,"keyup",(t=>{"Enter"===t.key&&(this.#g=!0,this.setSelectedCountryItem(t.currentTarget.dataset.key))})),e.disabled&&this.#tt(s,"disabled-opt"),s.append(i,l),this.#a===e.i?(this.#tt(s,"selected-opt"),this.#st(s,"aria-selected",!0)):this.#st(s,"aria-selected",!1),s}})}#nt(t){const e=this.#q(this.#d.value);if(this.#z(e)){let s=this.#Q().frmt;s||(s=this.#b.inputFormat||""),this.#d.value=this.#X(t,e,s)}else this.#d.value=t}#ot(){this.#a="",this.#b.selectedFlagImage&&(this.#r.src=this.#t),this.value="",this.#lt()}setSelectedCountryItem(t){if(this.value="",this.#a=t,!this.#a)return void this.#ot();const e=this.#Q();e&&(this.#r.src=`${this.#E}/${e.img}`,this.#nt(e.code),this.setMenu({open:!1}),this.#d.focus())}#lt(){var t,e;null===(t=this.virtualOptionList)||void 0===t||t.setRowCount(this.#f.length),null===(e=this.virtualOptionList)||void 0===e||e.scrollToIndex(this.#_())}#ht(t){this.#u.value=t}#D(t){if("Enter"===t.key&&this.#f.length){var e;const t=null===(e=this.#S(`.${this.fieldKey}-option`))||void 0===e?void 0:e.dataset.key;this.setSelectedCountryItem(t),this.searchOptions("")}else this.searchOptions(t.target.value)}searchOptions(t){this.#ht(t);let e=[];t?(e=this.#b.options.filter((e=>{const s=t.toLowerCase(),i=(e.lbl||"").toLowerCase(),n=(e.val||"").toLowerCase(),o=e.code||"";return!!i.includes(s)||!!n.includes(s)||!!o.includes(s)||void 0})),e.length||(e=[{i:0,lbl:this.#b.noCountryFoundText}]),this.#f=e,this.#b.searchClearable&&(this.#p.style.display="grid")):(this.#f=this.#b.options,this.#b.searchClearable&&(this.#p.style.display="none")),this.#lt()}#H(){return this.#i.classList.contains("menu-open")}#rt(){const t=this.#c.getBoundingClientRect(),e=t.top,s=this.#N.innerHeight-t.bottom;s<e&&s<this.#b.maxHeight?(this.#i.style.flexDirection="column-reverse",this.#i.style.bottom="0%"):(this.#i.style.flexDirection="column",this.#i.style.removeProperty("bottom"))}setMenu(t){let{open:e}=t;this.#h.style.maxHeight=`${e?this.#b.maxHeight:0}px`,e?(this.#rt(),this.#tt(this.#i,"menu-open"),this.#L(this.#w,"click",(t=>this.#G(t))),this.#st(this.#u,"tabindex",0),this.#st(this.#p,"tabindex",0),this.#st(this.#l,"aria-expanded",!0),this.#lt()):(this.#i.classList.remove("menu-open"),this.#w.removeEventListener("click",this.#G),this.searchOptions(""),this.#st(this.#u,"tabindex",-1),this.#st(this.#p,"tabindex",-1),this.#st(this.#l,"aria-expanded",!1))}#k(t){"Space"===t.code&&(this.#u.focus(),this.setMenu({open:!0})),"click"===t.type&&(this.#H()?this.setMenu({open:!1}):(this.#u.focus(),this.setMenu({open:!0})))}set value(t){this.#n.value=t}get value(){return this.#n.value}#at(){this.#C.forEach((t=>{let{selector:e,eventType:s,cb:i}=t;e.removeEventListener(s,i)}))}destroy(){this.#m.innerHTML="",this.value="",this.#at()}reset(){this.#ot(),this.destroy(),this.init()}}}));
