!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(e,t){const o=new URL(e);return o.searchParams.append("action","bitforms_submit_form"),fetch(o,{method:"POST",body:t})}function t(e,t,s){e.then((e=>new Promise(((o,n)=>{if(e.staus>400){const o=new CustomEvent("bf-form-submit-error",{detail:{formId:t,errors:result.data}});bfSelect(`#form-${t}`).dispatchEvent(o),500===e.staus?n(new Error("Mayebe Internal Server Error")):n(e.json())}else o(e.json())})))).then((e=>{const i=new CustomEvent("bf-form-submit-success",{detail:{formId:t,entryId:e.entryId,formData:s}});bfSelect(`#form-${t}`).dispatchEvent(i);let c=null,d=null,l="";if(void 0!==e&&e.success){var f;const r=bfSelect(`#form-${t}`),a=null===(f=bfSelect('input[name="b_h_t"]',r))||void 0===f?void 0:f.value;o(t),"object"==typeof e.data?(r&&function(e,t,o){const n=bfSelect("input[name='b_h_t']",t);if(n){n.value=e.hp_token;const r=bfSelect(`input[name="${o}"]`,t);r&&(r.name=e.hp_token)}}(e.data,r,a),c=e.data.redirectPage,e.data.cron&&(d=e.data.cron),e.data.cronNotOk&&(d=e.data.cronNotOk),e.data.new_nonce&&(l=e.data.new_nonce),n({contentId:t,msgId:e.data.msg_id,msg:e.data.message,show:!0,type:"warning",error:!1,id:1})):n({contentId:t,msg:e.data,show:!0,error:!1,id:2})}else{const o=new CustomEvent("bf-form-submit-error",{detail:{formId:t,errors:e.data}});bfSelect(`#form-${t}`).dispatchEvent(o),function(e,t){const{data:o}=e;o&&"string"==typeof o?n({contentId:t,msg:o,error:!0,show:!0,id:4}):o&&(void 0!==o.$form&&(n({contentId:t,msg:o.$form,error:!0,show:!0,id:5}),delete o.$form),Object.keys(o).length>0&&function(e,t){Object.keys(e).forEach((o=>{const n=bfSelect(`#form-${t} .${o}-err-txt`);n.innerHTML=e[o],n.parentElement.style.marginTop="5px",n.parentElement.style.height=`${n.offsetHeight}px`,n.parentElement.style.removeProperty("display")}))}(o,t))}(e,t)}if(c){r(d,l,t);const e=setTimeout((()=>{window.location=decodeURI(c),e&&clearTimeout(e)}),1e3)}else r(d,l,t);a(t,!1)})).catch((e=>{const o=null!=e&&e.message?e.message:"Unknown Error";n({contentId:t,msg:o,show:!0,type:"error",error:!0,id:3}),a(t,!1)}))}function o(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t){const t=new CustomEvent("bf-form-reset",{detail:{formId:e}});bfSelect(`#form-${e}`).dispatchEvent(t)}const o=window.bf_globals[e];bfSelect(`#form-${e}`).reset(),"undefined"!=typeof customFieldsReset&&customFieldsReset(),o.gRecaptchaSiteKey&&"v2"===o.gRecaptchaVersion&&resetCaptcha()}function n(e){let t=bfSelect(`#bf-form-msg-wrp-${e.contentId}`);t.firstChild&&t.firstChild.classList.remove("active"),t.innerHTML=`<div class="form-msg ${e.type}">${e.msg}</div>`,t=bfSelect(".form-msg",t),e.msgId&&(t=bfSelect(`.msg-content-${e.msgId}`,bfSelect(`#${e.contentId}`))),t&&(setTimeout((()=>{t.classList.add("active")}),100),setTimeout((()=>{t.classList.remove("active")}),5e3))}function r(e,t,o){const n=window.bf_globals[o];if(e)if("string"==typeof e){const t=new URL(e);t.protocol!==window.location.protocol&&(t.protocol=window.location.protocol),fetch(t)}else{const o=new URL(n.ajaxURL);o.searchParams.append("action","bitforms_trigger_workflow");const r={cronNotOk:e,token:t||n.nonce,id:n.appID};fetch(o,{method:"POST",body:JSON.stringify(r),headers:{"Content-Type":"application/json"}}).then((e=>e.json()))}}function a(e,t){bfSelect('button[type="submit"]',bfSelect(`#form-${e}`)).disabled=t}document.querySelectorAll("form").forEach((n=>{var r,s;null!==(r=n.id)&&void 0!==r&&r.startsWith("form-bitforms")&&(n.addEventListener("submit",(o=>function(o){o.preventDefault();const n=o.target.id.slice(o.target.id.indexOf("-")+1);if("undefined"!=typeof validateForm&&!validateForm({form:n})){const e=new CustomEvent("bf-form-validation-error",{detail:{formId:n,fieldId:"",error:""}});return void o.target.dispatchEvent(e)}a(n,!0);let r=new FormData(o.target);const s=window.bf_globals[n];"undefined"!=typeof advancedFileHandle&&(r=advancedFileHandle(s,r)),s.GCLID&&r.set("GCLID",s.GCLID);const i=[];Object.entries((null==s?void 0:s.fields)||{}).forEach((e=>{var t,o;null!==(t=e[1])&&void 0!==t&&null!==(o=t.valid)&&void 0!==o&&o.hide&&i.push(e[0])})),i.length&&r.append("hidden_fields",i),"v3"===(null==s?void 0:s.gRecaptchaVersion)&&null!=s&&s.gRecaptchaSiteKey?grecaptcha.ready((()=>{grecaptcha.execute(s.gRecaptchaSiteKey,{action:"submit"}).then((o=>{r.append("g-recaptcha-response",o),t(e(null==s?void 0:s.ajaxURL,r),n,r)}))})):t(e(null==s?void 0:s.ajaxURL,r),n,r)}(o))),null===(s=bfSelect('button[type="reset"]',n))||void 0===s||s.addEventListener("click",(e=>o(e,!0))))}))}));
