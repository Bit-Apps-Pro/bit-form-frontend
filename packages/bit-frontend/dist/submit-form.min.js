!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(e,t){const n=new URL(e);return n.searchParams.append("action","bitforms_submit_form"),fetch(n,{method:"POST",body:t})}function t(e,t,s){e.then((e=>new Promise(((n,o)=>{if(e.staus>400){const n=new CustomEvent("bf-form-submit-error",{detail:{formId:t,errors:result.data}});bfSelect(`#form-${t}`).dispatchEvent(n),500===e.staus?o(new Error("Mayebe Internal Server Error")):o(e.json())}else n(e.json())})))).then((e=>{const i=new CustomEvent("bf-form-submit-success",{detail:{formId:t,entryId:e.entryId,formData:s}});bfSelect(`#form-${t}`).dispatchEvent(i);let c=null,d=null,l="";if(void 0!==e&&e.success){const r=bfSelect(`#form-${t}`);var f,m;n(t),"object"==typeof e.data?(r&&(null==e||null===(f=e.data)||void 0===f||null===(m=f.hidden_fields)||void 0===m||m.map((e=>{setHdnFld(e,r)}))),c=e.data.redirectPage,e.data.cron&&(d=e.data.cron),e.data.cronNotOk&&(d=e.data.cronNotOk),e.data.new_nonce&&(l=e.data.new_nonce),o({contentId:t,msgId:e.data.msg_id,msg:e.data.message,show:!0,type:"warning",error:!1,id:1})):o({contentId:t,msg:e.data,show:!0,error:!1,id:2})}else{const n=new CustomEvent("bf-form-submit-error",{detail:{formId:t,errors:e.data}});bfSelect(`#form-${t}`).dispatchEvent(n),function(e,t){const{data:n}=e;n&&"string"==typeof n?o({contentId:t,msg:n,error:!0,show:!0,id:4}):n&&(void 0!==n.$form&&(o({contentId:t,msg:n.$form,error:!0,show:!0,id:5}),delete n.$form),Object.keys(n).length>0&&function(e,t){Object.keys(e).forEach((n=>{const o=bfSelect(`#form-${t} .${n}-err-txt`);o.innerHTML=e[n],o.parentElement.style.marginTop="5px",o.parentElement.style.height=`${o.offsetHeight}px`,o.parentElement.style.removeProperty("display")}))}(n,t))}(e,t)}if(c){r(d,l,t);const e=setTimeout((()=>{window.location=decodeURI(c),e&&clearTimeout(e)}),1e3)}else r(d,l,t);a(t,!1)})).catch((e=>{const n=null!=e&&e.message?e.message:"Unknown Error";o({contentId:t,msg:n,show:!0,type:"error",error:!0,id:3}),a(t,!1)}))}function n(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t){const t=new CustomEvent("bf-form-reset",{detail:{formId:e}});bfSelect(`#form-${e}`).dispatchEvent(t)}const n=window.bf_globals[e];bfSelect(`#form-${e}`).reset(),"undefined"!=typeof customFieldsReset&&customFieldsReset(),n.gRecaptchaSiteKey&&"v2"===n.gRecaptchaVersion&&resetCaptcha()}function o(e){let t=bfSelect(`#bf-form-msg-wrp-${e.contentId}`);t.innerHTML=`<div class="form-msg .deactive ${e.type}">${e.msg}</div>`,t=bfSelect(".form-msg",t),e.msgId&&(t=bfSelect(`.msg-content-${e.msgId} .msg-content`,bfSelect(`#${e.contentId}`)),t.innerHTML=e.msg,t=bfSelect(`.msg-container-${e.msgId}`,bfSelect(`#${e.contentId}`))),t&&t.classList.replace("active","deactive"),setTimeout((()=>{t.classList.add("active")}),100),setTimeout((()=>{t.classList.replace("active","deactive")}),5e3)}function r(e,t,n){const o=window.bf_globals[n];if(e)if("string"==typeof e){const t=new URL(e);t.protocol!==window.location.protocol&&(t.protocol=window.location.protocol),fetch(t)}else{const n=new URL(o.ajaxURL);n.searchParams.append("action","bitforms_trigger_workflow");const r={cronNotOk:e,token:t||o.nonce,id:o.appID};fetch(n,{method:"POST",body:JSON.stringify(r),headers:{"Content-Type":"application/json"}}).then((e=>e.json()))}}function a(e,t){bfSelect('button[type="submit"]',bfSelect(`#form-${e}`)).disabled=t}document.querySelectorAll("form").forEach((o=>{var r,s;null!==(r=o.id)&&void 0!==r&&r.startsWith("form-bitforms")&&(o.addEventListener("submit",(n=>function(n){n.preventDefault();const o=n.target.id.slice(n.target.id.indexOf("-")+1);if("undefined"!=typeof validateForm&&!validateForm({form:o})){const e=new CustomEvent("bf-form-validation-error",{detail:{formId:o,fieldId:"",error:""}});return void n.target.dispatchEvent(e)}a(o,!0);let r=new FormData(n.target);const s=window.bf_globals[o];"undefined"!=typeof advancedFileHandle&&(r=advancedFileHandle(s,r)),s.GCLID&&r.set("GCLID",s.GCLID);const i=[];Object.entries((null==s?void 0:s.fields)||{}).forEach((e=>{var t,n;null!==(t=e[1])&&void 0!==t&&null!==(n=t.valid)&&void 0!==n&&n.hide&&i.push(e[0])})),i.length&&r.append("hidden_fields",i),"v3"===(null==s?void 0:s.gRecaptchaVersion)&&null!=s&&s.gRecaptchaSiteKey?grecaptcha.ready((()=>{grecaptcha.execute(s.gRecaptchaSiteKey,{action:"submit"}).then((n=>{r.append("g-recaptcha-response",n),t(e(null==s?void 0:s.ajaxURL,r),o,r)}))})):t(e(null==s?void 0:s.ajaxURL,r),o,r)}(n))),null===(s=bfSelect('button[type="reset"]',o))||void 0===s||s.addEventListener("click",(e=>n(e,!0))))}))}));
