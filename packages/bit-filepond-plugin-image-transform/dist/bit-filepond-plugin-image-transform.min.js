var bit_filepond_plugin_image_transform=function(){"use strict";const t={jpeg:"jpg","svg+xml":"svg"},e=t=>/^image/.test(t.type),n={1:()=>[1,0,0,1,0,0],2:t=>[-1,0,0,1,t,0],3:(t,e)=>[-1,0,0,-1,t,e],4:(t,e)=>[1,0,0,-1,0,e],5:()=>[0,1,1,0,0,0],6:(t,e)=>[0,1,-1,0,e,0],7:(t,e)=>[0,-1,-1,0,e,t],8:t=>[0,-1,1,0,0,t]},i=(t,e)=>({x:t,y:e}),o=(t,e)=>i(t.x-e.x,t.y-e.y),r=(t,e)=>Math.sqrt(((t,e)=>((t,e)=>t.x*e.x+t.y*e.y)(o(t,e),o(t,e)))(t,e)),a=(t,e)=>{const n=t,o=e,r=1.5707963267948966-e,a=Math.sin(1.5707963267948966),l=Math.sin(o),h=Math.sin(r),s=Math.cos(r),c=n/a;return i(s*(c*l),s*(c*h))},l=(t,e)=>{const n=t.width,o=t.height,l=a(n,e),h=a(o,e),s=i(t.x+Math.abs(l.x),t.y-Math.abs(l.y)),c=i(t.x+t.width+Math.abs(h.y),t.y+Math.abs(h.x)),d=i(t.x-Math.abs(h.y),t.y+t.height-Math.abs(h.x));return{width:r(s,c),height:r(s,d)}},h=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{x:.5,y:.5};const o=i.x>.5?1-i.x:i.x,r=i.y>.5?1-i.y:i.y,a=2*o*t.width,h=2*r*t.height,s=l(e,n);return Math.max(s.width/a,s.height/h)},s=(t,e)=>{let n=t.width,i=n*e;return i>t.height&&(i=t.height,n=i/e),{x:.5*(t.width-n),y:.5*(t.height-i),width:n,height:i}},c=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const i=t.height/t.width;let o=e,r=1,a=i;a>o&&(a=o,r=a/i);const l=Math.max(1/r,o/a),h=t.width/(n*l*r);return{width:h,height:h*e}},d=t=>{t.width=1,t.height=1,t.getContext("2d").clearRect(0,0,1,1)},g=t=>t&&(t.horizontal||t.vertical),u=(t,e,i)=>{if(e<=1&&!g(i))return t.width=t.naturalWidth,t.height=t.naturalHeight,t;const o=document.createElement("canvas"),r=t.naturalWidth,a=t.naturalHeight,l=e>=5&&e<=8;l?(o.width=a,o.height=r):(o.width=r,o.height=a);const h=o.getContext("2d");if(e&&h.transform.apply(h,((t,e,i)=>(-1===i&&(i=1),n[i](t,e)))(r,a,e)),g(i)){const t=[1,0,0,1,0,0];(!l&&i.horizontal||l&i.vertical)&&(t[0]=-1,t[4]=r),(!l&&i.vertical||l&&i.horizontal)&&(t[3]=-1,t[5]=a),h.transform(...t)}return h.drawImage(t,0,0,r,a),o},m=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{canvasMemoryLimit:o,background:r=null}=i,a=n.zoom||1,l=u(t,e,n.flip),g={width:l.width,height:l.height},m=n.aspectRatio||g.height/g.width;let y=c(g,m,a);if(o){const t=y.width*y.height;if(t>o){const e=Math.sqrt(o)/Math.sqrt(t);g.width=Math.floor(g.width*e),g.height=Math.floor(g.height*e),y=c(g,m,a)}}const f=document.createElement("canvas"),p={x:.5*y.width,y:.5*y.height},w={x:0,y:0,width:y.width,height:y.height,center:p},x=void 0===n.scaleToFit||n.scaleToFit,M=a*h(g,s(w,m),n.rotation,x?n.center:{x:.5,y:.5});f.width=Math.round(y.width/M),f.height=Math.round(y.height/M),p.x/=M,p.y/=M;const T=p.x-g.width*(n.center?n.center.x:.5),A=p.y-g.height*(n.center?n.center.y:.5),b=f.getContext("2d");r&&(b.fillStyle=r,b.fillRect(0,0,f.width,f.height)),b.translate(p.x,p.y),b.rotate(n.rotation||0),b.drawImage(l,T-p.x,A-p.y,g.width,g.height);const v=b.getImageData(0,0,f.width,f.height);return d(f),v};"undefined"!=typeof window&&void 0!==window.document&&(HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,n){var i=this.toDataURL(e,n).split(",")[1];setTimeout((function(){for(var n=atob(i),o=n.length,r=new Uint8Array(o),a=0;a<o;a++)r[a]=n.charCodeAt(a);t(new Blob([r],{type:e||"image/png"}))}))}}));const y=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise((i=>{const o=n?n(t):t;Promise.resolve(o).then((t=>{t.toBlob(i,e.type,e.quality)}))}))},f=(t,e)=>M(t.x*e,t.y*e),p=(t,e)=>M(t.x+e.x,t.y+e.y),w=t=>{const e=Math.sqrt(t.x*t.x+t.y*t.y);return 0===e?{x:0,y:0}:M(t.x/e,t.y/e)},x=(t,e,n)=>{const i=Math.cos(e),o=Math.sin(e),r=M(t.x-n.x,t.y-n.y);return M(n.x+i*r.x-o*r.y,n.y+o*r.x+i*r.y)},M=function(){return{x:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y:arguments.length>1&&void 0!==arguments[1]?arguments[1]:0}},T=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3?arguments[3]:void 0;return"string"==typeof t?parseFloat(t)*n:"number"==typeof t?t*(i?e[i]:Math.min(e.width,e.height)):void 0},A=(t,e,n)=>{const i=t.borderStyle||t.lineStyle||"solid",o=t.backgroundColor||t.fontColor||"transparent",r=t.borderColor||t.lineColor||"transparent",a=T(t.borderWidth||t.lineWidth,e,n);return{"stroke-linecap":t.lineCap||"round","stroke-linejoin":t.lineJoin||"round","stroke-width":a||0,"stroke-dasharray":"string"==typeof i?"":i.map((t=>T(t,e,n))).join(","),stroke:r,fill:o,opacity:t.opacity||1}},b=t=>null!=t,v=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=T(t.x,e,n,"width")||T(t.left,e,n,"width"),o=T(t.y,e,n,"height")||T(t.top,e,n,"height"),r=T(t.width,e,n,"width"),a=T(t.height,e,n,"height"),l=T(t.right,e,n,"width"),h=T(t.bottom,e,n,"height");return b(o)||(o=b(a)&&b(h)?e.height-a-h:h),b(i)||(i=b(r)&&b(l)?e.width-r-l:l),b(r)||(r=b(i)&&b(l)?e.width-i-l:0),b(a)||(a=b(o)&&b(h)?e.height-o-h:0),{x:i||0,y:o||0,width:r||0,height:a||0}},R=(t,e)=>Object.keys(e).forEach((n=>t.setAttribute(n,e[n]))),_=(t,e)=>{const n=document.createElementNS("http://www.w3.org/2000/svg",t);return e&&R(n,e),n},E={contain:"xMidYMid meet",cover:"xMidYMid slice"},I={left:"start",center:"middle",right:"end"},O=t=>e=>_(t,{id:e.id}),N={image:t=>{const e=_("image",{id:t.id,"stroke-linecap":"round","stroke-linejoin":"round",opacity:"0"});return e.onload=()=>{e.setAttribute("opacity",t.opacity||1)},e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t.src),e},rect:O("rect"),ellipse:O("ellipse"),text:O("text"),path:O("path"),line:t=>{const e=_("g",{id:t.id,"stroke-linecap":"round","stroke-linejoin":"round"}),n=_("line");e.appendChild(n);const i=_("path");e.appendChild(i);const o=_("path");return e.appendChild(o),e}},L={rect:t=>R(t,{...t.rect,...t.styles}),ellipse:t=>{const e=t.rect.x+.5*t.rect.width,n=t.rect.y+.5*t.rect.height,i=.5*t.rect.width,o=.5*t.rect.height;return R(t,{cx:e,cy:n,rx:i,ry:o,...t.styles})},image:(t,e)=>{R(t,{...t.rect,...t.styles,preserveAspectRatio:E[e.fit]||"none"})},text:(t,e,n,i)=>{const o=T(e.fontSize,n,i),r=e.fontFamily||"sans-serif",a=e.fontWeight||"normal",l=I[e.textAlign]||"start";R(t,{...t.rect,...t.styles,"stroke-width":0,"font-weight":a,"font-size":o,"font-family":r,"text-anchor":l}),t.text!==e.text&&(t.text=e.text,t.textContent=e.text.length?e.text:" ")},path:(t,e,n,i)=>{var o;R(t,{...t.styles,fill:"none",d:(o=e.points.map((t=>({x:T(t.x,n,i,"width"),y:T(t.y,n,i,"height")}))),o.map(((t,e)=>`${0===e?"M":"L"} ${t.x} ${t.y}`)).join(" "))})},line:(t,e,n,i)=>{R(t,{...t.rect,...t.styles,fill:"none"});const o=t.childNodes[0],r=t.childNodes[1],a=t.childNodes[2],l=t.rect,h={x:t.rect.x+t.rect.width,y:t.rect.y+t.rect.height};if(R(o,{x1:l.x,y1:l.y,x2:h.x,y2:h.y}),!e.lineDecoration)return;r.style.display="none",a.style.display="none";const s=w({x:h.x-l.x,y:h.y-l.y}),c=T(.05,n,i);if(-1!==e.lineDecoration.indexOf("arrow-begin")){const t=f(s,c),e=p(l,t),n=x(l,2,e),i=x(l,-2,e);R(r,{style:"display:block;",d:`M${n.x},${n.y} L${l.x},${l.y} L${i.x},${i.y}`})}if(-1!==e.lineDecoration.indexOf("arrow-end")){const t=f(s,-c),e=p(h,t),n=x(h,2,e),i=x(h,-2,e);R(a,{style:"display:block;",d:`M${n.x},${n.y} L${h.x},${h.y} L${i.x},${i.y}`})}}},C=(t,e)=>N[t](e),U=(t,e,n,i,o)=>{"path"!==e&&(t.rect=v(n,i,o)),t.styles=A(n,i,o),L[e](t,n,i,o)},S=(t,e)=>t[1].zIndex>e[1].zIndex?1:t[1].zIndex<e[1].zIndex?-1:0,P=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;return new Promise((o=>{const{background:r=null}=i,a=new FileReader;a.onloadend=()=>{const t=a.result,i=document.createElement("div");i.style.cssText="position:absolute;pointer-events:none;width:0;height:0;visibility:hidden;",i.innerHTML=t;const l=i.querySelector("svg");document.body.appendChild(i);const c=l.getBBox();i.parentNode.removeChild(i);const d=i.querySelector("title"),g=l.getAttribute("viewBox")||"",u=l.getAttribute("width")||"",m=l.getAttribute("height")||"";let y=parseFloat(u)||null,f=parseFloat(m)||null;const p=(u.match(/[a-z]+/)||[])[0]||"",w=(m.match(/[a-z]+/)||[])[0]||"",x=g.split(" ").map(parseFloat),M=x.length?{x:x[0],y:x[1],width:x[2],height:x[3]}:c;let T=null!=y?y:M.width,A=null!=f?f:M.height;l.style.overflow="visible",l.setAttribute("width",T),l.setAttribute("height",A);let b="";if(n&&n.length){const t={width:T,height:A};b=n.sort(S).reduce(((e,n)=>{const i=C(n[0],n[1]);return U(i,n[0],n[1],t),i.removeAttribute("id"),1===i.getAttribute("opacity")&&i.removeAttribute("opacity"),e+"\n"+i.outerHTML+"\n"}),""),b=`\n\n<g>${b.replace(/&nbsp;/g," ")}</g>\n\n`}const v=e.aspectRatio||A/T,R=T,_=R*v,E=void 0===e.scaleToFit||e.scaleToFit,I=e.center?e.center.x:.5,O=e.center?e.center.y:.5,N=h({width:T,height:A},s({width:R,height:_},v),e.rotation,E?{x:I,y:O}:{x:.5,y:.5}),L=e.zoom*N,P=.5*R,$=.5*_,k=[`rotate(${e.rotation*(180/Math.PI)} ${P} ${$})`,`translate(${P} ${$})`,`scale(${L})`,`translate(${-P} ${-$})`,`translate(${P-T*I} ${$-A*O})`],B=e.flip&&e.flip.horizontal,F=e.flip&&e.flip.vertical,G=[`scale(${B?-1:1} ${F?-1:1})`,`translate(${B?-T:0} ${F?-A:0})`],z=`<?xml version="1.0" encoding="UTF-8"?>\n<svg width="${R}${p}" height="${_}${w}" \nviewBox="0 0 ${R} ${_}" ${r?'style="background:'+r+'" ':""}\npreserveAspectRatio="xMinYMin"\nxmlns:xlink="http://www.w3.org/1999/xlink"\nxmlns="http://www.w3.org/2000/svg">\n\x3c!-- Generated by PQINA - https://pqina.nl/ --\x3e\n<title>${d?d.textContent:""}</title>\n<g transform="${k.join(" ")}">\n<g transform="${G.join(" ")}">\n${l.outerHTML}${b}\n</g>\n</g>\n</svg>`;o(z)},a.readAsText(t)}))},$=t=>{let e;try{e=new ImageData(t.width,t.height)}catch(n){e=document.createElement("canvas").getContext("2d").createImageData(t.width,t.height)}return e.data.set(t.data),e},k=()=>{const t={resize:function(t,e){let{mode:n="contain",upscale:i=!1,width:r,height:h,matrix:s}=e;if(s=!s||a(s)?null:s,!r&&!h)return l(t,s);if(null===r?r=h:null===h&&(h=r),"force"!==n){let e=r/t.width,o=h/t.height,a=1;if("cover"===n?a=Math.max(e,o):"contain"===n&&(a=Math.min(e,o)),a>1&&!1===i)return l(t,s);r=t.width*a,h=t.height*a}const c=t.width,d=t.height,g=Math.round(r),u=Math.round(h),m=t.data,y=new Uint8ClampedArray(g*u*4),f=c/g,p=d/u,w=Math.ceil(.5*f),x=Math.ceil(.5*p);for(let t=0;t<u;t++)for(let e=0;e<g;e++){let n=4*(e+t*g),i=0,r=0,a=0,l=0,h=0,d=0,u=0,M=(t+.5)*p;for(let n=Math.floor(t*p);n<(t+1)*p;n++){let t=Math.abs(M-(n+.5))/x,o=(e+.5)*f,s=t*t;for(let t=Math.floor(e*f);t<(e+1)*f;t++){let e=Math.abs(o-(t+.5))/w,g=Math.sqrt(s+e*e);if(g>=-1&&g<=1&&(i=2*g*g*g-3*g*g+1,i>0)){e=4*(t+n*c);let o=m[e+3];u+=i*o,a+=i,o<255&&(i=i*o/250),l+=i*m[e],h+=i*m[e+1],d+=i*m[e+2],r+=i}}}y[n]=l/r,y[n+1]=h/r,y[n+2]=d/r,y[n+3]=u/a,s&&o(n,y,s)}return{data:y,width:g,height:u}},filter:l};self.onmessage=e=>{((n,i)=>{let o=n.transforms,r=null;if(o.forEach((t=>{"filter"===t.type&&(r=t)})),r){let t=null;o.forEach((e=>{"resize"===e.type&&(t=e)})),t&&(t.data.matrix=r.data,o=o.filter((t=>"filter"!==t.type)))}var a;a=((e,n)=>(e.forEach((e=>{n=t[e.type](n,e.data)})),n))(o,n.imageData),self.postMessage({id:e.data.id,message:a},[a.data.buffer])})(e.data.message)};const e=1,n=1,i=1;function o(t,o,r){const a=o[t]/255,l=o[t+1]/255,h=o[t+2]/255,s=o[t+3]/255,c=a*r[0]+l*r[1]+h*r[2]+s*r[3]+r[4],d=a*r[5]+l*r[6]+h*r[7]+s*r[8]+r[9],g=a*r[10]+l*r[11]+h*r[12]+s*r[13]+r[14],u=a*r[15]+l*r[16]+h*r[17]+s*r[18]+r[19],m=Math.max(0,c*u)+e*(1-u),y=Math.max(0,d*u)+n*(1-u),f=Math.max(0,g*u)+i*(1-u);o[t]=255*Math.max(0,Math.min(1,m)),o[t+1]=255*Math.max(0,Math.min(1,y)),o[t+2]=255*Math.max(0,Math.min(1,f))}const r=self.JSON.stringify([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]);function a(t){return self.JSON.stringify(t||[])===r}function l(t,o){if(!o||a(o))return t;const r=t.data,l=r.length,h=o[0],s=o[1],c=o[2],d=o[3],g=o[4],u=o[5],m=o[6],y=o[7],f=o[8],p=o[9],w=o[10],x=o[11],M=o[12],T=o[13],A=o[14],b=o[15],v=o[16],R=o[17],_=o[18],E=o[19];let I=0,O=0,N=0,L=0,C=0,U=0,S=0,P=0,$=0,k=0,B=0,F=0;for(;I<l;I+=4)O=r[I]/255,N=r[I+1]/255,L=r[I+2]/255,C=r[I+3]/255,U=O*h+N*s+L*c+C*d+g,S=O*u+N*m+L*y+C*f+p,P=O*w+N*x+L*M+C*T+A,$=O*b+N*v+L*R+C*_+E,k=Math.max(0,U*$)+e*(1-$),B=Math.max(0,S*$)+n*(1-$),F=Math.max(0,P*$)+i*(1-$),r[I]=255*Math.max(0,Math.min(1,k)),r[I+1]=255*Math.max(0,Math.min(1,B)),r[I+2]=255*Math.max(0,Math.min(1,F));return t}},B=(t,e)=>{if(1165519206!==t.getUint32(e+4,!1))return;e+=4;const n=18761===t.getUint16(e+=6,!1);e+=t.getUint32(e+4,n);const i=t.getUint16(e,n);e+=2;for(let o=0;o<i;o++)if(274===t.getUint16(e+12*o,n))return t.setUint16(e+12*o+8,1,n),!0;return!1},F=t=>new Promise((e=>{const n=new FileReader;n.onload=()=>e((t=>{const e=new DataView(t);if(65496!==e.getUint16(0))return null;let n,i,o=2,r=!1;for(;o<e.byteLength&&(n=e.getUint16(o,!1),i=e.getUint16(o+2,!1)+2,n>=65504&&n<=65519||65534===n)&&(r||(r=B(e,o)),!(o+i>e.byteLength));)o+=i;return t.slice(0,o)})(n.result)||null),n.readAsArrayBuffer(t.slice(0,262144))})),G=(t,e)=>{const n=window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(n){const i=new n;return i.append(t),i.getBlob(e)}return new Blob([t],{type:e})},z=t=>{const e=new Blob(["(",t.toString(),")()"],{type:"application/javascript"}),n=URL.createObjectURL(e),i=new Worker(n),o=[];return{transfer:()=>{},post:(t,e,n)=>{const r=Math.random().toString(36).substr(2,9);o[r]=e,i.onmessage=t=>{const e=o[t.data.id];e&&(e(t.data.message),delete o[t.data.id])},i.postMessage({id:r,message:t},n)},terminate:()=>{i.terminate(),URL.revokeObjectURL(n)}}},D=t=>new Promise(((e,n)=>{const i=new Image;i.onload=()=>{e(i)},i.onerror=t=>{n(t)},i.src=t})),j=(t,e)=>new Promise((n=>{const i={width:t.width,height:t.height},o=t.getContext("2d"),r=e.sort(S).map((t=>()=>new Promise((e=>{V[t[0]](o,i,t[1],e)&&e()}))));var a;(a=r,a.reduce(((t,e)=>t.then((t=>e().then(Array.prototype.concat.bind(t))))),Promise.resolve([]))).then((()=>n(t)))})),q=(t,e)=>{t.beginPath(),t.lineCap=e["stroke-linecap"],t.lineJoin=e["stroke-linejoin"],t.lineWidth=e["stroke-width"],e["stroke-dasharray"].length&&t.setLineDash(e["stroke-dasharray"].split(",")),t.fillStyle=e.fill,t.strokeStyle=e.stroke,t.globalAlpha=e.opacity||1},H=t=>{t.fill(),t.stroke(),t.globalAlpha=1},V={rect:(t,e,n)=>{const i=v(n,e),o=A(n,e);return q(t,o),t.rect(i.x,i.y,i.width,i.height),H(t),!0},ellipse:(t,e,n)=>{const i=v(n,e),o=A(n,e);q(t,o);const r=i.x,a=i.y,l=i.width,h=i.height,s=.5522848,c=l/2*s,d=h/2*s,g=r+l,u=a+h,m=r+l/2,y=a+h/2;return t.moveTo(r,y),t.bezierCurveTo(r,y-d,m-c,a,m,a),t.bezierCurveTo(m+c,a,g,y-d,g,y),t.bezierCurveTo(g,y+d,m+c,u,m,u),t.bezierCurveTo(m-c,u,r,y+d,r,y),H(t),!0},image:(t,e,n,i)=>{const o=v(n,e),r=A(n,e);q(t,r);const a=new Image;new URL(n.src,window.location.href).origin!==window.location.origin&&(a.crossOrigin=""),a.onload=()=>{if("cover"===n.fit){const e=o.width/o.height,n=e>1?a.width:a.height*e,i=e>1?a.width/e:a.height,r=.5*a.width-.5*n,l=.5*a.height-.5*i;t.drawImage(a,r,l,n,i,o.x,o.y,o.width,o.height)}else if("contain"===n.fit){const e=Math.min(o.width/a.width,o.height/a.height),n=e*a.width,i=e*a.height,r=o.x+.5*o.width-.5*n,l=o.y+.5*o.height-.5*i;t.drawImage(a,0,0,a.width,a.height,r,l,n,i)}else t.drawImage(a,0,0,a.width,a.height,o.x,o.y,o.width,o.height);H(t),i()},a.src=n.src},text:(t,e,n)=>{const i=v(n,e),o=A(n,e);q(t,o);const r=T(n.fontSize,e),a=n.fontFamily||"sans-serif",l=n.fontWeight||"normal",h=n.textAlign||"left";return t.font=`${l} ${r}px ${a}`,t.textAlign=h,t.fillText(n.text,i.x,i.y),H(t),!0},line:(t,e,n)=>{const i=v(n,e),o=A(n,e);q(t,o),t.beginPath();const r={x:i.x,y:i.y},a={x:i.x+i.width,y:i.y+i.height};t.moveTo(r.x,r.y),t.lineTo(a.x,a.y);const l=w({x:a.x-r.x,y:a.y-r.y}),h=.04*Math.min(e.width,e.height);if(-1!==n.lineDecoration.indexOf("arrow-begin")){const e=f(l,h),n=p(r,e),i=x(r,2,n),o=x(r,-2,n);t.moveTo(i.x,i.y),t.lineTo(r.x,r.y),t.lineTo(o.x,o.y)}if(-1!==n.lineDecoration.indexOf("arrow-end")){const e=f(l,-h),n=p(a,e),i=x(a,2,n),o=x(a,-2,n);t.moveTo(i.x,i.y),t.lineTo(a.x,a.y),t.lineTo(o.x,o.y)}return H(t),!0},path:(t,e,n)=>{const i=A(n,e);q(t,i),t.beginPath();const o=n.points.map((t=>({x:T(t.x,e,1,"width"),y:T(t.y,e,1,"height")})));t.moveTo(o[0].x,o[0].y);const r=o.length;for(let e=1;e<r;e++)t.lineTo(o[e].x,o[e].y);return H(t),!0}},W=t=>{const e=document.createElement("canvas");return e.width=t.width,e.height=t.height,e.getContext("2d").putImageData(t,0,0),e},Y=["x","y","left","top","right","bottom","width","height"],Q=t=>{const[e,n]=t,i=n.points?{}:Y.reduce(((t,e)=>{var i;return t[e]="string"==typeof(i=n[e])&&/%/.test(i)?parseFloat(i)/100:i,t}),{});return[e,{zIndex:0,...n,...i}]};"undefined"!=typeof window&&void 0!==window.document&&(HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,n){const i=this;setTimeout((()=>{const o=i.toDataURL(e,n).split(",")[1],r=atob(o);let a=r.length;const l=new Uint8Array(a);for(;a--;)l[a]=r.charCodeAt(a);t(new Blob([l],{type:e||"image/png"}))}))}}));const J="undefined"!=typeof window&&void 0!==window.document,K=J&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,X=n=>{let{addFilter:i,utils:o}=n;const{Type:r,forin:a,getFileFromBlob:l,isFile:h}=o,s=["crop","resize","filter","markup","output"],c=t=>null===t.aspectRatio&&0===t.rotation&&1===t.zoom&&t.center&&.5===t.center.x&&.5===t.center.y&&t.flip&&!1===t.flip.horizontal&&!1===t.flip.vertical;return i("SHOULD_PREPARE_OUTPUT",((t,e)=>{let{query:n}=e;return new Promise((t=>{t(!n("IS_ASYNC"))}))})),i("DID_CREATE_ITEM",((t,e)=>{let{query:n,dispatch:i}=e;n("GET_ALLOW_IMAGE_TRANSFORM")&&t.extend("requestPrepare",(()=>new Promise(((e,n)=>{i("REQUEST_PREPARE_OUTPUT",{query:t.id,item:t,success:e,failure:n},!0)}))))})),i("PREPARE_OUTPUT",((n,i)=>{let{query:o,item:r}=i;return new Promise((i=>{((t,e,n)=>new Promise((i=>{if(!t("GET_ALLOW_IMAGE_TRANSFORM")||n.archived||!h(e)||!(t=>/^image/.test(t.type))(e))return i(!1);(t=>new Promise(((e,n)=>{const i=new Image;i.src=URL.createObjectURL(t);const o=()=>{const t=i.naturalWidth,n=i.naturalHeight;t&&n&&(URL.revokeObjectURL(i.src),clearInterval(r),e({width:t,height:n}))};i.onerror=t=>{URL.revokeObjectURL(i.src),clearInterval(r),n(t)};const r=setInterval(o,1);o()})))(e).then((()=>{const n=t("GET_IMAGE_TRANSFORM_IMAGE_FILTER");if(n){const t=n(e);if(null==t)return handleRevert(!0);if("boolean"==typeof t)return i(t);if("function"==typeof t.then)return t.then(i)}i(!0)})).catch((t=>{i(!1)}))})))(o,n,r).then((h=>{if(!h)return i(n);const g=[];o("GET_IMAGE_TRANSFORM_VARIANTS_INCLUDE_ORIGINAL")&&g.push((()=>new Promise((t=>{t({name:o("GET_IMAGE_TRANSFORM_VARIANTS_ORIGINAL_NAME"),file:n})})))),o("GET_IMAGE_TRANSFORM_VARIANTS_INCLUDE_DEFAULT")&&g.push(((t,e,n)=>new Promise((i=>{t(e,n).then((t=>i({name:o("GET_IMAGE_TRANSFORM_VARIANTS_DEFAULT_NAME"),file:t})))}))));const u=o("GET_IMAGE_TRANSFORM_VARIANTS")||{};a(u,((t,e)=>{const n=(i=e,(t,e,n)=>t(e,i?i(n):n));var i;g.push(((e,i,o)=>new Promise((r=>{n(e,i,o).then((e=>r({name:t,file:e})))}))))}));const f=o("GET_IMAGE_TRANSFORM_OUTPUT_QUALITY"),p=o("GET_IMAGE_TRANSFORM_OUTPUT_QUALITY_MODE"),w=null===f?null:f/100,x=o("GET_IMAGE_TRANSFORM_OUTPUT_MIME_TYPE"),M=o("GET_IMAGE_TRANSFORM_CLIENT_TRANSFORMS")||s;r.setMetadata("output",{type:x,quality:w,client:M},!0);const T=(n,i)=>new Promise(((r,a)=>{const h={...i};Object.keys(h).filter((t=>"exif"!==t)).forEach((t=>{-1===M.indexOf(t)&&delete h[t]}));const{resize:s,exif:g,output:u,crop:f,filter:w,markup:x}=h,T={image:{orientation:g?g.orientation:null},output:u&&(u.type||"number"==typeof u.quality||u.background)?{type:u.type,quality:"number"==typeof u.quality?100*u.quality:null,background:u.background||o("GET_IMAGE_TRANSFORM_CANVAS_BACKGROUND_COLOR")||null}:void 0,size:s&&(s.size.width||s.size.height)?{mode:s.mode,upscale:s.upscale,...s.size}:void 0,crop:f&&!c(f)?{...f}:void 0,markup:x&&x.length?x.map(Q):[],filter:w};if(T.output){const t=!!u.type&&u.type!==n.type,e=/\/jpe?g$/.test(n.type),i=null!==u.quality&&e&&"always"===p;if(!(T.size||T.crop||T.filter||t||i))return r(n)}const A={beforeCreateBlob:o("GET_IMAGE_TRANSFORM_BEFORE_CREATE_BLOB"),afterCreateBlob:o("GET_IMAGE_TRANSFORM_AFTER_CREATE_BLOB"),canvasMemoryLimit:o("GET_IMAGE_TRANSFORM_CANVAS_MEMORY_LIMIT"),stripImageHead:o("GET_IMAGE_TRANSFORM_OUTPUT_STRIP_IMAGE_HEAD")};(function(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(((o,r)=>{if(!t||!e(t))return r({status:"not an image file",file:t});const{stripImageHead:a,beforeCreateBlob:l,afterCreateBlob:h,canvasMemoryLimit:s}=i,{crop:c,size:g,filter:u,markup:f,output:p}=n,w=n.image&&n.image.orientation?Math.max(1,Math.min(8,n.image.orientation)):null,x=p&&p.quality,M=null===x?null:x/100,T=p&&p.type||null,A=p&&p.background||null,b=[];!g||"number"!=typeof g.width&&"number"!=typeof g.height||b.push({type:"resize",data:g}),u&&20===u.length&&b.push({type:"filter",data:u});const v=t=>{const e=h?h(t):t;Promise.resolve(e).then(o)},R=(e,n)=>{const i=W(e),o=f.length?j(i,f):i;Promise.resolve(o).then((e=>{y(e,n,l).then((n=>{if(d(e),a)return v(n);F(t).then((t=>{null!==t&&(n=new Blob([t,n.slice(20)],{type:n.type})),v(n)}))})).catch(r)}))};if(/svg/.test(t.type)&&null===T)return P(t,c,f,{background:A}).then((t=>{o(G(t,"image/svg+xml"))}));const _=URL.createObjectURL(t);D(_).then((e=>{URL.revokeObjectURL(_);const n=m(e,w,c,{canvasMemoryLimit:s,background:A}),i={quality:M,type:T||t.type};if(!b.length)return R(n,i);const o=z(k);o.post({transforms:b,imageData:n},(t=>{R($(t),i),o.terminate()}),[n.data.buffer])})).catch(r)}))})(n,T,A).then((e=>{const i=l(e,((e,n)=>{const i=(t=>t.substr(0,t.lastIndexOf("."))||t)(e),o=n.split("/")[1];return`${i}.${t[o]||o}`})(n.name,(t=>/jpeg|png|svg\+xml/.test(t)?t:"image/jpeg")(e.type)));r(i)})).catch(a)})),A=g.map((t=>t(T,n,r.getMetadata())));Promise.all(A).then((t=>{i(1===t.length&&null===t[0].name?t[0].file:t)}))}))}))})),{options:{allowImageTransform:[!0,r.BOOLEAN],imageTransformImageFilter:[null,r.FUNCTION],imageTransformOutputMimeType:[null,r.STRING],imageTransformOutputQuality:[null,r.INT],imageTransformOutputStripImageHead:[!0,r.BOOLEAN],imageTransformClientTransforms:[null,r.ARRAY],imageTransformOutputQualityMode:["always",r.STRING],imageTransformVariants:[null,r.OBJECT],imageTransformVariantsIncludeDefault:[!0,r.BOOLEAN],imageTransformVariantsDefaultName:[null,r.STRING],imageTransformVariantsIncludeOriginal:[!1,r.BOOLEAN],imageTransformVariantsOriginalName:["original_",r.STRING],imageTransformBeforeCreateBlob:[null,r.FUNCTION],imageTransformAfterCreateBlob:[null,r.FUNCTION],imageTransformCanvasMemoryLimit:[J&&K?16777216:null,r.INT],imageTransformCanvasBackgroundColor:[null,r.STRING]}}};return J&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:X})),X}();
