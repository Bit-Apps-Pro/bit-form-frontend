!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).bit_conditionals=t()}(this,(function(){"use strict";const e=(e,t,r)=>{switch(e){case"and":return t&&r;case"or":return t||r;default:return!1}},t=(e,t,m,y)=>{switch(e.logic){case"equal":return r(e,t,m,y);case"not_equal":return i(e,t,m,y);case"null":return m&&0===m.length;case"not_null":return m&&m.length>0;case"contain":return n(e,t,m,y);case"contain_all":return l(e,t,m,y);case"not_contain":return s(e,t,m,y);case"greater":return a(e,t,m,y);case"less":return u(e,t,m,y);case"greater_or_equal":return o(e,t,m,y);case"less_or_equal":return c(e,t,m,y);case"start_with":return f(e,t,m,y);case"end_with":return d(e,t,m,y);case"between":return h(e,t,m,y);default:return!1}},r=(e,t,r,i)=>{if(!t[e.field].value)return!1;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===r||Array.isArray(r)){const e=Array.isArray(r)?r:JSON.parse(r),t=i.split(",");let n=0;return e.forEach((r=>{e.length>0&&-1!==t.indexOf(r)&&(n+=1)})),n===t.length&&t.length===e.length}return r===i},i=(e,t,r,i)=>{if(!r)return!1;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===r||Array.isArray(r)){const e=Array.isArray(r)?r:JSON.parse(r),t=i.split(",");if(e.length!==t.length)return!0;let n=0;return t.forEach((t=>{e.length>0&&-1===e.indexOf(t)&&(n+=1)})),t.length===n}return r!==i},n=(e,t,r,i)=>{if(!r)return!1;const n=i.split(",");let l=0;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===r||Array.isArray(r)){const e=Array.isArray(r)?r:JSON.parse(r);return n.forEach((t=>{e.length>0&&-1!==e.indexOf(t)&&(l+=1)})),l>0}return n.forEach((e=>{r.length>0&&-1!==r.indexOf(e)&&(l+=1)})),l>0},l=(e,t,r,i)=>{if(!r)return!1;const n=i.split(",");let l=0;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===r||Array.isArray(r)){const e=Array.isArray(r)?r:JSON.parse(r);return n.forEach((t=>{e.length>0&&-1!==e.indexOf(t)&&(l+=1)})),l>=n.length}return!1},s=(e,t,r,i)=>{if(!r)return!1;const n=i.split(",");let l=0;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===r||Array.isArray(r)){const e=Array.isArray(r)?r:JSON.parse(r);return n.forEach((t=>{e.length>0&&-1===e.indexOf(t)&&(l+=1)})),l===n.length}return n.forEach((e=>{r.length>0&&-1===r.indexOf(e)&&(l+=1)})),l===n.length},a=(e,t,r,i)=>!!r&&("number"===t[e.field].type?""!==r&&Number(r)>Number(i):""!==r&&r>i),u=(e,t,r,i)=>!!r&&("number"===t[e.field].type?""!==r&&Number(r)<Number(i):""!==r&&r<i),o=(e,t,r,i)=>!!r&&("number"===t[e.field].type?""!==r&&Number(r)>=Number(i):""!==r&&r>=i),c=(e,t,r,i)=>!!r&&("number"===t[e.field].type?""!==r&&Number(r)<=Number(i):""!==r&&r<=i),f=(e,t,r,i)=>!!r&&""!==r&&0===r.indexOf(i),d=(e,t,r,i)=>!!r&&i===r.substr(r.length-i.length,r.length),h=(e,t,r,i)=>{if(!r)return!1;let n=r,l=i.min,s=i.max;return"number"===t[e.field].type&&(n=Number(r),l=Number(i.min),s=Number(i.max)),n>=l&&n<=s},m=(r,i,n)=>{if(Array.isArray(r)){let t=!1;for(let l=0;l<r.length;l+=1){const s=r[l];if("string"!=typeof s){const a=m(s,i,n);if(0===l&&(t=a),l-1>=0&&"string"==typeof r[l-1]){const i=r[l-1].toLowerCase();t=e(i,t,a)}}}return t}const l=y(r.val,i);if(void 0!==i[r.field]){const e=i[r.field].value;return t(r,i,e,l)}const s=Object.entries(n.smartTags).reduce(((e,t)=>{let[i,n]=t;return{...e,[`\${${i}${"string"==typeof n?"":"()"}}`]:{value:"string"==typeof n?n:n?.[r?.smartKey]||"",type:"text",multiple:!1}}}),{}),a=y(r.field,s);return t(r,s,a,l)},y=(e,t)=>{if(!e)return e;let r;if(r="object"==typeof e?JSON.stringify(e):JSON.parse(JSON.stringify(e)),"string"!=typeof r)return e;const i=r.match(/\${\w[^${}]*}/g);return i&&i.map((e=>{let i=e;if(t[i]||(i=e.substring(2,e.length-1)),t[i]){let n=t[i].value;Array.isArray(t[i].value)&&!Number.isNaN(t[i].value[0])&&(n=0,t[i].value.map((e=>{n+=Number(e)}))),r=r.replace(e,n)}})),p(r)},p=e=>{if(!e)return e;let t=e;const r=e.match(/[\\+\-\\*\\/\\%]/g);if(r&&r.length>0){const r=e.match(/\w+/g);if(!r)return e;const i=r.filter((e=>Number.isNaN(e)));if(i&&i.length>0)return t;t=t.replace(/\{|\[/g,"("),t=t.replace(/\}|\]/g,")");try{t=Function(`"use strict"; return (${t})`)()}catch(t){return e}}return t},g=(e,t,r)=>{t.inits&&t.inits[e]?t.inits[e].disabled=r:document.querySelector(`.${e}-fld`).disabled=r},b=(e,t,r)=>{t.fields[e.field]&&(t.fields[e.field].valid.hide=r)},v=(e,t)=>Object.keys(t).find((r=>t[r].fieldName===e)),A=e=>"[]"===e.slice(-2)?e.slice(0,e.length-2):e;return function(e){if(!e?.target?.form)return;const t=e.target,{form:r}=e.target,i=r.id.replace("form-",""),n=window.bf_globals?.[i];if(!n)return;const l=A(t.name),s=v(l,n.fields);if(!s)return;const a=((e,t)=>{const r=new FormData(e),{fields:i}=t,n={};return Array.from(r.entries()).forEach((e=>{let[t,r]=e;const l=v(A(t),i);l in i&&(n[l]?(Array.isArray(n[l])||(n[l]=[n[l]]),n[l].push(r)):n[l]=r)})),Object.entries(n).reduce(((e,t)=>{let[r,n]=t;return{...e,[r]:{value:n,type:i[r].typ,multiple:Array.isArray(n)}}}),{})})(r,n),u=[],{onfieldCondition:o}=n;if(!o)return;const c=o.filter((e=>"on_input"===e.event_type)).filter((e=>e.conditions.some((e=>e?.logics?.some((e=>e.field===s))))));if(!c.length)return;c.forEach(((e,t)=>{const{conditions:r}=e;for(let e=0;e<r.length;e+=1){const i=r[e];let l=!1;if(["if","else-if"].includes(i.cond_type)){const{logics:r}=i;if(l=m(r,a,n),l){u.push({workflowIndx:t,condIndx:e,logicStatus:l?1:0});break}}u.push({workflowIndx:t,condIndx:e,logicStatus:l?1:0})}}));const f={};u.reverse(),u.forEach((e=>{let{workflowIndx:t,condIndx:r,logicStatus:i}=e;const{conditions:l}=c[t],s=l.find((e=>"else"===e.cond_type))||{};(i?l[r].actions:s.actions)?.fields?.forEach((e=>{if(f[e.field]||(f[e.field]=[]),!f[e.field].includes(e.action)){f[e.field].push(e.action);const t=Object.entries(n.smartTags).reduce(((e,t)=>{let[r,i]=t;return{...e,[`\${${r}}`]:{value:i,type:"text",multiple:!1}}}),{});((e,t,r,i)=>{if(void 0!==e.action&&void 0!==e.field)switch(r.fields[e.field].valid||(r.fields[e.field].valid={}),e.action){case"value":return((e,t,r)=>{if(void 0!==e.val&&t.fields[e.field]){const i=e.val?y(e.val,r):"";((e,t)=>{const{fieldName:r,typ:i}=e;if("radio"===i)return void(document.querySelector(`input[name="${r}"][value="${t}"]`).checked=!0);if("check"===i){const e=t.split(",");return void document.querySelectorAll(`input[name="${r}[]"]`).forEach((t=>{t.checked=e.includes(t.value)}))}const n=document.querySelector(`[name^='${r}']`);n.value!==t&&(n.value=t)})(t.fields[e.field],i)}})(e,r,i);case"hide":return b(e,r,!0);case"disable":r.fields[e.field]&&g(e.field,r,!0);break;case"readonly":r.fields[e.field]&&((e,t,r)=>{t.inits&&t.inits[e]?t.inits[e].readonly=!0:document.querySelector(`.${e}-fld`).readonly=!0})(e.field,r);break;case"enable":r.fields[e.field]&&g(e.field,r,!1);break;case"show":r.fields[e.field]&&b(e,r,!1)}})(e,0,n,{...a,...t})}}))}))}}));
