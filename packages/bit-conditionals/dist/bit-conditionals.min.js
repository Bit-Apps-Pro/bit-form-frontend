var bit_conditionals=function(){"use strict";const e=(e,r,t)=>{switch(e){case"and":return r&&t;case"or":return r||t;default:return!1}},r=(i,n,l)=>{if(Array.isArray(i)){let t=!1;for(let s=0;s<i.length;s+=1){const a=i[s];if("string"!=typeof a){const u=r(a,n,l);if(0===s&&(t=u),s-1>=0&&"string"==typeof i[s-1]){const r=i[s-1].toLowerCase();t=e(r,t,u)}}}return t}const s=t(i.val,n),a=Object.entries(l.smartTags).reduce(((e,r)=>{let[t,n]=r;return{...e,[`\${${t}${"string"==typeof n?"":"()"}}`]:{value:"string"==typeof n?n:(null==n?void 0:n[null==i?void 0:i.smartKey])||"",type:"text",multiple:!1}}}),{}),u={...n,...a};if(void 0!==u[i.field]){const e=u[i.field].value;return((e,r,t,i)=>{switch(e.logic){case"equal":return((e,r,t,i)=>{if(!r[e.field].value)return!1;if(void 0!==r[e.field].multiple&&r[e.field].multiple||"check"===t||Array.isArray(t)){const e=Array.isArray(t)?t:JSON.parse(t),r=i.split(",");let n=0;return e.forEach((t=>{e.length>0&&-1!==r.indexOf(t)&&(n+=1)})),n===r.length&&r.length===e.length}return t===i})(e,r,t,i);case"not_equal":return((e,r,t,i)=>{if(!t)return!1;if(void 0!==r[e.field].multiple&&r[e.field].multiple||"check"===t||Array.isArray(t)){const e=Array.isArray(t)?t:JSON.parse(t),r=i.split(",");if(e.length!==r.length)return!0;let n=0;return r.forEach((r=>{e.length>0&&-1===e.indexOf(r)&&(n+=1)})),r.length===n}return t!==i})(e,r,t,i);case"null":return t&&0===t.length;case"not_null":return t&&t.length>0;case"contain":return((e,r,t,i)=>{if(!t)return!1;const n=i.split(",");let l=0;if(void 0!==r[e.field].multiple&&r[e.field].multiple||"check"===t||Array.isArray(t)){const e=Array.isArray(t)?t:JSON.parse(t);return n.forEach((r=>{e.length>0&&-1!==e.indexOf(r)&&(l+=1)})),l>0}return n.forEach((e=>{t.length>0&&-1!==t.indexOf(e)&&(l+=1)})),l>0})(e,r,t,i);case"contain_all":return((e,r,t,i)=>{if(!t)return!1;const n=i.split(",");let l=0;if(void 0!==r[e.field].multiple&&r[e.field].multiple||"check"===t||Array.isArray(t)){const e=Array.isArray(t)?t:JSON.parse(t);return n.forEach((r=>{e.length>0&&-1!==e.indexOf(r)&&(l+=1)})),l>=n.length}return!1})(e,r,t,i);case"not_contain":return((e,r,t,i)=>{if(!t)return!1;const n=i.split(",");let l=0;if(void 0!==r[e.field].multiple&&r[e.field].multiple||"check"===t||Array.isArray(t)){const e=Array.isArray(t)?t:JSON.parse(t);return n.forEach((r=>{e.length>0&&-1===e.indexOf(r)&&(l+=1)})),l===n.length}return n.forEach((e=>{t.length>0&&-1===t.indexOf(e)&&(l+=1)})),l===n.length})(e,r,t,i);case"greater":return((e,r,t,i)=>!!t&&("number"===r[e.field].type?""!==t&&Number(t)>Number(i):""!==t&&t>i))(e,r,t,i);case"less":return((e,r,t,i)=>!!t&&("number"===r[e.field].type?""!==t&&Number(t)<Number(i):""!==t&&t<i))(e,r,t,i);case"greater_or_equal":return((e,r,t,i)=>!!t&&("number"===r[e.field].type?""!==t&&Number(t)>=Number(i):""!==t&&t>=i))(e,r,t,i);case"less_or_equal":return((e,r,t,i)=>!!t&&("number"===r[e.field].type?""!==t&&Number(t)<=Number(i):""!==t&&t<=i))(e,r,t,i);case"start_with":return((e,r,t,i)=>!!t&&""!==t&&0===t.indexOf(i))(0,0,t,i);case"end_with":return((e,r,t,i)=>!!t&&i===t.substr(t.length-i.length,t.length))(0,0,t,i);case"between":return((e,r,t,i)=>{if(!t)return!1;let n=t,l=i.min,s=i.max;return"number"===r[e.field].type&&(n=Number(t),l=Number(i.min),s=Number(i.max)),n>=l&&n<=s})(e,r,t,i);default:return!1}})(i,u,e,s)}return!1},t=(e,r)=>{if(!e)return e;let t;if(t="object"==typeof e?JSON.stringify(e):JSON.parse(JSON.stringify(e)),"string"!=typeof t)return e;const n=t.match(/\${\w[^${}]*}/g);return n&&n.map((e=>{let i=e;if(r[i]||(i=e.substring(2,e.length-1)),r[i]){let n=r[i].value;Array.isArray(r[i].value)&&!Number.isNaN(r[i].value[0])&&(n=0,r[i].value.map((e=>{n+=Number(e)}))),t=t.replace(e,n)}})),i(t)},i=e=>{if(!e)return e;let r=e;const t=e.match(/[\\+\-\\*\\/\\%]/g);if(t&&t.length>0){const t=e.match(/\w+/g);if(!t)return e;const i=t.filter((e=>Number.isNaN(e)));if(i&&i.length>0)return r;r=r.replace(/\{|\[/g,"("),r=r.replace(/\}|\]/g,")");try{r=Function(`"use strict"; return (${r})`)()}catch(r){return e}}return r},n=(e,r,t)=>{r.inits&&r.inits[e]?r.inits[e].disabled=t:document.querySelector(`.${e}-fld`).disabled=t},l=(e,r,t)=>{r.fields[e.field]&&(r.fields[e.field].valid.hide=t)},s=(e,r)=>Object.keys(r).find((t=>r[t].fieldName===e)),a=e=>"[]"===e.slice(-2)?e.slice(0,e.length-2):e;return function(e){var i,u;if(null==e||null===(i=e.target)||void 0===i||!i.form)return;const c=e.target,{form:o}=e.target,f=o.id.replace("form-",""),d=null===(u=window.bf_globals)||void 0===u?void 0:u[f];if(!d)return;const h=a(c.name),m=s(h,d.fields);if(!m)return;const y=((e,r)=>{const t=new FormData(e),{fields:i}=r,n={};return Array.from(t.entries()).forEach((e=>{let[r,t]=e;const l=s(a(r),i);l in i&&(n[l]?(Array.isArray(n[l])||(n[l]=[n[l]]),n[l].push(t)):n[l]=t)})),Object.entries(n).reduce(((e,r)=>{let[t,n]=r;return{...e,[t]:{value:n,type:i[t].typ,multiple:Array.isArray(n)}}}),{})})(o,d),p=[],{onfieldCondition:g}=d;if(!g)return;const v=g.filter((e=>"on_input"===e.event_type)).filter((e=>e.conditions.some((e=>{var r;return null==e||null===(r=e.logics)||void 0===r?void 0:r.some((e=>e.field===m))}))));if(!v.length)return;v.forEach(((e,t)=>{const{conditions:i}=e,{length:n}=i;let l=!1,s=0;for(s=0;s<n;s+=1){const e=i[s];if(["if","else-if"].includes(e.cond_type)){const{logics:t}=e;if(l=r(t,y,d),l)break}}p.push({workflowIndx:t,condIndx:s,logicStatus:l})}));const b={};p.reverse(),p.forEach((e=>{var r;let{workflowIndx:i,condIndx:s,logicStatus:a}=e;const{conditions:u}=v[i],c=u.find((e=>"else"===e.cond_type))||{},o=a?u[s].actions:c.actions;null==o||null===(r=o.fields)||void 0===r||r.forEach((e=>{if(b[e.field]||(b[e.field]=[]),!b[e.field].includes(e.action)){b[e.field].push(e.action);const r=Object.entries(d.smartTags).reduce(((e,r)=>{let[t,i]=r;return{...e,[`\${${t}}`]:{value:i,type:"text",multiple:!1}}}),{});((e,r,i,s)=>{if(void 0!==e.action&&void 0!==e.field)switch(i.fields[e.field].valid||(i.fields[e.field].valid={}),e.action){case"value":return((e,r,i)=>{if(void 0!==e.val&&r.fields[e.field]){const n=e.val?t(e.val,i):"";((e,r)=>{const{fieldName:t,typ:i}=e;if("radio"===i)return void(document.querySelector(`input[name="${t}"][value="${r}"]`).checked=!0);if("check"===i){const e=r.split(",");return void document.querySelectorAll(`input[name="${t}[]"]`).forEach((r=>{r.checked=e.includes(r.value)}))}const n=document.querySelector(`[name^='${t}']`);n.value!==r&&(n.value=r)})(r.fields[e.field],n)}})(e,i,s);case"hide":return l(e,i,!0);case"disable":i.fields[e.field]&&n(e.field,i,!0);break;case"readonly":i.fields[e.field]&&((e,r,t)=>{r.inits&&r.inits[e]?r.inits[e].readonly=!0:document.querySelector(`.${e}-fld`).readonly=!0})(e.field,i);break;case"enable":i.fields[e.field]&&n(e.field,i,!1);break;case"show":i.fields[e.field]&&l(e,i,!1)}})(e,0,d,{...y,...r})}}))}))}}();
