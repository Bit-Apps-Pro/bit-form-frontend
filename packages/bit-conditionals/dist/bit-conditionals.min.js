var bit_conditionals=function(){"use strict";const e=(e,t,r)=>{switch(e){case"and":return t&&r;case"or":return t||r;default:return!1}},t=(i,n,l)=>{if(Array.isArray(i)){let r=!1;for(let s=0;s<i.length;s+=1){const a=i[s];if("string"!=typeof a){const o=t(a,n,l);if(0===s&&(r=o),s-1>=0&&"string"==typeof i[s-1]){const t=i[s-1].toLowerCase();r=e(t,r,o)}}}return r}const s=r(i.val,n),a=Object.entries(l.smartTags).reduce(((e,t)=>{let[r,n]=t;return{...e,[`\${${r}${"string"==typeof n?"":"()"}}`]:{value:"string"==typeof n?n:(null==n?void 0:n[null==i?void 0:i.smartKey])||"",type:"text",multiple:!1}}}),{}),o={...n,...a};if(void 0!==o[i.field]){const e=o[i.field].value;return((e,t,r,i)=>{switch(e.logic){case"equal":return((e,t,r,i)=>{if(!t[e.field].value)return!1;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===r||Array.isArray(r)){const e=Array.isArray(r)?r:JSON.parse(r),t=i.split(",");let n=0;return e.forEach((r=>{e.length>0&&-1!==t.indexOf(r)&&(n+=1)})),n===t.length&&t.length===e.length}return r===i})(e,t,r,i);case"not_equal":return((e,t,r,i)=>{if(!r)return!1;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===r||Array.isArray(r)){const e=Array.isArray(r)?r:JSON.parse(r),t=i.split(",");if(e.length!==t.length)return!0;let n=0;return t.forEach((t=>{e.length>0&&-1===e.indexOf(t)&&(n+=1)})),t.length===n}return r!==i})(e,t,r,i);case"null":return r&&0===r.length;case"not_null":return r&&r.length>0;case"contain":return((e,t,r,i)=>{if(!r)return!1;const n=i.split(",");let l=0;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===r||Array.isArray(r)){const e=Array.isArray(r)?r:JSON.parse(r);return n.forEach((t=>{e.length>0&&-1!==e.indexOf(t)&&(l+=1)})),l>0}return n.forEach((e=>{r.length>0&&-1!==r.indexOf(e)&&(l+=1)})),l>0})(e,t,r,i);case"contain_all":return((e,t,r,i)=>{if(!r)return!1;const n=i.split(",");let l=0;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===r||Array.isArray(r)){const e=Array.isArray(r)?r:JSON.parse(r);return n.forEach((t=>{e.length>0&&-1!==e.indexOf(t)&&(l+=1)})),l>=n.length}return!1})(e,t,r,i);case"not_contain":return((e,t,r,i)=>{if(!r)return!1;const n=i.split(",");let l=0;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===r||Array.isArray(r)){const e=Array.isArray(r)?r:JSON.parse(r);return n.forEach((t=>{e.length>0&&-1===e.indexOf(t)&&(l+=1)})),l===n.length}return n.forEach((e=>{r.length>0&&-1===r.indexOf(e)&&(l+=1)})),l===n.length})(e,t,r,i);case"greater":return((e,t,r,i)=>!!r&&("number"===t[e.field].type?""!==r&&Number(r)>Number(i):""!==r&&r>i))(e,t,r,i);case"less":return((e,t,r,i)=>!!r&&("number"===t[e.field].type?""!==r&&Number(r)<Number(i):""!==r&&r<i))(e,t,r,i);case"greater_or_equal":return((e,t,r,i)=>!!r&&("number"===t[e.field].type?""!==r&&Number(r)>=Number(i):""!==r&&r>=i))(e,t,r,i);case"less_or_equal":return((e,t,r,i)=>!!r&&("number"===t[e.field].type?""!==r&&Number(r)<=Number(i):""!==r&&r<=i))(e,t,r,i);case"start_with":return((e,t,r,i)=>!!r&&""!==r&&0===r.indexOf(i))(0,0,r,i);case"end_with":return((e,t,r,i)=>!!r&&i===r.substr(r.length-i.length,r.length))(0,0,r,i);case"between":return((e,t,r,i)=>{if(!r)return!1;let n=r,l=i.min,s=i.max;return"number"===t[e.field].type&&(n=Number(r),l=Number(i.min),s=Number(i.max)),n>=l&&n<=s})(e,t,r,i);default:return!1}})(i,o,e,s)}return!1},r=(e,t)=>{if(!e)return e;let r;if(r="object"==typeof e?JSON.stringify(e):JSON.parse(JSON.stringify(e)),"string"!=typeof r)return e;const n=r.match(/\${\w[^${}]*}/g);return n&&n.map((e=>{let i=e;if(t[i]||(i=e.substring(2,e.length-1)),t[i]){let n=t[i].value;Array.isArray(t[i].value)&&!Number.isNaN(t[i].value[0])&&(n=0,t[i].value.map((e=>{n+=Number(e)}))),r=r.replace(e,n)}})),i(r)},i=e=>{if(!e)return e;let t=e;const r=e.match(/[\\+\-\\*\\/\\%]/g);if(r&&r.length>0){const r=e.match(/\w+/g);if(!r)return e;const i=r.filter((e=>Number.isNaN(e)));if(i&&i.length>0)return t;t=t.replace(/\{|\[/g,"("),t=t.replace(/\}|\]/g,")");try{t=Function(`"use strict"; return (${t})`)()}catch(t){return e}}return t},n=(e,t,r)=>{t.inits&&t.inits[e]?t.inits[e].disabled=r:document.querySelector(`.${e}-fld`).disabled=r},l=(e,t,r)=>{if(t.fields[e.field]){t.fields[e.field].valid.hide=r;const i=e.field,n=document.querySelector(`.btcd-fld-itm.${i}`),l=window.getComputedStyle(n);let s=0;s="border-box"===l.boxSizing?n.offsetHeight:parseInt(l.paddingTop)+parseInt(l.paddingBottom)+n.offsetHeight+parseInt(l.marginTop)+parseInt(l.marginBottom)+parseInt(l.borderTopWidth)+parseInt(l.borderBottomWidth),r?(n.classList.add("fld-hide"),n.style.height&&n.style.removeProperty("height")):(n.style.height=s,n.classList.remove("fld-hide")),console.log(s)}},s=(e,t)=>Object.keys(t).find((r=>t[r].fieldName===e)),a=e=>"[]"===e.slice(-2)?e.slice(0,e.length-2):e;return function(e){var i,o;if(null==e||null===(i=e.target)||void 0===i||!i.form)return;const u=e.target,{form:c}=e.target,d=c.id.replace("form-",""),f=null===(o=window.bf_globals)||void 0===o?void 0:o[d];if(!f)return;const h=a(u.name),m=s(h,f.fields);if(!m)return;const p=((e,t)=>{const r=new FormData(e),{fields:i}=t,n={};return Array.from(r.entries()).forEach((e=>{let[t,r]=e;const l=s(a(t),i);l in i&&(n[l]?(Array.isArray(n[l])||(n[l]=[n[l]]),n[l].push(r)):n[l]=r)})),Object.entries(n).reduce(((e,t)=>{let[r,n]=t;return{...e,[r]:{value:n,type:i[r].typ,multiple:Array.isArray(n)}}}),{})})(c,f),y=[],{onfieldCondition:g}=f;if(!g)return;const v=g.filter((e=>"on_input"===e.event_type)).filter((e=>e.conditions.some((e=>{var t;return null==e||null===(t=e.logics)||void 0===t?void 0:t.some((e=>e.field===m))}))));if(!v.length)return;v.forEach(((e,r)=>{const{conditions:i}=e,{length:n}=i;let l=!1,s=0;for(s=0;s<n;s+=1){const e=i[s];if(["if","else-if"].includes(e.cond_type)){const{logics:r}=e;if(l=t(r,p,f),l)break}}y.push({workflowIndx:r,condIndx:s,logicStatus:l})}));const b={};y.reverse(),y.forEach((e=>{var t;let{workflowIndx:i,condIndx:s,logicStatus:a}=e;const{conditions:o}=v[i],u=o.find((e=>"else"===e.cond_type))||{},c=a?o[s].actions:u.actions;null==c||null===(t=c.fields)||void 0===t||t.forEach((e=>{if(b[e.field]||(b[e.field]=[]),!b[e.field].includes(e.action)){b[e.field].push(e.action);const t=Object.entries(f.smartTags).reduce(((e,t)=>{let[r,i]=t;return{...e,[`\${${r}}`]:{value:i,type:"text",multiple:!1}}}),{});((e,t,i,s)=>{if(void 0!==e.action&&void 0!==e.field)switch(i.fields[e.field].valid||(i.fields[e.field].valid={}),e.action){case"value":return((e,t,i)=>{if(void 0!==e.val&&t.fields[e.field]){const n=e.val?r(e.val,i):"";((e,t)=>{const{fieldName:r,typ:i}=e;if("radio"===i)return void(document.querySelector(`input[name="${r}"][value="${t}"]`).checked=!0);if("check"===i){const e=t.split(",");return void document.querySelectorAll(`input[name="${r}[]"]`).forEach((t=>{t.checked=e.includes(t.value)}))}const n=document.querySelector(`[name^='${r}']`);n.value!==t&&(n.value=t)})(t.fields[e.field],n)}})(e,i,s);case"hide":return l(e,i,!0);case"disable":i.fields[e.field]&&n(e.field,i,!0);break;case"readonly":i.fields[e.field]&&((e,t,r)=>{t.inits&&t.inits[e]?t.inits[e].readonly=!0:document.querySelector(`.${e}-fld`).readonly=!0})(e.field,i);break;case"enable":i.fields[e.field]&&n(e.field,i,!1);break;case"show":i.fields[e.field]&&l(e,i,!1)}})(e,0,f,{...p,...t})}}))}))}}();
