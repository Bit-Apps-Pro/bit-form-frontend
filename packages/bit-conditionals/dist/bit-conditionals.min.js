!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e="undefined"!=typeof globalThis?globalThis:e||self).bit_conditionals=r()}(this,(function(){"use strict";const e=(e,r,t)=>{switch(e){case"and":return r&&t;case"or":return r||t;default:return!1}},r=(i,n,l)=>{if(Array.isArray(i)){let t=!1;for(let s=0;s<i.length;s+=1){const a=i[s];if("string"!=typeof a){const f=r(a,n,l);if(0===s&&(t=f),s-1>=0&&"string"==typeof i[s-1]){const r=i[s-1].toLowerCase();t=e(r,t,f)}}}return t}if(void 0!==n[i.field]){const e=t(i.val,n,l);let{value:r}=n[i.field];return"number"==typeof e&&(r=parseInt(r,10)),((e,r,t,i)=>{switch(e.logic){case"equal":return((e,r,t,i)=>{if(!r[e.field].value)return!1;if(void 0!==r[e.field].multiple&&r[e.field].multiple||"check"===t||Array.isArray(t)){const e=Array.isArray(t)?t:JSON.parse(t),r=i.split(",");let n=0;return e.forEach((t=>{e.length>0&&-1!==r.indexOf(t)&&(n+=1)})),n===r.length&&r.length===e.length}return t===i})(e,r,t,i);case"not_equal":return((e,r,t,i)=>{if(!t)return!1;if(void 0!==r[e.field].multiple&&r[e.field].multiple||"check"===t||Array.isArray(t)){const e=Array.isArray(t)?t:JSON.parse(t),r=i.split(",");if(e.length!==r.length)return!0;let n=0;return r.forEach((r=>{e.length>0&&-1===e.indexOf(r)&&(n+=1)})),r.length===n}return t!==i})(e,r,t,i);case"null":return t&&0===t.length;case"not_null":return t&&t.length>0;case"contain":return((e,r,t,i)=>{if(!t)return!1;const n=i.split(",");let l=0;if(void 0!==r[e.field].multiple&&r[e.field].multiple||"check"===t||Array.isArray(t)){const e=Array.isArray(t)?t:JSON.parse(t);return n.forEach((r=>{e.length>0&&-1!==e.indexOf(r)&&(l+=1)})),l>0}return n.forEach((e=>{t.length>0&&-1!==t.indexOf(e)&&(l+=1)})),l>0})(e,r,t,i);case"contain_all":return((e,r,t,i)=>{if(!t)return!1;const n=i.split(",");let l=0;if(void 0!==r[e.field].multiple&&r[e.field].multiple||"check"===t||Array.isArray(t)){const e=Array.isArray(t)?t:JSON.parse(t);return n.forEach((r=>{e.length>0&&-1!==e.indexOf(r)&&(l+=1)})),l>=n.length}return!1})(e,r,t,i);case"not_contain":return((e,r,t,i)=>{if(!t)return!1;const n=i.split(",");let l=0;if(void 0!==r[e.field].multiple&&r[e.field].multiple||"check"===t||Array.isArray(t)){const e=Array.isArray(t)?t:JSON.parse(t);return n.forEach((r=>{e.length>0&&-1===e.indexOf(r)&&(l+=1)})),l===n.length}return n.forEach((e=>{t.length>0&&-1===t.indexOf(e)&&(l+=1)})),l===n.length})(e,r,t,i);case"greater":return((e,r,t,i)=>!!t&&("number"===r[e.field].type?""!==t&&Number(t)>Number(i):""!==t&&t>i))(e,r,t,i);case"less":return((e,r,t,i)=>!!t&&("number"===r[e.field].type?""!==t&&Number(t)<Number(i):""!==t&&t<i))(e,r,t,i);case"greater_or_equal":return((e,r,t,i)=>!!t&&("number"===r[e.field].type?""!==t&&Number(t)>=Number(i):""!==t&&t>=i))(e,r,t,i);case"less_or_equal":return((e,r,t,i)=>!!t&&("number"===r[e.field].type?""!==t&&Number(t)<=Number(i):""!==t&&t<=i))(e,r,t,i);case"start_with":return((e,r,t,i)=>!!t&&""!==t&&0===t.indexOf(i))(0,0,t,i);case"end_with":return((e,r,t,i)=>!!t&&i===t.substr(t.length-i.length,t.length))(0,0,t,i);case"between":return((e,r,t,i)=>!!t&&("number"===r[e.field].type?Number(t)>=Number(i)&&Number(t)<=Number(i):t>=i&&t<=i))(e,r,t,i);default:return!1}})(i,n,r,e)}return!1},t=(e,r,t)=>{if(!e)return e;let n;if(n="object"==typeof e?JSON.stringify(e):JSON.parse(JSON.stringify(e)),"string"!=typeof n)return e;const l=n.match(/\${\w[^${}]*}/g);return l&&l.map((e=>{const i=e.substring(2,e.length-1);if(r[i]){let t=r[i].value;Array.isArray(r[i].value)&&!Number.isNaN(r[i].value[0])&&(t=0,r[i].value.map((e=>{t+=Number(e)}))),n=n.replace(e,t)}else t.smartTags[i]&&(n=n.replace(e,t.smartTags[i]))})),i(n)},i=e=>{if(!e)return e;let r=e;const t=e.match(/[\\+\-\\*\\/\\%]/g);if(t&&t.length>0){const t=e.match(/\w+/g);if(!t)return e;const i=t.filter((e=>Number.isNaN(e)));if(i&&i.length>0)return r;r=r.replace(/\{|\[/g,"("),r=r.replace(/\}|\]/g,")");try{r=Function(`"use strict";return (${r})`)()}catch(r){return e}}return r},n=(e,r,t)=>{r.inits&&r.inits[e]?r.inits[e].disabled=t:document.querySelector(`.${e}-fld`).disabled=t},l=(e,r,t)=>{r.fields[e.field]&&(r.fields[e.field].valid.hide=t)},s=(e,r)=>Object.keys(r).find((t=>r[t].fieldName===e)),a=e=>"[]"===e.slice(-2)?e.slice(0,e.length-2):e;return function(e){if(!e?.target?.form)return;const i=e.target,{form:f}=e.target,o=f.id.replace("form-",""),u=window.bf_globals?.[o];if(!u)return;const c=a(i.name),d=s(c,u.fields);if(!d)return;const h=((e,r)=>{const t=new FormData(e),{fields:i}=r,n={};return Array.from(t.entries()).forEach((e=>{let[r,t]=e;const l=s(a(r),i);l in i&&(n[l]?(Array.isArray(n[l])||(n[l]=[n[l]]),n[l].push(t)):n[l]=t)})),Object.entries(n).reduce(((e,r)=>{let[t,n]=r;return{...e,[t]:{value:n,type:i[t].typ,multiple:Array.isArray(n)}}}),{})})(f,u),p=[],{onfieldCondition:y}=u;if(!y)return;const g=y.filter((e=>"on_input"===e.event_type)).filter((e=>e.conditions.some((e=>e?.logics?.some((e=>e.field===d))))));if(!g.length)return;g.forEach(((e,t)=>{const{conditions:i}=e;for(let e=0;e<i.length;e+=1){const n=i[e];let l=!1;if(["if","else-if"].includes(n.cond_type)){const{logics:i}=n;if(l=r(i,h,u),l){p.push({workflowIndx:t,condIndx:e,logicStatus:l?1:0});break}}p.push({workflowIndx:t,condIndx:e,logicStatus:l?1:0})}}));const m={};p.reverse(),p.forEach((e=>{let{workflowIndx:r,condIndx:i,logicStatus:s}=e;const{conditions:a}=g[r],f=a.find((e=>"else"===e.cond_type))||{};(s?a[i].actions:f.actions)?.fields?.forEach((e=>{m[e.field]||(m[e.field]=[]),m[e.field].includes(e.action)||(m[e.field].push(e.action),((e,r,i,s)=>{if(void 0!==e.action&&void 0!==e.field)switch(i.fields[e.field].valid||(i.fields[e.field].valid={}),e.action){case"value":return((e,r,i)=>{if(void 0!==e.val&&r.fields[e.field]){const n=e.val?t(e.val,i,r):"";((e,r)=>{const t=document.querySelector(`[name^='${e}']`);t.value!==r&&(t.value=r)})(r.fields[e.field].fieldName,n)}})(e,i,s);case"hide":return l(e,i,!0);case"disable":i.fields[e.field]&&n(e.field,i,!0);break;case"readonly":i.fields[e.field]&&(i.fields[e.field].valid.readonly=!0);break;case"enable":i.fields[e.field]&&n(e.field,i,!1);break;case"show":i.fields[e.field]&&l(e,i,!1)}})(e,0,u,h))}))}))}}));
