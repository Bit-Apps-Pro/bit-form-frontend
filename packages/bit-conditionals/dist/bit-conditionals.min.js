!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e="undefined"!=typeof globalThis?globalThis:e||self).bit_conditionals=r()}(this,(function(){"use strict";const e=(e,r,t)=>{switch(e){case"and":return r&&t;case"or":return r||t;default:return!1}},r=(n,i,l)=>{if(Array.isArray(n)){let t=!1;for(let s=0;s<n.length;s+=1){const a=n[s];if("string"!=typeof a){const o=r(a,i,l);if(0===s&&(t=o),s-1>=0&&"string"==typeof n[s-1]){const r=n[s-1].toLowerCase();t=e(r,t,o)}}}return t}if(void 0!==i[n.field]){const e="object"!=typeof n.val?t(n.val,i,l):n.val;let{value:r}=i[n.field];return"number"==typeof e&&(r=parseInt(r,10)),((e,r,t,n)=>{switch(e.logic){case"equal":return((e,r,t,n)=>{if(!r[e.field].value)return!1;if(void 0!==r[e.field].multiple&&r[e.field].multiple||"check"===t||Array.isArray(t)){const e=Array.isArray(t)?t:JSON.parse(t),r=n.split(",");let i=0;return e.forEach((t=>{e.length>0&&-1!==r.indexOf(t)&&(i+=1)})),i===r.length&&r.length===e.length}return t===n})(e,r,t,n);case"not_equal":return((e,r,t,n)=>{if(!t)return!1;if(void 0!==r[e.field].multiple&&r[e.field].multiple||"check"===t||Array.isArray(t)){const e=Array.isArray(t)?t:JSON.parse(t),r=n.split(",");if(e.length!==r.length)return!0;let i=0;return r.forEach((r=>{e.length>0&&-1===e.indexOf(r)&&(i+=1)})),r.length===i}return t!==n})(e,r,t,n);case"null":return t&&0===t.length;case"not_null":return t&&t.length>0;case"contain":return((e,r,t,n)=>{if(!t)return!1;const i=n.split(",");let l=0;if(void 0!==r[e.field].multiple&&r[e.field].multiple||"check"===t||Array.isArray(t)){const e=Array.isArray(t)?t:JSON.parse(t);return i.forEach((r=>{e.length>0&&-1!==e.indexOf(r)&&(l+=1)})),l>0}return i.forEach((e=>{t.length>0&&-1!==t.indexOf(e)&&(l+=1)})),l>0})(e,r,t,n);case"contain_all":return((e,r,t,n)=>{if(!t)return!1;const i=n.split(",");let l=0;if(void 0!==r[e.field].multiple&&r[e.field].multiple||"check"===t||Array.isArray(t)){const e=Array.isArray(t)?t:JSON.parse(t);return i.forEach((r=>{e.length>0&&-1!==e.indexOf(r)&&(l+=1)})),l>=i.length}return!1})(e,r,t,n);case"not_contain":return((e,r,t,n)=>{if(!t)return!1;const i=n.split(",");let l=0;if(void 0!==r[e.field].multiple&&r[e.field].multiple||"check"===t||Array.isArray(t)){const e=Array.isArray(t)?t:JSON.parse(t);return i.forEach((r=>{e.length>0&&-1===e.indexOf(r)&&(l+=1)})),l===i.length}return i.forEach((e=>{t.length>0&&-1===t.indexOf(e)&&(l+=1)})),l===i.length})(e,r,t,n);case"greater":return((e,r,t,n)=>!!t&&("number"===r[e.field].type?""!==t&&Number(t)>Number(n):""!==t&&t>n))(e,r,t,n);case"less":return((e,r,t,n)=>!!t&&("number"===r[e.field].type?""!==t&&Number(t)<Number(n):""!==t&&t<n))(e,r,t,n);case"greater_or_equal":return((e,r,t,n)=>!!t&&("number"===r[e.field].type?""!==t&&Number(t)>=Number(n):""!==t&&t>=n))(e,r,t,n);case"less_or_equal":return((e,r,t,n)=>!!t&&("number"===r[e.field].type?""!==t&&Number(t)<=Number(n):""!==t&&t<=n))(e,r,t,n);case"start_with":return((e,r,t,n)=>!!t&&""!==t&&0===t.indexOf(n))(0,0,t,n);case"end_with":return((e,r,t,n)=>!!t&&n===t.substr(t.length-n.length,t.length))(0,0,t,n);case"between":return((e,r,t,n)=>{if(!t)return!1;let i=t,l=n.min,s=n.max;return"number"===r[e.field].type&&(i=Number(t),l=Number(n.min),s=Number(n.max)),i>=l&&i<=s})(e,r,t,n);default:return!1}})(n,i,r,e)}return!1},t=(e,r,t)=>{if(!e)return e;let i;if(i="object"==typeof e?JSON.stringify(e):JSON.parse(JSON.stringify(e)),"string"!=typeof i)return e;const l=i.match(/\${\w[^${}]*}/g);return l&&l.map((e=>{const n=e.substring(2,e.length-1);if(r[n]){let t=r[n].value;Array.isArray(r[n].value)&&!Number.isNaN(r[n].value[0])&&(t=0,r[n].value.map((e=>{t+=Number(e)}))),i=i.replace(e,t)}else t.smartTags[n]&&(i=i.replace(e,t.smartTags[n]))})),n(i)},n=e=>{if(!e)return e;let r=e;const t=e.match(/[\\+\-\\*\\/\\%]/g);if(t&&t.length>0){const t=e.match(/\w+/g);if(!t)return e;const n=t.filter((e=>Number.isNaN(e)));if(n&&n.length>0)return r;r=r.replace(/\{|\[/g,"("),r=r.replace(/\}|\]/g,")");try{r=Function(`"use strict";return (${r})`)()}catch(r){return e}}return r},i=(e,r,t)=>{r.inits&&r.inits[e]?r.inits[e].disabled=t:document.querySelector(`.${e}-fld`).disabled=t},l=(e,r,t)=>{r.fields[e.field]&&(r.fields[e.field].valid.hide=t)},s=(e,r)=>Object.keys(r).find((t=>r[t].fieldName===e)),a=e=>"[]"===e.slice(-2)?e.slice(0,e.length-2):e;return function(e){if(!e?.target?.form)return;const n=e.target,{form:o}=e.target,f=o.id.replace("form-",""),c=window.bf_globals?.[f];if(!c)return;const u=a(n.name),d=s(u,c.fields);if(!d)return;const h=((e,r)=>{const t=new FormData(e),{fields:n}=r,i={};return Array.from(t.entries()).forEach((e=>{let[r,t]=e;const l=s(a(r),n);l in n&&(i[l]?(Array.isArray(i[l])||(i[l]=[i[l]]),i[l].push(t)):i[l]=t)})),Object.entries(i).reduce(((e,r)=>{let[t,i]=r;return{...e,[t]:{value:i,type:n[t].typ,multiple:Array.isArray(i)}}}),{})})(o,c),m=[],{onfieldCondition:y}=c;if(!y)return;const p=y.filter((e=>"on_input"===e.event_type)).filter((e=>e.conditions.some((e=>e?.logics?.some((e=>e.field===d))))));if(!p.length)return;p.forEach(((e,t)=>{const{conditions:n}=e;for(let e=0;e<n.length;e+=1){const i=n[e];let l=!1;if(["if","else-if"].includes(i.cond_type)){const{logics:n}=i;if(l=r(n,h,c),l){m.push({workflowIndx:t,condIndx:e,logicStatus:l?1:0});break}}m.push({workflowIndx:t,condIndx:e,logicStatus:l?1:0})}}));const g={};m.reverse(),m.forEach((e=>{let{workflowIndx:r,condIndx:n,logicStatus:s}=e;const{conditions:a}=p[r],o=a.find((e=>"else"===e.cond_type))||{};(s?a[n].actions:o.actions)?.fields?.forEach((e=>{g[e.field]||(g[e.field]=[]),g[e.field].includes(e.action)||(g[e.field].push(e.action),((e,r,n,s)=>{if(void 0!==e.action&&void 0!==e.field)switch(n.fields[e.field].valid||(n.fields[e.field].valid={}),e.action){case"value":return((e,r,n)=>{if(void 0!==e.val&&r.fields[e.field]){const i=e.val?t(e.val,n,r):"";((e,r)=>{const{fieldName:t,typ:n}=e;if("radio"===n)return void(document.querySelector(`input[name="${t}"][value="${r}"]`).checked=!0);if("check"===n){const e=r.split(",");return void document.querySelectorAll(`input[name="${t}[]"]`).forEach((r=>{r.checked=e.includes(r.value)}))}const i=document.querySelector(`[name^='${t}']`);i.value!==r&&(i.value=r)})(r.fields[e.field],i)}})(e,n,s);case"hide":return l(e,n,!0);case"disable":n.fields[e.field]&&i(e.field,n,!0);break;case"readonly":n.fields[e.field]&&((e,r,t)=>{r.inits&&r.inits[e]?r.inits[e].readonly=!0:document.querySelector(`.${e}-fld`).readonly=!0})(e.field,n);break;case"enable":n.fields[e.field]&&i(e.field,n,!1);break;case"show":n.fields[e.field]&&l(e,n,!1)}})(e,0,c,h))}))}))}}));
