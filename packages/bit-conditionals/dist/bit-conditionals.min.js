!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).bit_conditionals=t()}(this,(function(){"use strict";const e=(e,t,l)=>{switch(e){case"and":return t&&l;case"or":return t||l;default:return!1}},t=(r,i,n)=>{if(Array.isArray(r)){let l=!1;for(let s=0;s<r.length;s+=1){const a=r[s];if("string"!=typeof a){const d=t(a,i,n);if(0===s&&(l=d),s-1>=0&&"string"==typeof r[s-1]){const t=r[s-1].toLowerCase();l=e(t,l,d)}}}return l}if(void 0!==i[r.field]){const e=l(r.val,i,n);let{value:t}=i[r.field];return"number"==typeof e&&(t=parseInt(t,10)),((e,t,l,r)=>{switch(e.logic){case"equal":return((e,t,l,r)=>{if(!t[e.field].value)return!1;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===l||Array.isArray(l)){const e=Array.isArray(l)?l:JSON.parse(l),t=r.split(",");let i=0;return e.forEach((l=>{e.length>0&&-1!==t.indexOf(l)&&(i+=1)})),i===t.length&&t.length===e.length}return l===r})(e,t,l,r);case"not_equal":return((e,t,l,r)=>{if(!l)return!1;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===l||Array.isArray(l)){const e=Array.isArray(l)?l:JSON.parse(l),t=r.split(",");if(e.length!==t.length)return!0;let i=0;return t.forEach((t=>{e.length>0&&-1===e.indexOf(t)&&(i+=1)})),t.length===i}return l!==r})(e,t,l,r);case"null":return l&&0===l.length;case"not_null":return l&&l.length>0;case"contain":return((e,t,l,r)=>{if(!l)return!1;const i=r.split(",");let n=0;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===l||Array.isArray(l)){const e=Array.isArray(l)?l:JSON.parse(l);return i.forEach((t=>{e.length>0&&-1!==e.indexOf(t)&&(n+=1)})),n>0}return i.forEach((e=>{l.length>0&&-1!==l.indexOf(e)&&(n+=1)})),n>0})(e,t,l,r);case"contain_all":return((e,t,l,r)=>{if(!l)return!1;const i=r.split(",");let n=0;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===l||Array.isArray(l)){const e=Array.isArray(l)?l:JSON.parse(l);return i.forEach((t=>{e.length>0&&-1!==e.indexOf(t)&&(n+=1)})),n>=i.length}return!1})(e,t,l,r);case"not_contain":return((e,t,l,r)=>{if(!l)return!1;const i=r.split(",");let n=0;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===l||Array.isArray(l)){const e=Array.isArray(l)?l:JSON.parse(l);return i.forEach((t=>{e.length>0&&-1===e.indexOf(t)&&(n+=1)})),n===i.length}return i.forEach((e=>{l.length>0&&-1===l.indexOf(e)&&(n+=1)})),n===i.length})(e,t,l,r);case"greater":return((e,t,l,r)=>!!l&&("number"===t[e.field].type?""!==l&&Number(l)>Number(r):""!==l&&l>r))(e,t,l,r);case"less":return((e,t,l,r)=>!!l&&("number"===t[e.field].type?""!==l&&Number(l)<Number(r):""!==l&&l<r))(e,t,l,r);case"greater_or_equal":return((e,t,l,r)=>!!l&&("number"===t[e.field].type?""!==l&&Number(l)>=Number(r):""!==l&&l>=r))(e,t,l,r);case"less_or_equal":return((e,t,l,r)=>!!l&&("number"===t[e.field].type?""!==l&&Number(l)<=Number(r):""!==l&&l<=r))(e,t,l,r);case"start_with":return((e,t,l,r)=>!!l&&""!==l&&0===l.indexOf(r))(0,0,l,r);case"end_with":return((e,t,l,r)=>!!l&&r===l.substr(l.length-r.length,l.length))(0,0,l,r);case"between":return((e,t,l,r)=>!!l&&("number"===t[e.field].type?Number(l)>=Number(r)&&Number(l)<=Number(r):l>=r&&l<=r))(e,t,l,r);default:return!1}})(r,i,t,e)}return!1},l=(e,t,l)=>{if(!e)return e;let i;if(i="object"==typeof e?JSON.stringify(e):JSON.parse(JSON.stringify(e)),"string"!=typeof i)return e;const n=i.match(/\${\w[^${}]*}/g);return n&&n.map((e=>{const r=e.substring(2,e.length-1);if(t[r]){let l=t[r].value;Array.isArray(t[r].value)&&!Number.isNaN(t[r].value[0])&&(l=0,t[r].value.map((e=>{l+=Number(e)}))),i=i.replace(e,l)}else l.smartTags[r]&&(i=i.replace(e,l.smartTags[r]))})),r(i)},r=e=>{if(!e)return e;let t=e;const l=e.match(/[\\+\-\\*\\/\\%]/g);if(l&&l.length>0){const l=e.match(/\w+/g);if(!l)return e;const r=l.filter((e=>Number.isNaN(e)));if(r&&r.length>0)return t;t=t.replace(/\{|\[/g,"("),t=t.replace(/\}|\]/g,")");try{t=Function(`"use strict";return (${t})`)()}catch(t){return e}}return t},i=(e,t)=>{document.querySelector(`.${e}-fld`).disabled=t};return function(e){if(!e?.target?.form)return;let r=!1;const n=[];let s,a;e.target?(s=e.target,a=e.target.form,r=!0):(s=e,"dropdown"===s.type&&s.userinput&&(r=!0),a=document.getElementById(`form-${f.contentID}`));const d=a.id.slice(e.target.id.indexOf("-")+1),f=window.bf_globals[d],c=JSON.parse(JSON.stringify(f.fields));let u;const o=[],h=s.name;u=s.name&&-1!==s.name.indexOf("[]")&&s.name.indexOf("[]")===s.name.length-2?s.name.substring(0,s.name.length-2):s.name,c[f.fieldsKey[u]]&&c[f.fieldsKey[u]].error&&(delete c[f.fieldsKey[u]].error,n[f.fieldsKey[u]]=c[f.fieldsKey[u]]),c[f.fieldsKey[u]]&&!c[f.fieldsKey[u]].userinput&&r&&(c[f.fieldsKey[u]].userinput=r,n[f.fieldsKey[u]]=c[f.fieldsKey[u]]),Object.keys(f.fields).forEach((e=>{const{fieldName:t}=f.fields[e];let l;l=u===t?h:t;const r=a.querySelectorAll(`[name^='${l}']`);if(r.length>0){let e,l,{type:i}=r[0];if(r[0].name===s.name&&"checkbox"!==i)e=s.value,l=s.multiple,i=s.type;else if("checkbox"===i||"select-multiple"===i||"select-one"===i||"radio"===i)switch(i){case"checkbox":const t=[];r.forEach((e=>{e.checked&&e.value&&t.push(e.value)})),e=t,l=!0;break;case"select-multiple":const i=[];r[0].slim?r[0].slim.data.data.forEach((e=>{e.selected&&e.value&&i.push(e.value)})):r[0].childNodes.forEach((e=>{e.selected&&e.value&&i.push(e.value)})),e=i,l=!0;break;case"select-one":e=r[0].value;break;case"radio":r.forEach((t=>{t.checked&&t.value&&(e=t.value)}))}else"hidden"===r[0].type&&r[0].value&&r[0].nextElementSibling&&r[0].nextElementSibling.hasAttribute("data-msl")?(e=r[0].value.split(","),l=e&&e.length>0):(e=r[0].value,l=r[0].multiple);o[t]={type:i,value:e,multiple:l}}}));const m=(p=u,y=f.fields,Object.keys(y).find((e=>y[e].fieldName===p)));var p,y;if(!m)return;const g=[],{onfieldCondition:b}=f,v=b.filter((e=>"on_input"===e.event_type)).filter((e=>e.conditions.some((e=>e?.logics?.some((e=>e.field===m))))));if(!v.length)return;v.forEach(((e,l)=>{const{conditions:r}=e;for(let e=0;e<r.length;e+=1){const i=r[e];let n=!1;if(["if","else-if"].includes(i.cond_type)){const{logics:r}=i;if(n=t(r,o,f),n){g.push({workflowIndx:l,condIndx:e,logicStatus:n?1:0});break}}g.push({workflowIndx:l,condIndx:e,logicStatus:n?1:0})}}));const N={};g.reverse(),g.forEach((e=>{let{workflowIndx:t,condIndx:r,logicStatus:n}=e;const{conditions:s}=v[t],a=s.find((e=>"else"===e.cond_type))||{};(n?s[r].actions:a.actions)?.fields?.forEach((e=>{N[e.field]||(N[e.field]=[]),N[e.field].includes(e.action)||(N[e.field].push(e.action),((e,t,r,n)=>{if(void 0!==e.action&&void 0!==e.field)switch(r.fields[e.field].valid||(r.fields[e.field].valid={}),e.action){case"value":return((e,t,r)=>{if(void 0!==e.val&&t.fields[e.field]){const i=e.val?l(e.val,r,t):"";((e,t)=>{const l=document.querySelector(`.${e}-fld`);l.value!==t&&(l.value=t)})(e.field,i)}})(e,r,n);case"hide":return((e,t,l)=>{t.fields[e.field]&&(t.fields[e.field].valid.hide=!0)})(e,r);case"disable":r.fields[e.field]&&(r.fields[e.field].valid.disabled=!0,i(e.field,!0));break;case"readonly":r.fields[e.field]&&(r.fields[e.field].valid.readonly=!0);break;case"enable":r.fields[e.field]&&(r.fields[e.field].valid.disabled=!1,i(e.field,!1));break;case"show":r.fields[e.field]&&(r.fields[e.field].valid.hide=!1,"hidden"===r.fields[e.field].typ&&(r.fields[e.field].typ="text"))}})(e,0,f,o))}))}))}}));
