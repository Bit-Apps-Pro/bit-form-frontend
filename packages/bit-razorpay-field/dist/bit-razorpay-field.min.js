var bit_razorpay_field=function(){"use strict";return class{#e=null;#t="";#n={clientId:"",options:{currency:"INR",amount:1,amountType:"fixed",theme:{},modal:{},prefill:{},notes:{}}};#o=null;#i=null;constructor(e,t){Object.assign(this.#n,t),this.#o=t.document||document,this.#i=t.window||window,this.#t=`#form-${this.#s()}`,this.#e="string"==typeof e?this.#o.querySelector(e):e,this.init()}init(){this.#a(this.#r(`.${this.#n.fieldKey}-razorpay-btn`),"click",(()=>{this.#c()}))}#r(e,t){return t?this.#o.querySelector(t).querySelector(e):this.#e.querySelector(e)}#a(e,t,n){e.addEventListener(t,n)}#d(e,t,n){e.removeEventListener(t,n)}#l(e){if(e){const t=window.bf_globals[this.#s()].fields[e].fieldName;let n=this.#r(`[name="${t}"]`,this.#t);if(n&&"radio"===n.type&&(n=this.#r(`[name="${t}"]:checked`,this.#t)),n&&n.value)return n.value}return""}#p=e=>{var t;const n=document.getElementById(`${this.#s()}`);n.classList.add("pos-rel","form-loading");const o=document.getElementById(`form-${this.#s()}`),i=null===(t=this.#s())||void 0===t?void 0:t.split("_")[1];if(null!=o){const t={formID:i,fieldKey:this.#n.fieldKey,transactionID:e.razorpay_payment_id,payment_type:"subscription"===this.#n.payType?"subscription":"order",entry_id:this.#h()},s=bf_globals[this.#s()],a=new URL(null==s?void 0:s.ajaxURL);a.searchParams.append("_ajax_nonce",null==s?void 0:s.nonce),a.searchParams.append("action","bitforms_save_razorpay_details"),fetch(a,{method:"POST",body:JSON.stringify(t)}).then((()=>{var e,t;n.classList.remove("pos-rel","form-loading"),setBFMsg({contentId:this.#s(),msg:this.responseData.message||this.responseData,type:"success",show:!0,error:!1}),null===(e=this.responseData)||void 0===e||null===(t=e.hidden_fields)||void 0===t||t.map((e=>{setHiddenFld(e,o)})),this.#m(),bfReset(this.#s())}))}};#m(){const e=this.responseData.redirectPage;let t=null,n="";if(this.responseData.cron&&(t=this.responseData.cron),this.responseData.cronNotOk&&(t=this.responseData.cronNotOk),this.responseData.new_nonce&&(n=this.responseData.new_nonce),this.#f(t,n,this.#s()),e){const t=setTimeout((()=>{window.location=decodeURI(e),t&&clearTimeout(t)}),1e3)}}#f(e,t,n){const o=window.bf_globals[n];if(e)if("string"==typeof e){const t=new URL(e);t.protocol!==window.location.protocol&&(t.protocol=window.location.protocol),fetch(t)}else{const n=new URL(o.ajaxURL);n.searchParams.append("action","bitforms_trigger_workflow");const i={cronNotOk:e,token:t||o.nonce,id:o.appID};fetch(n,{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json"}}).then((e=>e.json()))}}async#c(){const{currency:e,amount:t,amountType:n,amountFld:o,name:i,description:s,theme:a,prefill:r,modal:c,notes:d}=this.#n.options,{confirm_close:l}=c,{contentId:p}=this.#n,h=100*Number("dynamic"===n?this.#l(o):t),m={key:this.#n.clientId,currency:e,amount:h,name:i,description:s,theme:a,prefill:{name:this.#l(r.prefillNameFld),email:this.#l(r.prefillEmailFld),contact:this.#l(r.prefillContactFld)},notes:d,modal:{backdropclose:!1,escape:!1,confirm_close:l},handler:async e=>this.#p(e)},f=bfSelect(`#form-${p}`);if("undefined"!=typeof validateForm&&!validateForm({form:p})){const e=new CustomEvent("bf-form-validation-error",{detail:{formId:p,fieldId:"",error:""}});return f.dispatchEvent(e),!1}let u=!1,y=new FormData(f);this.#h()&&(u=!0,y.append("entryID",this.#h()));const g=window.bf_globals[p];"undefined"!=typeof advancedFileHandle&&(y=advancedFileHandle(g,y)),g.GCLID&&y.set("GCLID",g.GCLID);const b=[];if(Object.entries((null==g?void 0:g.fields)||{}).forEach((e=>{var t,n;null!==(t=e[1])&&void 0!==t&&null!==(n=t.valid)&&void 0!==n&&n.hide&&b.push(e[0])})),b.length&&y.append("hidden_fields",b),"v3"===(null==g?void 0:g.gRecaptchaVersion)&&null!=g&&g.gRecaptchaSiteKey)grecaptcha.ready((()=>{grecaptcha.execute(g.gRecaptchaSiteKey,{action:"submit"}).then((async e=>{y.append("g-recaptcha-response",e);const t=this.#u(null==g?void 0:g.ajaxURL,y,u);await paymentSubmitResponse(this,t,p,y)&&new this.#i.Razorpay(m).open()}))}));else{const e=this.#u(null==g?void 0:g.ajaxURL,y,u);await paymentSubmitResponse(this,e,p,y)&&new this.#i.Razorpay(m).open()}}#y(e){localStorage.setItem("bf-entry-id",e)}#h(){return localStorage.getItem("bf-entry-id")}#s(){return this.#n.contentId}#u(e,t,n){const o=new URL(e);return o.searchParams.append("action",n?"bitforms_entry_update":"bitforms_submit_form"),fetch(o,{method:"POST",body:t})}destroy(){this.#d(this.#r(`.${this.#n.fieldKey}-razorpay-btn`),"click",(()=>{this.#c()}))}reset(){this.destroy(),this.init()}}}();
