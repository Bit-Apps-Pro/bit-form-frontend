var bit_razorpay_field=function(){"use strict";const e=".bf-form";return class{#e=null;#t={clientId:"",options:{currency:"INR",amount:1,amountType:"fixed",theme:{},modal:{},prefill:{},notes:{}}};#n=null;#o=null;#s=null;constructor(e,t){Object.assign(this.#t,t),this.#n=t.document||document,this.#s=t.window||window,this.#e="string"==typeof e?this.#n.querySelector(e):e,this.init()}init(){this.#i(this.#a(`.${this.#t.fieldKey}-razorpay-btn`),"click",(()=>{this.#r()}))}#a(e,t){return t?this.#n.querySelector(t).querySelector(e):this.#e.querySelector(e)}#i(e,t,n){e.addEventListener(t,n)}#c(t){let n=this.#a(`[name="${t}"]`,e);return n?("radio"===n.type&&(n=this.#a(`[name="${t}"]:checked`,e)),n.value||""):""}#d=e=>{var t;const n=document.getElementById(`${this.#t.contentId}`);n.classList.add("pos-rel","form-loading");const o=document.getElementById(`form-${this.#t.contentId}`),s=null===(t=this.#t.contentId)||void 0===t?void 0:t.split("_")[1];if(null!=o){const t={formID:s,fieldKey:this.#t.fieldKey,transactionID:e.razorpay_payment_id,payment_type:"subscription"===this.#t.payType?"subscription":"order",entry_id:this.#l()},o=bf_globals[this.#t.contentId],i=new URL(null==o?void 0:o.ajaxURL);i.searchParams.append("_ajax_nonce",null==o?void 0:o.nonce),i.searchParams.append("action","bitforms_save_razorpay_details"),fetch(i,{method:"POST",body:JSON.stringify(t)}).then((()=>{n.classList.remove("pos-rel","form-loading"),this.#m(),this.#p(this.#t.contentId)}))}};#p(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){const t=new CustomEvent("bf-form-reset",{detail:{formId:e}});bfSelect(`#form-${e}`).dispatchEvent(t)}const t=window.bf_globals[e];bfSelect(`#form-${e}`).reset(),localStorage.setItem("bf-entry-id",""),"undefined"!=typeof customFieldsReset&&customFieldsReset(t),t.gRecaptchaSiteKey&&"v2"===t.gRecaptchaVersion&&resetCaptcha()}#m(){const e=this.#o.redirectPage;let t=null,n="";if(this.#o.cron&&(t=this.#o.cron),this.#o.cronNotOk&&(t=this.#o.cronNotOk),this.#o.new_nonce&&(n=this.#o.new_nonce),this.#f(t,n,this.#t.contentId),e){const t=setTimeout((()=>{window.location=decodeURI(e),t&&clearTimeout(t)}),1e3)}}#f(e,t,n){const o=window.bf_globals[n];if(e)if("string"==typeof e){const t=new URL(e);t.protocol!==window.location.protocol&&(t.protocol=window.location.protocol),fetch(t)}else{const n=new URL(o.ajaxURL);n.searchParams.append("action","bitforms_trigger_workflow");const s={cronNotOk:e,token:t||o.nonce,id:o.appID};fetch(n,{method:"POST",body:JSON.stringify(s),headers:{"Content-Type":"application/json"}}).then((e=>e.json()))}}async#r(){const{currency:e,amount:t,amountType:n,amountFld:o,name:s,description:i,theme:a,prefill:r,modal:c,notes:d}=this.#t.options,{confirm_close:l}=c,{contentId:m}=this.#t,p=100*Number("fixed"===n?t:this.#c(o)),f={key:this.#t.clientId,currency:e,amount:p,name:s,description:i,theme:a,prefill:{name:this.#c(r.name),email:this.#c(r.email),contact:this.#c(r.contact)},notes:d,modal:{backdropclose:!1,escape:!1,confirm_close:l},handler:async e=>this.#d(e)},h=bfSelect(`#form-${m}`);if("undefined"!=typeof validateForm&&!validateForm({form:m})){const e=new CustomEvent("bf-form-validation-error",{detail:{formId:m,fieldId:"",error:""}});return h.dispatchEvent(e),!1}let u=!1,y=new FormData(h);this.#l()&&(u=!0,y.append("entryID",this.#l()));const g=window.bf_globals[m];"undefined"!=typeof advancedFileHandle&&(y=advancedFileHandle(g,y)),g.GCLID&&y.set("GCLID",g.GCLID);const b=[];if(Object.entries((null==g?void 0:g.fields)||{}).forEach((e=>{var t,n;null!==(t=e[1])&&void 0!==t&&null!==(n=t.valid)&&void 0!==n&&n.hide&&b.push(e[0])})),b.length&&y.append("hidden_fields",b),"v3"===(null==g?void 0:g.gRecaptchaVersion)&&null!=g&&g.gRecaptchaSiteKey)grecaptcha.ready((()=>{grecaptcha.execute(g.gRecaptchaSiteKey,{action:"submit"}).then((async e=>{y.append("g-recaptcha-response",e);const t=this.#h(null==g?void 0:g.ajaxURL,y,u);await this.#u(t,m,y)&&new this.#s.Razorpay(f).open()}))}));else{const e=this.#h(null==g?void 0:g.ajaxURL,y,u);await this.#u(e,m,y)&&new this.#s.Razorpay(f).open()}}#u(e,t,n){return new Promise((o=>{e.then((e=>new Promise(((n,o)=>{if(e.staus>400){const n=new CustomEvent("bf-form-submit-error",{detail:{formId:t,errors:e.data}});bfSelect(`#form-${t}`).dispatchEvent(n),500===e.staus?o(new Error("Mayebe Internal Server Error")):o(e.json())}else n(e.json())})))).then((e=>{const s=new CustomEvent("bf-form-submit-success",{detail:{formId:t,entryId:e.entryId,formData:n}});bfSelect(`#form-${t}`).dispatchEvent(s),this.#o=e.data,void 0!==e&&e.success&&(this.#y(e.data.entry_id),o(!0));const i=new CustomEvent("bf-form-submit-error",{detail:{formId:t,errors:e.data}});bfSelect(`#form-${t}`).dispatchEvent(i),o(!1)})).catch((e=>{null==e||!e.message||e.message,o(!1)}))}))}#y(e){localStorage.setItem("bf-entry-id",e)}#l(){return localStorage.getItem("bf-entry-id")}#h(e,t,n){const o=new URL(e);return o.searchParams.append("action",n?"bitforms_entry_update":"bitforms_submit_form"),fetch(o,{method:"POST",body:t})}destroy(){this.#e.innerHTML=""}reset(){this.destroy(),this.init()}}}();
