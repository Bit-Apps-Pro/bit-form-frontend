!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).bit_virtualized_list=t()}(this,(function(){"use strict";var e,t="undefined"==typeof document?void 0:document,i=!!t&&"content"in t.createElement("template"),n=!!t&&t.createRange&&"createContextualFragment"in t.createRange();function o(e,t){var i,n,o=e.nodeName,r=t.nodeName;return o===r||(i=o.charCodeAt(0),n=r.charCodeAt(0),i<=90&&n>=97?o===r.toUpperCase():n<=90&&i>=97&&r===o.toUpperCase())}function r(e,t,i){e[i]!==t[i]&&(e[i]=t[i],e[i]?e.setAttribute(i,""):e.removeAttribute(i))}var a={OPTION:function(e,t){var i=e.parentNode;if(i){var n=i.nodeName.toUpperCase();"OPTGROUP"===n&&(n=(i=i.parentNode)&&i.nodeName.toUpperCase()),"SELECT"!==n||i.hasAttribute("multiple")||(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),i.selectedIndex=-1)}r(e,t,"selected")},INPUT:function(e,t){r(e,t,"checked"),r(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var i=t.value;e.value!==i&&(e.value=i);var n=e.firstChild;if(n){var o=n.nodeValue;if(o==i||!i&&o==e.placeholder)return;n.nodeValue=i}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var i,n,o=-1,r=0,a=e.firstChild;a;)if("OPTGROUP"===(n=a.nodeName&&a.nodeName.toUpperCase()))a=(i=a).firstChild;else{if("OPTION"===n){if(a.hasAttribute("selected")){o=r;break}r++}!(a=a.nextSibling)&&i&&(a=i.nextSibling,i=null)}e.selectedIndex=o}}};function s(){}function d(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}var f=function(r,f,l){if(l||(l={}),"string"==typeof f)if("#document"===r.nodeName||"HTML"===r.nodeName||"BODY"===r.nodeName){var u=f;(f=t.createElement("html")).innerHTML=u}else h=(h=f).trim(),f=i?function(e){var i=t.createElement("template");return i.innerHTML=e,i.content.childNodes[0]}(h):n?function(i){return e||(e=t.createRange()).selectNode(t.body),e.createContextualFragment(i).childNodes[0]}(h):function(e){var i=t.createElement("body");return i.innerHTML=e,i.childNodes[0]}(h);var h,c=l.getNodeKey||d,p=l.onBeforeNodeAdded||s,m=l.onNodeAdded||s,v=l.onBeforeElUpdated||s,g=l.onElUpdated||s,S=l.onBeforeNodeDiscarded||s,x=l.onNodeDiscarded||s,y=l.onBeforeElChildrenUpdated||s,A=!0===l.childrenOnly,z=Object.create(null),b=[];function I(e){b.push(e)}function C(e,t){if(1===e.nodeType)for(var i=e.firstChild;i;){var n=void 0;t&&(n=c(i))?I(n):(x(i),i.firstChild&&C(i,t)),i=i.nextSibling}}function N(e,t,i){!1!==S(e)&&(t&&t.removeChild(e),x(e),C(e,i))}function _(e){m(e);for(var t=e.firstChild;t;){var i=t.nextSibling,n=c(t);if(n){var r=z[n];r&&o(t,r)?(t.parentNode.replaceChild(r,t),M(r,t)):_(t)}else _(t);t=i}}function M(e,i,n){var r=c(i);if(r&&delete z[r],!n){if(!1===v(e,i))return;if(function(e,t){var i,n,o,r,a=t.attributes;if(11!==t.nodeType&&11!==e.nodeType){for(var s=a.length-1;s>=0;s--)n=(i=a[s]).name,o=i.namespaceURI,r=i.value,o?(n=i.localName||n,e.getAttributeNS(o,n)!==r&&("xmlns"===i.prefix&&(n=i.name),e.setAttributeNS(o,n,r))):e.getAttribute(n)!==r&&e.setAttribute(n,r);for(var d=e.attributes,f=d.length-1;f>=0;f--)n=(i=d[f]).name,(o=i.namespaceURI)?(n=i.localName||n,t.hasAttributeNS(o,n)||e.removeAttributeNS(o,n)):t.hasAttribute(n)||e.removeAttribute(n)}}(e,i),g(e),!1===y(e,i))return}"TEXTAREA"!==e.nodeName?function(e,i){var n,r,s,d,f,l=i.firstChild,u=e.firstChild;e:for(;l;){for(d=l.nextSibling,n=c(l);u;){if(s=u.nextSibling,l.isSameNode&&l.isSameNode(u)){l=d,u=s;continue e}r=c(u);var h=u.nodeType,m=void 0;if(h===l.nodeType&&(1===h?(n?n!==r&&((f=z[n])?s===f?m=!1:(e.insertBefore(f,u),r?I(r):N(u,e,!0),u=f):m=!1):r&&(m=!1),(m=!1!==m&&o(u,l))&&M(u,l)):3!==h&&8!=h||(m=!0,u.nodeValue!==l.nodeValue&&(u.nodeValue=l.nodeValue))),m){l=d,u=s;continue e}r?I(r):N(u,e,!0),u=s}if(n&&(f=z[n])&&o(f,l))e.appendChild(f),M(f,l);else{var v=p(l);!1!==v&&(v&&(l=v),l.actualize&&(l=l.actualize(e.ownerDocument||t)),e.appendChild(l),_(l))}l=d,u=s}!function(e,t,i){for(;t;){var n=t.nextSibling;(i=c(t))?I(i):N(t,e,!0),t=n}}(e,u,r);var g=a[e.nodeName];g&&g(e,i)}(e,i):a.TEXTAREA(e,i)}!function e(t){if(1===t.nodeType||11===t.nodeType)for(var i=t.firstChild;i;){var n=c(i);n&&(z[n]=i),e(i),i=i.nextSibling}}(r);var T,w,P=r,E=P.nodeType,R=f.nodeType;if(!A)if(1===E)1===R?o(r,f)||(x(r),P=function(e,t){for(var i=e.firstChild;i;){var n=i.nextSibling;t.appendChild(i),i=n}return t}(r,(T=f.nodeName,(w=f.namespaceURI)&&"http://www.w3.org/1999/xhtml"!==w?t.createElementNS(w,T):t.createElement(T)))):P=f;else if(3===E||8===E){if(R===E)return P.nodeValue!==f.nodeValue&&(P.nodeValue=f.nodeValue),P;P=f}if(P===f)x(r);else{if(f.isSameNode&&f.isSameNode(P))return;if(M(P,f,A),b)for(var O=0,U=b.length;O<U;O++){var L=z[b[O]];L&&N(L,L.parentNode,!1)}}return!A&&P!==r&&r.parentNode&&(P.actualize&&(P=P.actualize(r.ownerDocument||t)),r.parentNode.replaceChild(P,r)),P},l=function(){function e(t){var i=t.itemCount,n=t.itemSizeGetter,o=t.estimatedItemSize;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._itemSizeGetter=n,this._itemCount=i,this._estimatedItemSize=o,this._itemSizeAndPositionData={},this._lastMeasuredIndex=-1}return e.prototype.getLastMeasuredIndex=function(){return this._lastMeasuredIndex},e.prototype.getSizeAndPositionForIndex=function(e){if(e<0||e>=this._itemCount)throw Error("Requested index "+e+" is outside of range 0.."+this._itemCount);if(e>this._lastMeasuredIndex){for(var t=this.getSizeAndPositionOfLastMeasuredItem(),i=t.offset+t.size,n=this._lastMeasuredIndex+1;n<=e;n++){var o=this._itemSizeGetter({index:n});if(null==o||isNaN(o))throw Error("Invalid size returned for index "+n+" of value "+o);this._itemSizeAndPositionData[n]={offset:i,size:o},i+=o}this._lastMeasuredIndex=e}return this._itemSizeAndPositionData[e]},e.prototype.getSizeAndPositionOfLastMeasuredItem=function(){return this._lastMeasuredIndex>=0?this._itemSizeAndPositionData[this._lastMeasuredIndex]:{offset:0,size:0}},e.prototype.getTotalSize=function(){var e=this.getSizeAndPositionOfLastMeasuredItem();return e.offset+e.size+(this._itemCount-this._lastMeasuredIndex-1)*this._estimatedItemSize},e.prototype.getUpdatedOffsetForIndex=function(e){var t=e.align,i=void 0===t?"start":t,n=e.containerSize,o=e.targetIndex;if(n<=0)return 0;var r=this.getSizeAndPositionForIndex(o),a=r.offset,s=a-n+r.size,d=void 0;switch(i){case"end":d=s;break;case"center":d=a-(n-r.size)/2;break;default:d=a}var f=this.getTotalSize();return Math.max(0,Math.min(f-n,d))},e.prototype.getVisibleRange=function(e){var t=e.containerSize,i=e.offset,n=e.overscanCount;if(0===this.getTotalSize())return{};var o=i+t,r=this._findNearestItem(i),a=r,s=this.getSizeAndPositionForIndex(r);for(i=s.offset+s.size;i<o&&a<this._itemCount-1;)a++,i+=this.getSizeAndPositionForIndex(a).size;return n&&(r=Math.max(0,r-n),a=Math.min(a+n,this._itemCount)),{start:r,stop:a}},e.prototype.resetItem=function(e){this._lastMeasuredIndex=Math.min(this._lastMeasuredIndex,e-1)},e.prototype._binarySearch=function(e){for(var t=e.low,i=e.high,n=e.offset,o=void 0,r=void 0;t<=i;){if(o=t+Math.floor((i-t)/2),(r=this.getSizeAndPositionForIndex(o).offset)===n)return o;r<n?t=o+1:r>n&&(i=o-1)}if(t>0)return t-1},e.prototype._exponentialSearch=function(e){for(var t=e.index,i=e.offset,n=1;t<this._itemCount&&this.getSizeAndPositionForIndex(t).offset<i;)t+=n,n*=2;return this._binarySearch({high:Math.min(t,this._itemCount-1),low:Math.floor(t/2),offset:i})},e.prototype._findNearestItem=function(e){if(isNaN(e))throw Error("Invalid offset "+e+" specified");e=Math.max(0,e);var t=this.getSizeAndPositionOfLastMeasuredItem(),i=Math.max(0,this._lastMeasuredIndex);return t.offset>=e?this._binarySearch({high:i,low:0,offset:e}):this._exponentialSearch({index:i,offset:e})},e}(),u=function(){function e(t,i){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.getRowHeight=function(e){var t=e.index,i=n.options.rowHeight;return"function"==typeof i?i(t):Array.isArray(i)?i[t]:i},this.container=t,this.options=i,this.state={},this._initializeSizeAndPositionManager(i.rowCount),this.render=this.render.bind(this),this.handleScroll=this.handleScroll.bind(this),this.componentDidMount()}return e.prototype.componentDidMount=function(){var e=this,t=this.options,i=t.onMount,n=t.initialScrollTop,o=t.initialIndex,r=t.height,a=n||null!=o&&this.getRowOffset(o)||0,s=this.inner=document.createElement("div"),d=this.content=document.createElement("div");s.setAttribute("style","position:relative; overflow:hidden; width:100%; min-height:100%; will-change: transform;"),d.setAttribute("style","position:absolute; top:0; left:0; height:100%; width:100%; overflow:visible;"),s.appendChild(d),this.container.appendChild(s),this.setState({offset:a,height:r},(function(){a&&(e.container.scrollTop=a),e.container.addEventListener("scroll",e.handleScroll),"function"==typeof i&&i()}))},e.prototype._initializeSizeAndPositionManager=function(e){this._sizeAndPositionManager=new l({itemCount:e,itemSizeGetter:this.getRowHeight,estimatedItemSize:this.options.estimatedRowHeight||100})},e.prototype.setState=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments[1];this.state=Object.assign(this.state,t),requestAnimationFrame((function(){e.render(),"function"==typeof i&&i()}))},e.prototype.resize=function(e,t){this.setState({height:e},t)},e.prototype.handleScroll=function(e){var t=this.options.onScroll,i=this.container.scrollTop;this.setState({offset:i}),"function"==typeof t&&t(i,e)},e.prototype.getRowOffset=function(e){return this._sizeAndPositionManager.getSizeAndPositionForIndex(e).offset},e.prototype.scrollToIndex=function(e,t){var i=this.state.height,n=this._sizeAndPositionManager.getUpdatedOffsetForIndex({align:t,containerSize:i,targetIndex:e});this.container.scrollTop=n},e.prototype.setRowCount=function(e){this._initializeSizeAndPositionManager(e),this.render()},e.prototype.onRowsRendered=function(e){var t=this.options.onRowsRendered;"function"==typeof t&&t(e)},e.prototype.destroy=function(){this.container.removeEventListener("scroll",this.handleScroll),this.container.innerHTML=""},e.prototype.render=function(){for(var e=this.options,t=e.overscanCount,i=e.renderRow,n=this.state,o=n.height,r=n.offset,a=void 0===r?0:r,s=this._sizeAndPositionManager.getVisibleRange({containerSize:o,offset:a,overscanCount:t}),d=s.start,l=s.stop,u=document.createDocumentFragment(),h=d;h<=l;h++)u.appendChild(i(h));this.inner.style.height=this._sizeAndPositionManager.getTotalSize()+"px",this.content.style.top=this.getRowOffset(d)+"px",f(this.content,u,{childrenOnly:!0,getNodeKey:function(e){return e.nodeIndex}}),this.onRowsRendered({startIndex:d,stopIndex:l})},e}();return u}));
