!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).bit_paypal_field=e()}(this,(function(){"use strict";const t=".bf-form";return class{#t="";#e={namespace:"paypal",payType:"payment",currency:"USD",amount:1,shipping:0,tax:0,style:{label:"paypal",color:"gold",shape:"rect",layout:"vertical"}};constructor(t,e){Object.assign(this.#e,e),this.#t=t,this.init()}init(){const{namespace:t}=this.#e,e=window[t],i={style:this.#i()};this.#n()&&(i.fundingSource=e.FUNDING[this.#e.style.payBtn]),this.#o()?i.createSubscription=(t,e)=>this.#r(t,e):i.createOrder=(t,e)=>this.#s(t,e),i.onClick=()=>this.#a(this.#c()),i.onApprove=(t,e)=>this.#l(t,e),this.#e.onInit&&(i.onInit=this.#e.onInit),e&&e.Buttons(i).render(this.#t)}#o(){return"subscription"===this.#e.payType}#n(){return"standalone"===this.#e.style.layout}#c(){return this.#e.contentId}#r(t,e){if("undefined"!=typeof validateForm&&!validateForm({form:this.#c()}))throw new Error("form validation is failed!");return e.subscription.create({plan_id:this.#e.planId})}#a(t){return isFormValidatedWithoutError(t,handleFormValidationErrorMessages).then((()=>!0)).catch((()=>!1))}#l(t,e){const i=document.getElementById(`${this.#c()}`);i.classList.add("pos-rel","form-loading"),(this.#o()?e.subscription.get():e.order.capture()).then((t=>{var e;const n=document.getElementById(`form-${this.#c()}`),o=null===(e=this.#c())||void 0===e?void 0:e.split("_")[1];if(null!=n){var r,s;const e=document.createElement("input");e.setAttribute("type","hidden"),e.setAttribute("name",this.#e.fieldKey),e.setAttribute("id","paypalfield"),e.setAttribute("value",t.id),n.appendChild(e);let a=n.querySelector('button[type="submit"]');a||(a=document.createElement("input"),a.setAttribute("type","submit"),a.style.display="none",n.appendChild(a)),a.click();const c={formID:o,transactionID:t.id,payment_name:"paypal",payment_type:this.#o()?"subscription":"order",payment_response:t},l=new URL(null===(r=bf_globals[this.#c()])||void 0===r?void 0:r.ajaxURL);l.searchParams.append("_ajax_nonce",null===(s=bf_globals[this.#c()])||void 0===s?void 0:s.nonce),l.searchParams.append("action","bitforms_payment_insert"),fetch(l,{method:"POST",body:JSON.stringify(c)}).then((()=>{i.classList.remove("pos-rel","form-loading")}))}}))}#d(t,e){var i;return null===(i=document.querySelector(e))||void 0===i?void 0:i.querySelector(t)}#p(e){let i=this.#d(`[name="${e}"]`,t);return i?("radio"===i.type&&(i=this.#d(`[name="${e}"]:checked`,t)),i.value||""):""}#s(t,e){const{currency:i,amount:n,shipping:o,tax:r}=this.#e,s=this.#p(this.#e.amountFld)||n,a=this.#p(this.#e.shippingVal)||o,c=this.#p(this.#e.taxVal)||r,l=1*Number(s).toFixed(2),d=1*Number(a).toFixed(2),p=1*(Number(c)*l/100).toFixed(2),u=1*(l+d+p).toFixed(2);return e.order.create({purchase_units:[{description:this.#p(this.#e.descFld)||this.#e.description,amount:{currency_code:i,value:u,breakdown:{item_total:{currency_code:i,value:l},shipping:{currency_code:i,value:d},tax_total:{currency_code:i,value:p}}}}]})}#i(){const{label:t,color:e,shape:i,layout:n,height:o}=this.#e.style,r={label:this.#o()?"subscribe":t,color:e,shape:i};return this.#n()||(r.layout=n),void 0!==o&&(r.height=Number(o)),r}destroy(){this.#t.innerHTML=""}reset(){this.destroy(),this.init()}}}));
