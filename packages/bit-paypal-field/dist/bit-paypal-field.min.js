var bit_paypal_field=function(){"use strict";return class{#e="";#t="";#n=null;#o={namespace:"paypal",payType:"payment",currency:"USD",amount:1,shipping:0,tax:0,style:{label:"paypal",color:"gold",shape:"rect",layout:"vertical"}};constructor(e,t){Object.assign(this.#o,t),this.#e=e,this.#t=`#form-${this.#i()}`,this.init()}init(){const{namespace:e}=this.#o,t=window[e],n={style:this.#s()};this.#r()&&(n.fundingSource=t.FUNDING[this.#o.style.payBtn]),this.#a()?n.createSubscription=(e,t)=>this.#c(e,t):n.createOrder=(e,t)=>this.#l(e,t),n.onClick=()=>this.#d(this.#i()),n.onApprove=(e,t)=>this.#p(e,t),this.#o.onInit&&(n.onInit=this.#o.onInit),t&&t.Buttons(n).render(this.#e)}#a(){return"subscription"===this.#o.payType}#r(){return"standalone"===this.#o.style.layout}#i(){return this.#o.contentId}#c(e,t){if("undefined"!=typeof validateForm&&!validateForm({form:this.#i()}))throw new Error("form validation is failed!");return t.subscription.create({plan_id:this.#o.planId})}#d(e){const t=bfSelect(this.#t);if("undefined"!=typeof validateForm&&!validateForm({form:e})){const n=new CustomEvent("bf-form-validation-error",{detail:{formId:e,fieldId:"",error:""}});return t.dispatchEvent(n),!1}let n=!1,o=new FormData(t);this.#h()&&(n=!0,o.append("entryID",this.#h()));const i=window.bf_globals[e];"undefined"!=typeof advancedFileHandle&&(o=advancedFileHandle(i,o)),i.GCLID&&o.set("GCLID",i.GCLID);const s=[];if(Object.entries((null==i?void 0:i.fields)||{}).forEach((e=>{var t,n;null!==(t=e[1])&&void 0!==t&&null!==(n=t.valid)&&void 0!==n&&n.hide&&s.push(e[0])})),s.length&&o.append("hidden_fields",s),"v3"!==(null==i?void 0:i.gRecaptchaVersion)||null==i||!i.gRecaptchaSiteKey){const t=this.#u(null==i?void 0:i.ajaxURL,o,n);return this.#f(t,e,o)}grecaptcha.ready((()=>{grecaptcha.execute(i.gRecaptchaSiteKey,{action:"submit"}).then((t=>{o.append("g-recaptcha-response",t);const s=this.#u(null==i?void 0:i.ajaxURL,o,n);return this.#f(s,e,o)}))}))}#m(e){localStorage.setItem("bf-entry-id",e)}#h(){return localStorage.getItem("bf-entry-id")}#u(e,t,n){const o=new URL(e);return o.searchParams.append("action",n?"bitforms_entry_update":"bitforms_submit_form"),fetch(o,{method:"POST",body:t})}#f(e,t,n){e.then((e=>new Promise(((n,o)=>{if(e.staus>400){const n=new CustomEvent("bf-form-submit-error",{detail:{formId:t,errors:result.data}});bfSelect(`#form-${t}`).dispatchEvent(n),500===e.staus?o(new Error("Mayebe Internal Server Error")):o(e.json())}else n(e.json())})))).then((e=>{const o=new CustomEvent("bf-form-submit-success",{detail:{formId:t,entryId:e.entryId,formData:n}});if(bfSelect(`#form-${t}`).dispatchEvent(o),this.#n=e.data,void 0!==e&&e.success)return this.#m(e.data.entry_id),!0;const i=new CustomEvent("bf-form-submit-error",{detail:{formId:t,errors:e.data}});return bfSelect(`#form-${t}`).dispatchEvent(i),!1})).catch((e=>(null==e||!e.message||e.message,!1)))}#p(e,t){const n=document.getElementById(`${this.#i()}`);n.classList.add("pos-rel","form-loading"),(this.#a()?t.subscription.get():t.order.capture()).then((e=>{var t;const o=document.getElementById(`form-${this.#i()}`),i=null===(t=this.#i())||void 0===t?void 0:t.split("_")[1];if(null!=o){const t={formID:i,transactionID:e.id,payment_name:"paypal",payment_type:this.#a()?"subscription":"order",payment_response:e,entry_id:this.#h(),fieldKey:this.#o.namespace},o=bf_globals[this.#i()],s=new URL(null==o?void 0:o.ajaxURL);s.searchParams.append("_ajax_nonce",null==o?void 0:o.nonce),s.searchParams.append("action","bitforms_payment_insert"),fetch(s,{method:"POST",body:JSON.stringify(t)}).then((()=>{n.classList.remove("pos-rel","form-loading"),this.#g(),this.#y(this.#i())}))}}))}#y(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){const t=new CustomEvent("bf-form-reset",{detail:{formId:e}});bfSelect(`#form-${e}`).dispatchEvent(t)}const t=window.bf_globals[e];bfSelect(`#form-${e}`).reset(),localStorage.setItem("bf-entry-id",""),"undefined"!=typeof customFieldsReset&&customFieldsReset(t),t.gRecaptchaSiteKey&&"v2"===t.gRecaptchaVersion&&resetCaptcha()}#g(){const e=this.#n.redirectPage;let t=null,n="";if(this.#n.cron&&(t=this.#n.cron),this.#n.cronNotOk&&(t=this.#n.cronNotOk),this.#n.new_nonce&&(n=this.#n.new_nonce),this.#b(t,n,this.#i()),e){const t=setTimeout((()=>{window.location=decodeURI(e),t&&clearTimeout(t)}),1e3)}}#b(e,t,n){const o=window.bf_globals[n];if(e)if("string"==typeof e){const t=new URL(e);t.protocol!==window.location.protocol&&(t.protocol=window.location.protocol),fetch(t)}else{const n=new URL(o.ajaxURL);n.searchParams.append("action","bitforms_trigger_workflow");const i={cronNotOk:e,token:t||o.nonce,id:o.appID};fetch(n,{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json"}}).then((e=>e.json()))}}#v(e,t){var n;return null===(n=document.querySelector(t))||void 0===n?void 0:n.querySelector(e)}#S(e){let t=this.#v(`[name="${e}"]`,this.#t);return t?("radio"===t.type&&(t=this.#v(`[name="${e}"]:checked`,this.#t)),t.value||""):""}#l(e,t){const{currency:n,amount:o,shipping:i,tax:s}=this.#o,r=this.#S(this.#o.amountFld)||o,a=this.#S(this.#o.shippingVal)||i,c=this.#S(this.#o.taxVal)||s,l=1*Number(r).toFixed(2),d=1*Number(a).toFixed(2),p=1*(Number(c)*l/100).toFixed(2),h=1*(l+d+p).toFixed(2);return t.order.create({purchase_units:[{description:this.#S(this.#o.descFld)||this.#o.description,amount:{currency_code:n,value:h,breakdown:{item_total:{currency_code:n,value:l},shipping:{currency_code:n,value:d},tax_total:{currency_code:n,value:p}}}}]})}#s(){const{label:e,color:t,shape:n,layout:o,height:i}=this.#o.style,s={label:this.#a()?"subscribe":e,color:t,shape:n};return this.#r()||(s.layout=o),void 0!==i&&(s.height=Number(i)),s}destroy(){this.#e.innerHTML=""}reset(){this.destroy(),this.init()}}}();
