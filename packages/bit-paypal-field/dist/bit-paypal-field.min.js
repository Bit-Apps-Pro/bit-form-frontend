var bit_paypal_field=function(){"use strict";return class{#t="";#e="";#n={namespace:"paypal",payType:"payment",currency:"USD",amount:1,shipping:0,tax:0,style:{label:"paypal",color:"gold",shape:"rect",layout:"vertical"}};constructor(t,e){Object.assign(this.#n,e),this.#t=t,this.#e=`#form-${this.#i()}`,this.init()}init(){const{namespace:t}=this.#n,e=window[t],n={style:this.#o()};this.#s()&&(n.fundingSource=e.FUNDING[this.#n.style.payBtn]),this.#r()?n.createSubscription=(t,e)=>this.#a(t,e):n.createOrder=(t,e)=>this.#c(t,e),n.onClick=()=>this.#l(this.#i()),n.onApprove=(t,e)=>this.#d(t,e),this.#n.onInit&&(n.onInit=this.#n.onInit),e&&e.Buttons(n).render(this.#t)}#r(){return"subscription"===this.#n.payType}#s(){return"standalone"===this.#n.style.layout}#i(){return this.#n.contentId}#a(t,e){if("undefined"!=typeof validateForm&&!validateForm({form:this.#i()}))throw new Error("form validation is failed!");return e.subscription.create({plan_id:this.#n.planId})}async#l(t){const e=bfSelect(this.#e);if("undefined"!=typeof validateForm&&!validateForm({form:t})){const n=new CustomEvent("bf-form-validation-error",{detail:{formId:t,fieldId:"",error:""}});return e.dispatchEvent(n),!1}let n=!1,i=new FormData(e);this.#p()&&(n=!0,i.append("entryID",this.#p()));const o=window.bf_globals[t];"undefined"!=typeof advancedFileHandle&&(i=advancedFileHandle(o,i)),o.GCLID&&i.set("GCLID",o.GCLID);const s=[];if(Object.entries((null==o?void 0:o.fields)||{}).forEach((t=>{var e,n;null!==(e=t[1])&&void 0!==e&&null!==(n=e.valid)&&void 0!==n&&n.hide&&s.push(t[0])})),s.length&&i.append("hidden_fields",s),"v3"===(null==o?void 0:o.gRecaptchaVersion)&&null!=o&&o.gRecaptchaSiteKey){const e=await new Promise((e=>{grecaptcha.ready((()=>{grecaptcha.execute(o.gRecaptchaSiteKey,{action:"submit"}).then((async s=>{i.append("g-recaptcha-response",s);const r=this.#h(null==o?void 0:o.ajaxURL,i,n);e(await paymentSubmitResponse(this,r,t,i))}))}))}));return e}const r=this.#h(null==o?void 0:o.ajaxURL,i,n);return await paymentSubmitResponse(this,r,t,i)}#u(t){localStorage.setItem("bf-entry-id",t)}#p(){return localStorage.getItem("bf-entry-id")}#h(t,e,n){const i=new URL(t);return i.searchParams.append("action",n?"bitforms_entry_update":"bitforms_submit_form"),fetch(i,{method:"POST",body:e})}#d(t,e){const n=document.getElementById(`${this.#i()}`);n.classList.add("pos-rel","form-loading"),(this.#r()?e.subscription.get():e.order.capture()).then((t=>{var e;const i=document.getElementById(`form-${this.#i()}`),o=null===(e=this.#i())||void 0===e?void 0:e.split("_")[1];if(null!=i){const e={formID:o,transactionID:t.id,payment_name:"paypal",payment_type:this.#r()?"subscription":"order",payment_response:t,entry_id:this.#p(),fieldKey:this.#n.namespace},i=bf_globals[this.#i()],s=new URL(null==i?void 0:i.ajaxURL);s.searchParams.append("_ajax_nonce",null==i?void 0:i.nonce),s.searchParams.append("action","bitforms_payment_insert"),fetch(s,{method:"POST",body:JSON.stringify(e)}).then((()=>{n.classList.remove("pos-rel","form-loading"),setBFMsg({contentId:this.#n.contentId,msg:this.responseData.message||this.responseData,type:"success",show:!0,error:!1}),this.#g(),bfReset(this.#i())}))}}))}#g(){const t=this.responseData.redirectPage;let e=null,n="";if(this.responseData.cron&&(e=this.responseData.cron),this.responseData.cronNotOk&&(e=this.responseData.cronNotOk),this.responseData.new_nonce&&(n=this.responseData.new_nonce),this.#f(e,n,this.#i()),t){const e=setTimeout((()=>{window.location=decodeURI(t),e&&clearTimeout(e)}),1e3)}}#f(t,e,n){const i=window.bf_globals[n];if(t)if("string"==typeof t){const e=new URL(t);e.protocol!==window.location.protocol&&(e.protocol=window.location.protocol),fetch(e)}else{const n=new URL(i.ajaxURL);n.searchParams.append("action","bitforms_trigger_workflow");const o={cronNotOk:t,token:e||i.nonce,id:i.appID};fetch(n,{method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json"}}).then((t=>t.json()))}}#m(t,e){var n;return null===(n=document.querySelector(e))||void 0===n?void 0:n.querySelector(t)}#y(t){let e=this.#m(`[name="${t}"]`,this.#e);return e?("radio"===e.type&&(e=this.#m(`[name="${t}"]:checked`,this.#e)),e.value||""):""}#c(t,e){const{currency:n,amount:i,shipping:o,tax:s}=this.#n,r=this.#y(this.#n.amountFld)||i,a=this.#y(this.#n.shippingVal)||o,c=this.#y(this.#n.taxVal)||s,l=1*Number(r).toFixed(2),d=1*Number(a).toFixed(2),p=1*(Number(c)*l/100).toFixed(2),h=1*(l+d+p).toFixed(2);return e.order.create({purchase_units:[{description:this.#y(this.#n.descFld)||this.#n.description,amount:{currency_code:n,value:h,breakdown:{item_total:{currency_code:n,value:l},shipping:{currency_code:n,value:d},tax_total:{currency_code:n,value:p}}}}]})}#o(){const{label:t,color:e,shape:n,layout:i,height:o}=this.#n.style,s={label:this.#r()?"subscribe":t,color:e,shape:n};return this.#s()||(s.layout=i),void 0!==o&&(s.height=Number(o)),s}destroy(){this.#t.innerHTML=""}reset(){this.destroy(),this.init()}}}();
