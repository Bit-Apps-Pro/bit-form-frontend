!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).bit_paypal_field=t()}(this,(function(){"use strict";const e=".bf-form";return class{#e="";#t={namespace:"paypal",payType:"payment",currency:"USD",amount:1,shipping:0,tax:0,style:{label:"paypal",color:"gold",shape:"rect",layout:"vertical"}};constructor(e,t){Object.assign(this.#t,t),this.#e=e,this.init()}init(){const{namespace:e}=this.#t,t=window[e],i={style:this.#i()};this.#n()&&(i.fundingSource=t.FUNDING[this.#t.style.payBtn]),this.#o()?i.createSubscription=(e,t)=>this.#s(e,t):i.createOrder=(e,t)=>this.#r(e,t),i.onClick=this.#a,i.onApprove=(e,t)=>this.#c(e,t),this.#t.onInit&&(i.onInit=this.#t.onInit),t&&t.Buttons(i).render(this.#e)}#o(){return"subscription"===this.#t.payType}#n(){return"standalone"===this.#t.style.layout}#s(e,t){if("undefined"!=typeof validateForm&&!validateForm({form:this.#t.contentId}))throw new Error("form validation is failed!");return t.subscription.create({plan_id:this.#t.planId})}#a(){return isFormValidatedWithoutError(this.#t.contentId,handleFormValidationErrorMessages).then((()=>!0)).catch((()=>!1))}#c(e,t){const i=document.getElementById(`${this.#t.contentId}`);i.classList.add("pos-rel","form-loading"),(this.#o()?t.subscription.get():t.order.capture()).then((e=>{var t;const n=document.getElementById(`form-${this.#t.contentId}`),o=null===(t=this.#t.contentId)||void 0===t?void 0:t.split("_")[1];if(null!=n){var s,r;const t=document.createElement("input");t.setAttribute("type","hidden"),t.setAttribute("name",this.#t.fieldKey),t.setAttribute("id","paypalfield"),t.setAttribute("value",e.id),n.appendChild(t);let a=n.querySelector('button[type="submit"]');a||(a=document.createElement("input"),a.setAttribute("type","submit"),a.style.display="none",n.appendChild(a)),a.click();const c={formID:o,transactionID:e.id,payment_name:"paypal",payment_type:this.#o()?"subscription":"order",payment_response:e},l=new URL(null===(s=bf_globals[this.#t.contentId])||void 0===s?void 0:s.ajaxURL);l.searchParams.append("_ajax_nonce",null===(r=bf_globals[this.#t.contentId])||void 0===r?void 0:r.nonce),l.searchParams.append("action","bitforms_payment_insert"),fetch(l,{method:"POST",body:JSON.stringify(c)}).then((e=>{i.classList.remove("pos-rel","form-loading")}))}}))}#l(e,t){var i;return null===(i=document.querySelector(t))||void 0===i?void 0:i.querySelector(e)}#d(t){let i=this.#l(`[name="${t}"]`,e);return i?("radio"===i.type&&(i=this.#l(`[name="${t}"]:checked`,e)),i.value||""):""}#r(e,t){const{currency:i,amount:n,shipping:o,tax:s}=this.#t,r=this.#d(this.#t.amountFld)||n,a=this.#d(this.#t.shippingVal)||o,c=this.#d(this.#t.taxVal)||s,l=1*Number(r).toFixed(2),d=1*Number(a).toFixed(2),p=1*(Number(c)*l/100).toFixed(2),u=1*(l+d+p).toFixed(2);return t.order.create({purchase_units:[{description:this.#d(this.#t.descFld)||this.#t.description,amount:{currency_code:i,value:u,breakdown:{item_total:{currency_code:i,value:l},shipping:{currency_code:i,value:d},tax_total:{currency_code:i,value:p}}}}]})}#i(){const{label:e,color:t,shape:i,layout:n,height:o}=this.#t.style,s={label:this.#o()?"subscribe":e,color:t,shape:i};return this.#n()||(s.layout=n),void 0!==o&&(s.height=Number(o)),s}destroy(){this.#e.innerHTML=""}reset(){this.destroy(),this.init()}}}));
