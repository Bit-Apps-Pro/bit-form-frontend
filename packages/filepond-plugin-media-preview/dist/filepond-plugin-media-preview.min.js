!function(e,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(e="undefined"!=typeof globalThis?globalThis:e||self).filepond_plugin_media_preview=i()}(this,(function(){"use strict";
/*!
   * FilePondPluginMediaPreview 1.0.1
   * Licensed under MIT, https://opensource.org/licenses/MIT/
   * Please visit undefined for details.
   */const e=e=>/^video/.test(e.type),i=e=>/^audio/.test(e.type),t=e=>/pdf$/.test(e.type);class d{constructor(e,i){this.mediaEl=e,this.audioElems=i,this.onplayhead=!1,this.duration=0,this.timelineWidth=this.audioElems.timeline.offsetWidth-this.audioElems.playhead.offsetWidth,this.moveplayheadFn=this.moveplayhead.bind(this),this.registerListeners()}registerListeners(){this.mediaEl.addEventListener("timeupdate",this.timeUpdate.bind(this),!1),this.mediaEl.addEventListener("canplaythrough",(()=>this.duration=this.mediaEl.duration),!1),this.audioElems.timeline.addEventListener("click",this.timelineClicked.bind(this),!1),this.audioElems.button.addEventListener("click",this.play.bind(this)),this.audioElems.playhead.addEventListener("mousedown",this.mouseDown.bind(this),!1),window.addEventListener("mouseup",this.mouseUp.bind(this),!1)}play(){this.mediaEl.paused?this.mediaEl.play():this.mediaEl.pause(),this.audioElems.button.classList.toggle("play"),this.audioElems.button.classList.toggle("pause")}timeUpdate(){let e=this.mediaEl.currentTime/this.duration*100;this.audioElems.playhead.style.marginLeft=e+"%",this.mediaEl.currentTime===this.duration&&(this.audioElems.button.classList.toggle("play"),this.audioElems.button.classList.toggle("pause"))}moveplayhead(e){let i=e.clientX-this.getPosition(this.audioElems.timeline);i>=0&&i<=this.timelineWidth&&(this.audioElems.playhead.style.marginLeft=i+"px"),i<0&&(this.audioElems.playhead.style.marginLeft="0px"),i>this.timelineWidth&&(this.audioElems.playhead.style.marginLeft=this.timelineWidth-4+"px")}timelineClicked(e){this.moveplayhead(e),this.mediaEl.currentTime=this.duration*this.clickPercent(e)}mouseDown(){this.onplayhead=!0,window.addEventListener("mousemove",this.moveplayheadFn,!0),this.mediaEl.removeEventListener("timeupdate",this.timeUpdate.bind(this),!1)}mouseUp(e){window.removeEventListener("mousemove",this.moveplayheadFn,!0),1==this.onplayhead&&(this.moveplayhead(e),this.mediaEl.currentTime=this.duration*this.clickPercent(e),this.mediaEl.addEventListener("timeupdate",this.timeUpdate.bind(this),!1)),this.onplayhead=!1}clickPercent(e){return(e.clientX-this.getPosition(this.audioElems.timeline))/this.timelineWidth}getPosition(e){return e.getBoundingClientRect().left}}const a=a=>{const{addFilter:s,utils:l}=a,{Type:n,createRoute:o}=l,r=(m=a).utils.createView({name:"media-preview-wrapper",create:a=>{let{root:s,props:l}=a;const n=(a=>a.utils.createView({name:"media-preview",tag:"div",ignoreRect:!0,create:e=>{let{root:d,props:a}=e;const s=d.query("GET_ITEM",{id:a.id});if(t(s.file))d.ref.media=document.createElement("object"),d.ref.media.setAttribute("height",300),d.ref.media.setAttribute("width",320),d.ref.media.setAttribute("style","position:absolute;left:0;right:0;margin:auto;"),d.element.appendChild(d.ref.media);else{let e=i(s.file)?"audio":"video";if(d.ref.media=document.createElement(e),d.ref.media.setAttribute("controls",!0),d.element.appendChild(d.ref.media),i(s.file)){let e=document.createDocumentFragment();d.ref.audio=[],d.ref.audio.container=document.createElement("div"),d.ref.audio.button=document.createElement("span"),d.ref.audio.timeline=document.createElement("div"),d.ref.audio.playhead=document.createElement("div"),d.ref.audio.container.className="audioplayer",d.ref.audio.button.className="playpausebtn play",d.ref.audio.timeline.className="timeline",d.ref.audio.playhead.className="playhead",d.ref.audio.timeline.appendChild(d.ref.audio.playhead),d.ref.audio.container.appendChild(d.ref.audio.button),d.ref.audio.container.appendChild(d.ref.audio.timeline),e.appendChild(d.ref.audio.container),d.element.appendChild(e)}}},write:a.utils.createRoute({DID_MEDIA_PREVIEW_LOAD:a=>{let{root:s,props:l}=a;const{id:n}=l,o=s.query("GET_ITEM",{id:n});if(!o)return;let r=window.URL||window.webkitURL,m=new Blob([o.file],{type:o.file.type});s.ref.media.type=o.file.type,t(o.file)?s.ref.media.data=r.createObjectURL(m):s.ref.media.src=o.file.mock&&o.file.url||r.createObjectURL(m),i(o.file)&&new d(s.ref.media,s.ref.audio),s.ref.media.addEventListener("loadeddata",(()=>{if(e(o.file)||i(o.file)){let i=75;if(e(o.file)){let e=s.ref.media.offsetWidth,t=s.ref.media.videoWidth/e;i=s.ref.media.videoHeight/t}s.dispatch("DID_UPDATE_PANEL_HEIGHT",{id:n,height:i})}}),!1),s.ref.media.addEventListener("load",(()=>{t(o.file)&&s.dispatch("DID_UPDATE_PANEL_HEIGHT",{id:n,height:s.ref.media.scrollHeight})}),!1)}})}))(m);s.ref.media=s.appendChildView(s.createChildView(n,{id:l.id}))},write:m.utils.createRoute({DID_MEDIA_PREVIEW_CONTAINER_CREATE:e=>{let{root:i,props:t}=e;const{id:d}=t;i.query("GET_ITEM",d)&&i.dispatch("DID_MEDIA_PREVIEW_LOAD",{id:d})}})});var m;return s("CREATE_VIEW",(d=>{const{is:a,view:s,query:l}=d;a("file")&&s.registerWriter(o({DID_LOAD_ITEM:d=>{let{root:a,props:n}=d;const{id:o}=n,m=l("GET_ITEM",o);m&&!m.archived&&(e(m.file)||t(m.file)||i(m.file))&&(a.ref.mediaPreview=s.appendChildView(s.createChildView(r,{id:o})),a.dispatch("DID_MEDIA_PREVIEW_CONTAINER_CREATE",{id:o}))}},(d=>{let{root:a,props:s}=d;const{id:n}=s,o=l("GET_ITEM",n);(e(o.file)||t(o.file)||i(o.file))&&a.rect.element.hidden})))})),{options:{allowPdfPreview:[!0,n.BOOLEAN],allowVideoPreview:[!0,n.BOOLEAN],allowAudioPreview:[!0,n.BOOLEAN]}}};return"undefined"!=typeof window&&void 0!==window.document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:a})),a}));
