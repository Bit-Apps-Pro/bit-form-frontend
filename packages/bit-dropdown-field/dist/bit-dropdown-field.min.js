!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).bit_dropdown_field=e()}(this,(function(){"use strict";return class{#t=null;#e=null;#s=null;#i=null;#n=null;#l=null;#o=null;#a=null;#h=null;#r=null;#p=null;#d="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'/>";#c="";#u=[];#m=[];#f=null;#g={};#O={separator:"\n",selectedOptImage:!0,dropdownIcn:"",selectedOptClearable:!0,searchClearable:!0,optionIcon:!0,defaultValue:"",placeholder:"Select an option",searchPlaceholder:"Search option",maxHeight:370,closeOnSelect:!0,options:[],attributes:{},classNames:{},onChange:t=>{}};#b=null;#y="";#E=[];constructor(t,e){Object.assign(this.#O,e),this.#f=e.document?e.document:document,this.#g=e.window?e.window:window,this.#t="string"==typeof t?this.#f.querySelector(t):t,this.fieldKey=this.#O.fieldKey,this.init()}init(){this.#e=this.#w(`.${this.fieldKey}-dpd-hidden-input`),this.#s=this.#w(`.${this.fieldKey}-opt-search-input`),this.#i=this.#w(`.${this.fieldKey}-option-wrp`),this.#n=this.#w(`.${this.fieldKey}-dpd-wrp`),this.#l=this.#w(`.${this.fieldKey}-selected-opt-img`),this.#h=this.#O.searchClearable?this.#w(`.${this.fieldKey}-search-clear-btn`):{},this.#v(this.#n,"click",(t=>{this.#C(t)})),this.#v(this.#n,"keyup",(t=>{this.#C(t)})),this.#v(this.#t,"keydown",(t=>{this.#I(t)})),this.#x(),this.#O.dropdownIcn&&(this.#l.src=this.#O.dropdownIcn),this.#O.searchClearable&&(this.#s.style.paddingRight="25px",this.#h.style.display="none",this.#v(this.#h,"click",(()=>{this.searchOptions("")}))),this.#s.placeholder=this.#O.searchPlaceholder,this.#s.value="",this.#v(this.#s,"keyup",(t=>{this.#S(t)})),this.allowCustomOption=this.#O.allowCustomOption,this.allowCustomOption,observeElm(this.#e,"value",((t,e)=>{this.#L(t,e)}))}#x(){this.#p=this.#w(`.${this.fieldKey}-option-list.active-list`),this.#$(),this.#O.options=this.#A(),this.#m=[...this.#O.options]}#w(t,e){return this.#t.querySelector(t)}#K(t){return this.#t.querySelectorAll(t)}#v(t,e,s){null==t||t.addEventListener(e,s),this.#E.push({selector:t,eventType:e,cb:s})}#L(t,e){t!==e&&this.setSelectedOption(e)}#T(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,e=arguments.length>1?arguments[1]:void 0;if("next"===e){const e=this.#m.length;for(let s=t+1;s<e;s+=1){const t=this.#m[s];if("group"!==t.type&&!t.disabled)return s}}else if("previous"===e)for(let e=t-1;e>=0;e-=1){const t=this.#m[e];if("group"!==t.type&&!t.disabled)return e}}#k(t){return this.#w(`${this.#W()} .${this.fieldKey}-option[data-index="${t}"]`)}#I(t){const e=this.#f.activeElement;let s=null;if(this.#N()){const i=Number(e.dataset.index||-1);if("ArrowDown"===t.key||!t.shiftKey&&"Tab"===t.key){t.preventDefault();let n=0,l=null;e===this.#s?(n=this.#T(-1,"next"),l=this.#k(n)):e.classList.contains(`${this.fieldKey}-option`)&&(n=this.#T(i,"next"),l=this.#k(n)),l&&(s=l)}else if("ArrowUp"===t.key||t.shiftKey&&"Tab"===t.key){if(t.preventDefault(),e===this.#s)s=this.#n,this.#N()&&this.setMenu({open:!1});else if(e.classList.contains(`${this.fieldKey}-option`)){const t=this.#T(i,"previous"),e=this.#k(t);e?s=e:e||(s=this.#s)}}else"Escape"===t.key&&this.setMenu({open:!1})}else if(t.key>="a"&&t.key<="z"){clearTimeout(this.#b),this.#y+=t.key,this.#b=setTimeout((()=>{this.#y=""}),300);const e=this.#O.options.find((t=>"group"!==t.type&&!t.disabled&&t.lbl.toLowerCase().startsWith(this.#y)));e&&this.setSelectedOption(e.val)}else if("ArrowDown"===t.key||"ArrowUp"===t.key){const e=this.#V(),s="ArrowDown"===t.key?"next":"previous",i=this.#T(e,s);i>-1&&i<this.#O.options.length&&(this.value=this.#O.options[i].val)}s&&s.focus()}#W(){var t;const e=null===(t=this.#p)||void 0===t?void 0:t.dataset.list;return e?`.${this.fieldKey}-option-list[data-list="${e}"]`:`.${this.fieldKey}-option-list`}#A(){const t=Array.from(this.#K(`${this.#W()} .${this.fieldKey}-option`)),e=t=>{const e={},s=t.querySelector(`.${this.fieldKey}-opt-lbl`),{value:i}=t.dataset;e.lbl=s.textContent,i&&(e.val=i),this.#B(t,"disabled-opt")&&(e.disabled=!0);const n=t.querySelector(`.${this.fieldKey}-opt-icn`);this.#O.dropdownIcn&&null!=n&&n.src&&(e.img=n.src);const{attributes:l}=t,o=l.length;e.attributes={};for(let s=0;s<o;s+=1){const i=l[s].nodeName;e.attributes[i]=t.getAttribute(i)}return e},s=[],{length:i}=t;for(let n=0;n<i;n+=1){const l=t[n];let o={},a=null;if(l.classList.contains(`${this.fieldKey}-opt-group-title`)){o=e(l),o.type="group",s.push(o),a=n;for(let l=n+1;l<i;l+=1){const i=t[l];if(!i.classList.contains(`${this.fieldKey}-opt-group-child`)){n=l-1;break}{const t=e(i);t.groupIndex=a,n=l,s.push(t)}}}else o=e(l),s.push(o)}return s}#F(t){null==t||t.stopPropagation(),this.#c="",this.#O.selectedOptImage&&(this.#l.src=this.#d),this.#D(this.#o,this.#O.placeholder),this.#a.style.display="none",this.#H()}#M(t){return[...this.#O.options,...this.#u].find((e=>e.val===t))}setSelectedOption(t){let e=null;const s=t.split(this.#O.separator);e=this.#O.multipleSelect?1===s.length?this.#M(s[0]):{lbl:`${s.length} options selected`}:this.#M(t),this.#c=t,this.#c||this.#F(),this.#H(),e&&(this.#o=this.#w(`.${this.fieldKey}-selected-opt-lbl`),this.#a=this.#w(`.${this.fieldKey}-selected-opt-clear-btn`),this.#O.selectedOptImage&&(this.#O.multipleSelect?s.length>1?this.#l.src=this.#O.selectedOptImgSrc:1===s.length?this.#l.src=e.img:this.#l.src=this.#d:this.#l.src=e.img),this.#D(this.#o,e.lbl),this.#O.closeOnSelect&&this.setMenu({open:!1}),this.value=t,this.#O.selectedOptClearable&&(this.#a.style.display="grid",this.#v(this.#a,"click",(t=>{this.#F(t)}))),this.#O.onChange&&this.#O.onChange(t))}#V(){return this.#m.findIndex((t=>t.val===this.#c))}#j(t){return this.#f.createElement(t)}#R(t,e){t.tabIndex=e}#q(t,e){t.classList.add(e)}#B(t,e){return t.classList.contains(e)}#D(t,e){t.textContent=e}#P(t){return t&&t.split(this.#O.separator)||[]}#z(t){return t.join(this.#O.separator)}#U(t){const e=t.currentTarget,s=e.dataset.value;if(this.#O.allowCustomOption&&e.classList.contains(`${this.fieldKey}-create-opt`)&&this.#_(s),this.#O.multipleSelect){const t=this.#P(this.#c);if(t.includes(s)){const i=t.indexOf(s);t.splice(i,1),e.classList.remove("selected-opt")}else t.push(s),e.classList.add("selected-opt");this.#c=this.#z(t)}else this.#c=s;this.#H(),this.setSelectedOption(this.#c),setTimeout((()=>{this.#w(`${this.#W()} .${this.fieldKey}-option[data-value="${s}"]`).focus()}),0)}#H(){this.#G()}#J(){return this.#K(`${this.#W()} .${this.fieldKey}-option:not(.${this.fieldKey}-opt-group-title):not(.${this.fieldKey}-create-opt)`)}#$(){const t=this.#J();for(const e of t)this.#v(e,"click",(t=>{this.#U(t)})),this.#v(e,"keyup",(t=>{"Enter"===t.key&&this.#U(t)}))}#Q(){const t=this.#J(),e=this.#N();for(const s of t)e?this.#R(s,0):this.#R(s,-1)}#X(t,e,s){var i;null==t||null===(i=t.setAttribute)||void 0===i||i.call(t,e,s)}#Y(t,e){const s=Object.keys(e),i=s.length;if(i)for(let n=0;n<i;n+=1)this.#X(t,s[n],e[s[n]])}#G(){this.#p.innerHTML="";const t=this.#c.split(this.#O.separator),e=this.#m.length;for(let s=0;s<e;s+=1){const e=this.#m[s],i=this.#j("li");if("not-found"===e.i)return this.#D(i,e.lbl),this.#q(i,`${this.fieldKey}-opt-not-found`),void this.#p.appendChild(i);this.#q(i,`${this.fieldKey}-option`);const n=this.#j("span");if(this.#q(n,`${this.fieldKey}-opt-lbl-wrp`),"opt-lbl-wrp"in this.#O.classNames){const t=this.#O.classNames["opt-lbl-wrp"];t&&this.#q(n,t)}if("opt-lbl-wrp"in this.#O.attributes){const t=this.#O.attributes["opt-lbl-wrp"];this.#Y(n,t)}if(this.#O.optionIcon){const t=this.#j("img");if(this.#q(t,`${this.fieldKey}-opt-icn`),"opt-icn"in this.#O.classNames){const e=this.#O.classNames["opt-icn"];e&&this.#q(t,e)}if("opt-icn"in this.#O.attributes){const e=this.#O.attributes["opt-icn"];this.#Y(t,e)}t.src=e.img,t.alt=e.lbl,t.loading="lazy",n.append(t)}const l=this.#j("span");if(this.#q(l,`${this.fieldKey}-opt-lbl`),"opt-lbl"in this.#O.classNames){const t=this.#O.classNames["opt-lbl"];t&&this.#q(l,t)}if("opt-lbl"in this.#O.attributes){const t=this.#O.attributes["opt-lbl"];this.#Y(l,t)}this.#D(l,e.lbl),n.append(l);const o=this.#j("span");if(this.#q(o,"opt-prefix"),"opt-prefix"in this.#O.classNames){const t=this.#O.classNames["opt-prefix"];t&&this.#q(o,t)}if("opt-prefix"in this.#O.attributes){const t=this.#O.attributes["opt-prefix"];this.#Y(l,t)}this.#D(o,e.code),i.append(n,o),Object.keys(e.attributes).map((t=>{this.#X(i,t,e.attributes[t])})),t.includes(e.val)?(this.#q(i,"selected-opt"),this.#X(i,"aria-selected",!0)):this.#X(i,"aria-selected",!1),this.#p.appendChild(i),"group"===e.type?this.#q(i,`${this.fieldKey}-opt-group-title`):("groupIndex"in e&&this.#q(i,`${this.fieldKey}-opt-group-child`),this.#X(i,"data-index",s),this.#X(i,"data-value",e.val),this.#X(i,"role","option"),this.#X(i,"aria-posinset",s+1),this.#X(i,"aria-setsize",this.#m.length),this.#R(i,this.#N()?"0":"-1"),e.disabled?this.#q(i,"disabled-opt"):(this.#v(i,"click",(t=>{this.#U(t)})),this.#v(i,"keyup",(t=>{"Enter"===t.key&&this.#U(t)}))))}}#S(t){if("Enter"===t.key&&this.#m.length){var e;const s=null===(e=this.#m)||void 0===e?void 0:e[0].i;if(s&&(this.setSelectedOption(s),this.searchOptions("")),this.#O.allowCustomOption&&"none"!==this.#r.style.display){const{value:e}=t.target;if(this.#_(e),this.#O.multipleSelect){const t=this.#P(this.#c);t.push(e),this.#c=this.#z(t)}else this.#c=e;this.#H(),this.setSelectedOption(this.#c)}}else this.searchOptions(t.target.value)}#_(t){let e=t.trim();if(e.includes&&e){const t=this.#u.length;for(let s=0;s<t;s+=1)if(this.#u[s].lbl.toLowerCase()===e){e="";break}if(e){const t={lbl:e,val:e,attributes:{}};this.#u.push(t),this.#m.push(t),this.searchOptions("")}}}searchOptions(t){this.#Z(t);let e=[],s=!1;if(t){const i=this.#O.options.length,n=[],l=t.toLowerCase();for(let t=0;t<i;t+=1){const i=this.#O.options[t];if("type"in i)continue;const o=i.lbl.toLowerCase();if(o.includes(l)){if("groupIndex"in i&&!n.includes(i.groupIndex)){const t=i.groupIndex;n.push(t),e.push(this.#O.options[t])}e.push(i),o===l&&(s=!0)}}const o=this.#u.length;for(let t=0;t<o;t+=1){const i=this.#u[t],n=i.lbl.toLowerCase();n.includes(l)&&(e.push(i),n===l&&(s=!0))}e.length||(e=[{i:"not-found",lbl:"No Option Found"}]),this.#m=[this.#O.options[0],...e],this.#O.searchClearable&&(this.#h.style.display="grid")}else this.#m=this.#O.options,this.#O.searchClearable&&(this.#h.style.display="none"),this.allowCustomOption&&(this.#r=this.#w(`${this.#W()} .${this.fieldKey}-create-opt`),this.#r.style.display="none",this.#m=this.#m.concat(this.#u));this.#H(),this.#r=this.#w(`${this.#W()} .${this.fieldKey}-create-opt`),s&&this.allowCustomOption?this.#r.style.display="none":this.allowCustomOption&&t.trim()&&(this.#r.style.display="block",this.#r.querySelector(`.${this.fieldKey}-opt-lbl`).innerText=`Create: ${t}`,this.#X(this.#r,"data-value",t))}#Z(t){this.#s.value=t}#tt(t){this.#t.contains(t.target)||this.setMenu({open:!1})}#N(){return this.#B(this.#t,`${this.fieldKey}-menu-open`)}#et(){const t=this.#n.getBoundingClientRect(),e=t.top,s=this.#g.innerHeight-t.bottom;s<e&&s<this.#O.maxHeight?(this.#t.style.flexDirection="column-reverse",this.#t.style.bottom="0%"):(this.#t.style.flexDirection="column",this.#t.style.removeProperty("bottom"))}setMenu(t){let{open:e}=t;this.#i.style.maxHeight=`${e?this.#O.maxHeight:0}px`,e?(this.#et(),this.#t.classList.add(`${this.fieldKey}-menu-open`),this.#v(this.#f,"click",(t=>this.#tt(t))),this.#R(this.#s,0),this.#R(this.#h,0),this.#n.setAttribute("aria-expanded","true"),this.#X(this.#p,"aria-hidden",!1),this.#X(this.#s,"aria-hidden",!1),this.#H()):(this.#t.classList.remove(`${this.fieldKey}-menu-open`),this.#f.removeEventListener("click",this.#tt),this.searchOptions(""),this.#R(this.#s,-1),this.#R(this.#h,-1),this.#n.setAttribute("aria-expanded","false"),this.#X(this.#p,"aria-hidden",!0),this.#X(this.#s,"aria-hidden",!0)),this.#Q()}#C(t){"Space"===t.code&&(this.#s.focus(),this.setMenu({open:!0})),"click"===t.type&&(this.#N()?this.setMenu({open:!1}):(this.#s.focus(),this.setMenu({open:!0})))}set activelist(t){const e=this.#w(`.${this.fieldKey}-option-list[data-list=${t}]`);e&&(this.#K(`.${this.fieldKey}-option-list:not([data-list=${t}])`).forEach((t=>t.classList.remove("active-list"))),this.#q(e,"active-list"),this.setSelectedOption(""),this.#x())}set disabled(t){"true"===String(t).toLowerCase()?(this.#t.classList.add("disabled"),this.#e.disabled=!0,this.#R(this.#n,-1),this.#R(this.#a,-1),this.#X(this.#n,"aria-label","Dropdown disabled"),this.setMenu({open:!1})):"false"===String(t).toLowerCase()&&(this.#t.classList.remove("disabled"),this.#e.removeAttribute("disabled"),this.#R(this.#n,0),this.#R(this.#a,0),this.#X(this.#n,"aria-label",this.#O.placeholder))}get disabled(){return this.#e.disabled}set readonly(t){"true"===String(t).toLowerCase()?(this.#t.classList.add("disabled"),this.#e.readOnly=!0,this.#R(this.#n,-1),this.#R(this.#a,-1),this.setMenu({open:!1})):"false"===String(t).toLowerCase()&&(this.#t.classList.remove("disabled"),this.#e.removeAttribute("readonly"),this.#R(this.#n,0),this.#R(this.#a,0))}get readonly(){return this.#e.readOnly}set value(t){this.#e.value=t}get value(){return this.#e.value}#st(){this.#E.forEach((t=>{let{selector:e,eventType:s,cb:i}=t;e.removeEventListener(s,i)}))}destroy(){this.value="",this.#st()}}}));
