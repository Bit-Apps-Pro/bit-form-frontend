!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).bit_dropdown_field=e()}(this,(function(){"use strict";return class{#t=null;#e=null;#s=null;#i=null;#n=null;#o=null;#l=null;#a=null;#h=null;#p=!1;#r=null;#d=null;#c="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'/>";#u="";#m=[];#g=[];#f=null;#O={};#b={separator:",",selectedOptImage:!1,dropdownIcn:"",selectedOptClearable:!0,searchClearable:!0,optionIcon:!0,defaultValue:"",placeholder:"Select an option",searchPlaceholder:"Search option",maxHeight:370,closeOnSelect:!1,options:[],attributes:{},classNames:{},onChange:t=>{}};#E=null;#y="";#w=[];constructor(t,e){Object.assign(this.#b,e),this.#f=e.document?e.document:document,this.#O=e.window?e.window:window,this.#t="string"==typeof t?this.#f.querySelector(t):t,this.fieldKey=this.#b.fieldKey,this.init()}init(){this.#e=this.#C(`.${this.fieldKey}-dpd-hidden-input`),this.#s=this.#C(`.${this.fieldKey}-opt-search-input`),this.#i=this.#C(`.${this.fieldKey}-option-wrp`),this.#n=this.#C(`.${this.fieldKey}-dpd-wrp`),this.#o=this.#C(`.${this.fieldKey}-selected-opt-img`),this.#h=this.#b.searchClearable?this.#C(`.${this.fieldKey}-search-clear-btn`):{},this.#v(this.#n,"click",(t=>{this.#I(t)})),this.#v(this.#n,"keyup",(t=>{this.#I(t)})),this.#v(this.#t,"keydown",(t=>{this.#x(t)})),this.#S(),this.#b.defaultValue&&this.setSelectedOption(this.#b.defaultValue),this.#A(),this.#b.selectedOptImage&&(this.#o.src=this.#c),this.#b.searchClearable&&(this.#s.style.paddingRight="25px",this.#h.style.display="none",this.#v(this.#h,"click",(()=>{this.searchOptions("")}))),this.#s.placeholder=this.#b.searchPlaceholder,this.#s.value="",this.#v(this.#s,"keyup",(t=>{this.#L(t)})),this.#p=this.#b.allowCustomOption,observeElm(this.#e,"value",((t,e)=>{this.#N(t,e)}))}#S(){this.#d=this.#C(`.${this.fieldKey}-option-list.active-list`),this.#T(),this.#b.options=this.#k(),this.#g=[...this.#b.options]}#C(t,e){return this.#t.querySelector(t)}#V(t){return this.#t.querySelectorAll(t)}#v(t,e,s){t?.addEventListener(e,s),this.#w.push({selector:t,eventType:e,cb:s})}#A(){this.#e.value&&(this.setSelectedOption(this.#e.value),this.#W())}#N(t,e){t!==e&&this.setSelectedOption(e),"undefined"!=typeof bit_conditionals&&bit_conditionals({target:this.#e})}#B(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,e=arguments.length>1?arguments[1]:void 0;if("next"===e){const e=this.#g.length;for(let s=t+1;s<e;s+=1){const t=this.#g[s];if("group"!==t.type&&!t.disabled)return s}}else if("previous"===e)for(let e=t-1;e>=0;e-=1){const t=this.#g[e];if("group"!==t.type&&!t.disabled)return e}}#D(t){return this.#C(`${this.#$()} .option[data-index="${t}"]`)}#x(t){const e=this.#f.activeElement;let s=null;if(this.#F()){const i=Number(e.dataset.index||-1);if("ArrowDown"===t.key||!t.shiftKey&&"Tab"===t.key){t.preventDefault();let n=0,o=null;e===this.#s?(n=this.#B(-1,"next"),this.#p&&0===n&&"block"!==this.#H(this.#r)&&(n=1),o=this.#D(n)):e.classList.contains("option")&&(n=this.#B(i,"next"),o=this.#D(n)),o&&(s=o)}else if("ArrowUp"===t.key||t.shiftKey&&"Tab"===t.key){if(t.preventDefault(),e===this.#s)s=this.#n,this.#F()&&this.setMenu({open:!1});else if(e.classList.contains("option")){let t=this.#B(i,"previous");this.#K&&0===t&&"block"!==this.#r?.style.display&&(t=-1);const e=this.#D(t);e?s=e:e||(s=this.#s)}}else"Escape"===t.key&&this.setMenu({open:!1})}else if(t.key>="a"&&t.key<="z"){clearTimeout(this.#E),this.#y+=t.key,this.#E=setTimeout((()=>{this.#y=""}),300);const e=this.#b.options.find((t=>"group"!==t.type&&!t.disabled&&t.lbl.toLowerCase().startsWith(this.#y)));e&&this.setSelectedOption(e.val)}else if("ArrowDown"===t.key||"ArrowUp"===t.key){t.preventDefault();const e=this.#M(),s="ArrowDown"===t.key?"next":"previous";let i=this.#B(e,s);this.#p&&0===i&&(i=1),i>-1&&i<this.#b.options.length&&(this.value=this.#b.options[i].val)}s&&s.focus()}#$(){const t=this.#d?.dataset.list;return t?`.${this.fieldKey}-option-list[data-list="${t}"]`:`.${this.fieldKey}-option-list`}#k(){const t=Array.from(this.#V(`${this.#$()} .option`)),e=t=>{const e={},s=t.querySelector(".opt-lbl"),{value:i}=t.dataset;e.lbl=s.textContent,i&&(e.val=i),this.#j(t,"disabled-opt")&&(e.disabled=!0);const n=t.querySelector(".opt-icn");this.#b.selectedOptImage&&n?.src&&(e.img=n.src);const{attributes:o}=t,l=o.length;e.attributes={};for(let s=0;s<l;s+=1){const i=o[s].nodeName;e.attributes[i]=t.getAttribute(i)}return e},s=[],{length:i}=t;for(let n=0;n<i;n+=1){const o=t[n];let l={},a=null;if(o.classList.contains("opt-group-title")){l=e(o),l.type="group",s.push(l),a=n;for(let o=n+1;o<i;o+=1){const i=t[o];if(!i.classList.contains("opt-group-child")){n=o-1;break}{const t=e(i);t.groupIndex=a,n=o,s.push(t)}}}else l=e(o),s.push(l)}return s}#R(t){t?.stopPropagation(),this.#u="",this.#b.selectedOptImage&&(this.#o.src=this.#c),this.#q(this.#l,this.#b.placeholder),this.#a.style.display="none",this.#W()}#P(t){return[...this.#b.options,...this.#m].find((e=>e.val===t))}setSelectedOption(t){let e=null,s=t.split(this.#b.separator);s=s.filter((t=>this.#P(t))),this.#b.multipleSelect?1===s.length?e=this.#P(s[0]):s.length>1&&(e={lbl:`${s.length} options selected`}):e=this.#P(t),this.#u=t,this.#u||this.#R(),e&&(this.#l=this.#C(`.${this.fieldKey}-selected-opt-lbl`),this.#a=this.#C(`.${this.fieldKey}-selected-opt-clear-btn`),this.#b.selectedOptImage&&(this.#b.multipleSelect?s.length>1?this.#o.src=this.#c:1===s.length?this.#o.src=e.img||this.#c:this.#o.src=this.#c:this.#o.src=e.img||this.#c),this.#q(this.#l,e.lbl),this.#b.closeOnSelect&&this.setMenu({open:!1}),this.#_(this.#e,"value",t),this.#b.selectedOptClearable&&(this.#a.style.display="grid",this.#v(this.#a,"click",(t=>{this.#R(t)}))),this.#b.onChange&&this.#b.onChange(t))}#M(){return this.#g.findIndex((t=>t.val===this.#u))}#z(t){return this.#f.createElement(t)}#U(t,e){t.tabIndex=e}#G(t,e){t.classList.add(e)}#J(t,e){t.classList.remove(e)}#H(t){return t?.style.display||""}#j(t,e){return t.classList.contains(e)}#q(t,e){t.textContent=e}#Q(t){return t&&t.split(this.#b.separator)||[]}#X(t){return t.join(this.#b.separator)}#Y(t){const e=t.currentTarget,s=e.dataset.value;if(this.#p&&e.classList.contains("create-opt")&&this.#K(s),this.#b.multipleSelect){const t=this.#Q(this.#u);if(t.includes(s)){const i=t.indexOf(s);t.splice(i,1),this.#J(e,"selected-opt")}else t.push(s),this.#G(e,"selected-opt");this.#u=this.#X(t)}else this.#u=s;this.setSelectedOption(this.#u),setTimeout((()=>{this.#C(`${this.#$()} .option[data-value="${s}"]`).focus()}),0)}#W(){this.#Z()}#tt(){return this.#V(`${this.#$()} .option:not(.opt-group-title):not(.create-opt)`)}#T(){const t=this.#tt(),e=t.length;for(let s=0;s<e;s+=1){const e=t[s];this.#v(e,"click",(t=>{this.#Y(t)})),this.#v(e,"keyup",(t=>{"Enter"===t.key&&this.#Y(t)}))}}#et(){const t=this.#tt(),e=this.#F(),s=t.length;for(let i=0;i<s;i+=1){const s=t[i];e?this.#U(s,0):this.#U(s,-1)}}#_(t,e,s){t?.setAttribute?.(e,s)}#st(t,e){const s=e.length;if(s)for(let i=0;i<s;i+=1)this.#_(t,e[i].key,e[i].value)}#Z(){this.#d.innerHTML="";const t=this.#u.split(this.#b.separator),e=this.#g.length;for(let s=0;s<e;s+=1){const e=this.#g[s],i=this.#z("li");if("not-found"===e.i)return this.#q(i,e.lbl),this.#G(i,"opt-not-found"),void this.#d.appendChild(i);this.#G(i,"option");const n=this.#z("span");if(this.#G(n,"opt-lbl-wrp"),"opt-lbl-wrp"in this.#b.classNames){const t=this.#b.classNames["opt-lbl-wrp"];t&&this.#G(n,t)}if("opt-lbl-wrp"in this.#b.attributes){const t=this.#b.attributes["opt-lbl-wrp"];this.#st(n,t)}if(this.#b.optionIcon){const t=this.#z("img");if(this.#G(t,"opt-icn"),"opt-icn"in this.#b.classNames){const e=this.#b.classNames["opt-icn"];e&&this.#G(t,e)}if("opt-icn"in this.#b.attributes){const e=this.#b.attributes["opt-icn"];this.#st(t,e)}t.src=e.img,t.alt=e.lbl,t.loading="lazy",n.append(t)}const o=this.#z("span");if(this.#G(o,"opt-lbl"),"opt-lbl"in this.#b.classNames){const t=this.#b.classNames["opt-lbl"];t&&this.#G(o,t)}if("opt-lbl"in this.#b.attributes){const t=this.#b.attributes["opt-lbl"];this.#st(o,t)}this.#q(o,e.lbl),n.append(o);const l=this.#z("span");if(this.#G(l,"opt-prefix"),"opt-prefix"in this.#b.classNames){const t=this.#b.classNames["opt-prefix"];t&&this.#G(l,t)}if("opt-prefix"in this.#b.attributes){const t=this.#b.attributes["opt-prefix"];this.#st(o,t)}this.#q(l,e.code),i.append(n,l),Object.keys(e.attributes).map((t=>{this.#_(i,t,e.attributes[t])})),t.includes(e.val)?(this.#G(i,"selected-opt"),this.#_(i,"aria-selected",!0)):this.#_(i,"aria-selected",!1),"group"===e.type?this.#G(i,"opt-group-title"):("groupIndex"in e&&this.#G(i,"opt-group-child"),this.#_(i,"data-index",s),this.#_(i,"data-value",e.val),this.#_(i,"role","option"),this.#_(i,"aria-posinset",s+1),this.#_(i,"aria-setsize",this.#g.length),this.#U(i,this.#F()?"0":"-1"),e.disabled?this.#G(i,"disabled-opt"):(this.#v(i,"click",(t=>{this.#Y(t)})),this.#v(i,"keyup",(t=>{"Enter"===t.key&&this.#Y(t)})))),this.#d.appendChild(i)}}#L(t){if("Enter"===t.key&&this.#g.length){const e=this.#g?.[0].i;if(e&&(this.setSelectedOption(e),this.searchOptions("")),this.#p&&"none"!==this.#H(this.#r)){const{value:e}=t.target;if(this.#K(e),this.#b.multipleSelect){const t=this.#Q(this.#u);t.push(e),this.#u=this.#X(t)}else this.#u=e;this.#W(),this.setSelectedOption(this.#u)}}else this.searchOptions(t.target.value)}#K(t){let e=t.trim();if(e.includes&&e){const t=this.#m.length;for(let s=0;s<t;s+=1)if(this.#m[s].lbl.toLowerCase()===e){e="";break}if(e){const t={lbl:e,val:e,attributes:{}};this.#m.push(t),this.#g.push(t),this.searchOptions("")}}}searchOptions(t){this.#it(t);let e=[],s=!1;if(t){const i=this.#b.options.length,n=[],o=t.toLowerCase();for(let t=0;t<i;t+=1){const i=this.#b.options[t];if("type"in i)continue;const l=i.lbl.toLowerCase();if(l.includes(o)){if("groupIndex"in i&&!n.includes(i.groupIndex)){const t=i.groupIndex;n.push(t),e.push(this.#b.options[t])}e.push(i),l===o&&(s=!0)}}const l=this.#m.length;for(let t=0;t<l;t+=1){const i=this.#m[t],n=i.lbl.toLowerCase();n.includes(o)&&(e.push(i),n===o&&(s=!0))}e.length||(e=[{i:"not-found",lbl:"No Option Found"}]),this.#g=this.#p?[this.#b.options[0]]:[],this.#g.push(...e),this.#b.searchClearable&&(this.#h.style.display="grid")}else this.#g=this.#b.options,this.#b.searchClearable&&(this.#h.style.display="none"),this.#p&&(this.#r=this.#C(`${this.#$()} .create-opt`),this.#r.style.display="none",this.#g=this.#g.concat(this.#m));this.#W(),this.#r=this.#C(`${this.#$()} .create-opt`),s&&this.#p?this.#r.style.display="none":this.#p&&t.trim()&&(this.#r.style.display="block",this.#r.querySelector(".opt-lbl").innerText=`Create: ${t}`,this.#_(this.#r,"data-value",t))}#it(t){this.#s.value=t}#nt(t){this.#t.contains(t.target)||this.setMenu({open:!1})}#F(){return this.#j(this.#t,"menu-open")}#ot(){const t=this.#n.getBoundingClientRect(),e=t.top,s=this.#O.innerHeight-t.bottom;s<e&&s<this.#b.maxHeight?(this.#t.style.flexDirection="column-reverse",this.#t.style.bottom="0%"):(this.#t.style.flexDirection="column",this.#t.style.removeProperty("bottom"))}setMenu(t){let{open:e}=t;this.#i.style.maxHeight=`${e?this.#b.maxHeight:0}px`,e?(this.#ot(),this.#G(this.#t,"menu-open"),this.#v(this.#f,"click",(t=>this.#nt(t))),this.#U(this.#s,0),this.#U(this.#h,0),this.#n.setAttribute("aria-expanded","true"),this.#_(this.#d,"aria-hidden",!1),this.#_(this.#s,"aria-hidden",!1),this.#W()):(this.#J(this.#t,"menu-open"),this.#f.removeEventListener("click",this.#nt),this.searchOptions(""),this.#U(this.#s,-1),this.#U(this.#h,-1),this.#n.setAttribute("aria-expanded","false"),this.#_(this.#d,"aria-hidden",!0),this.#_(this.#s,"aria-hidden",!0)),this.#et()}#I(t){"Space"===t.code&&(this.#s.focus(),this.setMenu({open:!0})),"click"===t.type&&(this.#F()?this.setMenu({open:!1}):(this.#s.focus(),this.setMenu({open:!0})))}set activelist(t){const e=this.#C(`.${this.fieldKey}-option-list[data-list=${t}]`);e&&(this.#V(`.${this.fieldKey}-option-list:not([data-list=${t}])`).forEach((t=>this.#J(t,"active-list"))),this.#G(e,"active-list"),this.setSelectedOption(""),this.#S())}set disabled(t){"true"===String(t).toLowerCase()?(this.#t.classList.add("disabled"),this.#e.disabled=!0,this.#U(this.#n,-1),this.#U(this.#a,-1),this.#_(this.#n,"aria-label","Dropdown disabled"),this.setMenu({open:!1})):"false"===String(t).toLowerCase()&&(this.#J(this.#t,"disabled"),this.#e.removeAttribute("disabled"),this.#U(this.#n,0),this.#U(this.#a,0),this.#_(this.#n,"aria-label",this.#b.placeholder))}get disabled(){return this.#e.disabled}set readonly(t){"true"===String(t).toLowerCase()?(this.#G(this.#t,"disabled"),this.#e.readOnly=!0,this.#U(this.#n,-1),this.#U(this.#a,-1),this.setMenu({open:!1})):"false"===String(t).toLowerCase()&&(this.#J(this.#t,"disabled"),this.#e.removeAttribute("readonly"),this.#U(this.#n,0),this.#U(this.#a,0))}get readonly(){return this.#e.readOnly}set value(t){this.#e.value=t}get value(){return this.#e.value}#lt(){this.#w.forEach((t=>{let{selector:e,eventType:s,cb:i}=t;e.removeEventListener(s,i)}))}destroy(){this.value="",this.#lt()}reset(){this.#R(),this.destroy(),this.init()}}}));
