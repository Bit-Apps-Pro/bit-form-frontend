!function(e,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(e="undefined"!=typeof globalThis?globalThis:e||self).bit_advance_file_upload_field=i()}(this,(function(){"use strict";return class{#e=null;#i=null;#t=null;#n={};#o=null;#s=null;#l=null;#a=null;#f={document:{},formID:null,configSetting:{},ajaxURL:null,nonce:null,uploadFileToServer:null};constructor(e,i){Object.assign(this.#f,i),this.#e="string"==typeof e?this.#f.document.querySelector(e):e,this.#t=this.#f.document,this.#o=this.#f.formID,this.#n=this.#f.configSetting,this.#s=this.#f.ajaxURL,this.#l=this.#f.nonce,this.#a=this.#f.uploadFileToServer,this.files=[],this.uploaded_files=[],this.on_select_upload=!1,this.init()}init(){const e=[];if(this.#n.allowFileSizeValidation&&e.push(bit_filepond_plugin_file_validate_size),this.#n.allowFileTypeValidation&&e.push(bit_filepond_plugin_file_validate_type),this.#n.allowImageCrop&&e.push(bit_filepond_plugin_image_crop),this.#n.allowImagePreview&&e.push(bit_filepond_plugin_image_preview),this.#n.allowImageResize&&e.push(bit_filepond_plugin_image_resize),this.#n.allowImageTransform&&e.push(bit_filepond_plugin_image_transform),this.#n.allowImageValidateSize&&e.push(bit_filepond_plugin_image_validate_size),this.#n.allowPreview&&e.push(bit_filepond_plugin_media_preview),registerPlugin(...e),this.#i=create(this.#n),this.#e.appendChild(this.#i.element),this.#f.onFileUpdate&&this.#i.on("updatefiles",this.#f.onFileUpdate),this.#a){const e=new URL(this.#s);this.on_select_upload=this.#n.instantUpload,e.searchParams.append("_ajax_nonce",this.#l),this.#i.setOptions({server:{process:(i,t,n,o,s,l,a)=>{const f=new FormData;e.searchParams.has("action")&&e.searchParams.delete("action"),e.searchParams.append("action","bitforms_file_upload"),f.append(`${i}`,t,t.name);const d=new XMLHttpRequest;return d.open("POST",e.href),d.upload.onprogress=e=>{l(e.lengthComputable,e.loaded,e.total)},d.onload=()=>{if(d.status>=200&&d.status<300){const e=JSON.parse(d.responseText);this.uploaded_files.push(e?.data?.file_name),o(e?.data?.file_name)}else s("oh no")},d.send(f),{abort:()=>{d.abort(),a()}}},revert:(i,t,n)=>{if(this.uploaded_files.find((e=>e===i))){const o=this.uploaded_files.indexOf(i);this.uploaded_files.splice(o,1),e.searchParams.has("action")&&e.searchParams.delete("action"),e.searchParams.append("action","bitforms_file_delete"),e.searchParams.append("file_name",i);const s=new XMLHttpRequest;return s.open("DELETE",e.href),s.onload=()=>{s.status>=200&&s.status<300?t():n()},s.send(),{abort:()=>{s.abort()}}}}}}),this.#i.on("updatefiles",(()=>{this.files=[],this.files=this.#i.getFiles()}))}}reset(){this.#i.destroy(this.#i.element),this.init()}}}));
