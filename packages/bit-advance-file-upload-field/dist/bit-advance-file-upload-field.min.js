var bit_advance_file_upload_field=function(){"use strict";return class{#i=null;#e=null;#t=null;#n=null;#o={};#s=null;#l=null;#a=null;#d=null;#f={document:{},formID:null,configSetting:{},ajaxURL:null,nonce:null,uploadFileToServer:null};constructor(i,e){Object.assign(this.#f,e),this.#i="string"==typeof i?this.#f.document.querySelector(i):i,this.#n=e.window?e.window:window,this.#t=e.document?e.document:document,this.#s=this.#f.formID,this.#o=this.#f.configSetting,this.#l=this.#f.ajaxURL,this.#a=this.#f.nonce,this.#d=this.#f.uploadFileToServer,this.files=[],this.uploaded_files=[],this.on_select_upload=!1,this.init()}init(){const i=[];if(this.#o.allowFileSizeValidation&&i.push(this.#n.bit_filepond_plugin_file_validate_size),this.#o.allowFileTypeValidation&&i.push(this.#n.bit_filepond_plugin_file_validate_type),this.#o.allowImageCrop&&i.push(this.#n.bit_filepond_plugin_image_crop),this.#o.allowImagePreview&&i.push(this.#n.bit_filepond_plugin_image_preview),this.#o.allowImageResize&&i.push(this.#n.bit_filepond_plugin_image_resize),this.#o.allowImageTransform&&i.push(this.#n.bit_filepond_plugin_image_transform),this.#o.allowImageValidateSize&&i.push(this.#n.bit_filepond_plugin_image_validate_size),this.#o.allowPreview&&i.push(this.#n.bit_filepond_plugin_media_preview),this.#n.registerPlugin(...i),this.#e=this.#n.create(this.#o),this.#i.appendChild(this.#e.element),this.#f.onFileUpdate&&this.#e.on("updatefiles",this.#f.onFileUpdate),this.#d){const i=new URL(this.#l);this.on_select_upload=this.#o.instantUpload,i.searchParams.append("_ajax_nonce",this.#a),this.#e.setOptions({server:{process:(e,t,n,o,s,l,a)=>{const d=new FormData;i.searchParams.has("action")&&i.searchParams.delete("action"),i.searchParams.append("action","bitforms_file_upload"),d.append(`${e}`,t,t.name);const f=new XMLHttpRequest;return f.open("POST",i.href),f.upload.onprogress=i=>{l(i.lengthComputable,i.loaded,i.total)},f.onload=()=>{if(f.status>=200&&f.status<300){const i=JSON.parse(f.responseText);this.uploaded_files.push(i?.data?.file_name),o(i?.data?.file_name)}else s("oh no")},f.send(d),{abort:()=>{f.abort(),a()}}},revert:(e,t,n)=>{if(this.uploaded_files.find((i=>i===e))){const o=this.uploaded_files.indexOf(e);this.uploaded_files.splice(o,1),i.searchParams.has("action")&&i.searchParams.delete("action"),i.searchParams.append("action","bitforms_file_delete"),i.searchParams.append("file_name",e);const s=new XMLHttpRequest;return s.open("DELETE",i.href),s.onload=()=>{s.status>=200&&s.status<300?t():n()},s.send(),{abort:()=>{s.abort()}}}}}}),this.#e.on("updatefiles",(()=>{this.files=[],this.files=this.#e.getFiles()}))}}reset(){this.#e.destroy(this.#e.element),this.init()}}}();
